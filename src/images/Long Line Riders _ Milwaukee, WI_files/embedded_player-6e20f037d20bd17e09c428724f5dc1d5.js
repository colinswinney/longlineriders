// bundle contents: shared/jslib/knockout/knockout-3.4.1.js, shared/jslib/knockout/knockout-sortable.min.js, shared/jslib/knockout/knockout-switch-case.min.js, shared/js/knockout_utils.js, shared/js/log.js, shared/js/utils_boot.js, shared/js/html5sound.js, shared/js/image_utils.js, shared/js/sound.js, shared/js/cookie.js, shared/js/hidden_params.js, shared/js/cookie_comm.js, shared/js/stats.js, trackpipe/public/js/identities.js, shared/js/color.js, trackpipe/public/js/share.js, shared/js/utils.js, shared/js/templ.js, shared/js/htmlembeddedplayer.js, shared/js/playlist.js, shared/js/share_external.js, shared/js/social_controls.js, shared/jslib/jquery-ui/1.9.2/ui/minified/jquery.ui.draggable.min.js, shared/jslib/jquery-ui/1.9.2/ui/minified/jquery.ui.dialog.min.js, shared/jslib/iscroll-3.7.1/dist/iscroll-min.js, shared/js/analytics.js
(function(){(function(n$$0){var x$$0=this||(0,eval)("this");var s$$0=x$$0.document;var M=x$$0.navigator;var u=x$$0.jQuery;var F=x$$0.JSON;(function(n){"function"===typeof define&&define.amd?define(["exports","require"],n):"object"===typeof exports&&"object"===typeof module?n(module.exports||exports):n(x$$0.ko={})})(function(N,O){function J(a,c){return null===a||typeof a in R?a===c:!1}function S(b,c){var d;return function(){d||(d=a.a.setTimeout(function(){d=n$$0;b()},c))}}function T(b,c){var d;return function(){clearTimeout(d);
d=a.a.setTimeout(b,c)}}function U(a,c){c&&c!==I?"beforeChange"===c?this.Lb(a):this.Ha(a,c):this.Mb(a)}function V(a,c){null!==c&&c.k&&c.k()}function W(a,c){var d=this.Ic;var e=d[t];e.S||(this.lb&&this.Ma[c]?(d.Qb(c,a,this.Ma[c]),this.Ma[c]=null,--this.lb):e.r[c]||d.Qb(c,a,e.s?{ia:a}:d.wc(a)))}function K(b$$0,c,d,e){a.d[b$$0]={init:function(b,g,h,l,m){var k;var r;a.m(function(){var q=g();var p=a.a.c(q);p=!d!==!p;var A=!r;if(A||c||p!==k)A&&a.va.Aa()&&(r=a.a.ua(a.f.childNodes(b),!0)),p?(A||a.f.da(b,a.a.ua(r)),
a.eb(e?e(m,q):m,b)):a.f.xa(b),k=p},null,{i:b});return{controlsDescendantBindings:!0}}};a.h.ta[b$$0]=!1;a.f.Z[b$$0]=!0}var a="undefined"!==typeof N?N:{};a.b=function(b,c){var d=b.split(".");var e=a;for(var f=0;f<d.length-1;f++)e=e[d[f]];e[d[d.length-1]]=c};a.G=function(a,c,d){a[c]=d};a.version="3.4.1";a.b("version",a.version);a.options={deferUpdates:!1,useOnlyNativeEvents:!1};a.a=function(){function b$$1(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function c$$1(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&
(a[c]=b[c]);return a}function d$$0(a,b){a.__proto__=b;return a}function e$$0(b$$0,c,d,e){var k=b$$0[c].match(r$$0)||[];a.a.q(d.match(r$$0),function(b){a.a.pa(k,b,e)});b$$0[c]=k.join(" ")}var f$$0={__proto__:[]}instanceof Array;var g$$0="function"===typeof Symbol;var h$$0={};var l$$0={};h$$0[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];h$$0.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");b$$1(h$$0,
function(a,b){if(b.length){var c=0;for(var d=b.length;c<d;c++)l$$0[b[c]]=a}});var m$$0={propertychange:!0};var k$$0=s$$0&&function(){var a=3;var b=s$$0.createElement("div");for(var c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e",c[0];);return 4<a?a:n$$0}();var r$$0=/\S+/g;return{ec:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(a,b){var c=0;for(var d=a.length;c<d;c++)b(a[c],c)},o:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,
b);var c=0;for(var d=a.length;c<d;c++)if(a[c]===b)return c;return-1},Tb:function(a,b,c){var d=0;for(var e=a.length;d<e;d++)if(b.call(c,a[d],d))return a[d];return null},La:function(b,c){var d=a.a.o(b,c);0<d?b.splice(d,1):0===d&&b.shift()},Ub:function(b){b=b||[];var c=[];var d=0;for(var e=b.length;d<e;d++)0>a.a.o(c,b[d])&&c.push(b[d]);return c},fb:function(a,b){a=a||[];var c=[];var d=0;for(var e=a.length;d<e;d++)c.push(b(a[d],d));return c},Ka:function(a,b){a=a||[];var c=[];var d=0;for(var e=a.length;d<
e;d++)b(a[d],d)&&c.push(a[d]);return c},ra:function(a,b){if(b instanceof Array)a.push.apply(a,b);else{var c=0;for(var d=b.length;c<d;c++)a.push(b[c])}return a},pa:function(b,c,d){var e=a.a.o(a.a.zb(b),c);0>e?d&&b.push(c):d||b.splice(e,1)},ka:f$$0,extend:c$$1,Xa:d$$0,Ya:f$$0?d$$0:c$$1,D:b$$1,Ca:function(a,b){if(!a)return a;var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},ob:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},lc:function(b){b=a.a.V(b);var c=(b[0]&&b[0].ownerDocument||
s$$0).createElement("div");var d=0;for(var e=b.length;d<e;d++)c.appendChild(a.$(b[d]));return c},ua:function(b,c){var d=0;var e=b.length;for(var k=[];d<e;d++){var m=b[d].cloneNode(!0);k.push(c?a.$(m):m)}return k},da:function(b,c){a.a.ob(b);if(c){var d=0;for(var e=c.length;d<e;d++)b.appendChild(c[d])}},sc:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){var e=d[0];var k=e.parentNode;var m=0;for(var f=c.length;m<f;m++)k.insertBefore(c[m],e);m=0;for(f=d.length;m<f;m++)a.removeNode(d[m])}},za:function(a,
b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;1<a.length&&a[a.length-1].parentNode!==b;)a.length--;if(1<a.length){var c=a[0];var d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),c=c.nextSibling;a.push(d)}}return a},uc:function(a,b){7>k$$0?a.setAttribute("selected",b):a.selected=b},$a:function(a){return null===a||a===n$$0?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},od:function(a,b){a=a||"";return b.length>a.length?!1:
a.substring(0,b.length)===b},Nc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;a&&a!=b;)a=a.parentNode;return!!a},nb:function(b){return a.a.Nc(b,b.ownerDocument.documentElement)},Rb:function(b){return!!a.a.Tb(b,a.a.nb)},A:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},Xb:function(b){return a.onError?function(){try{return b.apply(this,
arguments)}catch(c){throw a.onError&&a.onError(c),c;}}:b},setTimeout:function(b,c){return setTimeout(a.a.Xb(b),c)},bc:function(b){setTimeout(function(){a.onError&&a.onError(b);throw b;},0)},p:function(b,c,d){var e=a.a.Xb(d);d=k$$0&&m$$0[c];if(a.options.useOnlyNativeEvents||d||!u)if(d||"function"!=typeof b.addEventListener)if("undefined"!=typeof b.attachEvent){var f=function(a){e.call(b,a)};var l="on"+c;b.attachEvent(l,f);a.a.F.oa(b,function(){b.detachEvent(l,f)})}else throw Error("Browser doesn't support addEventListener or attachEvent");
else b.addEventListener(c,e,!1);else u(b).bind(c,e)},Da:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;"input"===a.a.A(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==d||"radio"==d):d=!1;if(a.options.useOnlyNativeEvents||!u||d)if("function"==typeof s$$0.createEvent)if("function"==typeof b.dispatchEvent)d=s$$0.createEvent(l$$0[c]||"HTMLEvents"),d.initEvent(c,!0,!0,x$$0,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d);else throw Error("The supplied element doesn't support dispatchEvent");
else if(d&&b.click)b.click();else if("undefined"!=typeof b.fireEvent)b.fireEvent("on"+c);else throw Error("Browser doesn't support triggering events");else u(b).trigger(c)},c:function(b){return a.H(b)?b():b},zb:function(b){return a.H(b)?b.t():b},bb:function(b,c,d){var k;c&&("object"===typeof b.classList?(k=b.classList[d?"add":"remove"],a.a.q(c.match(r$$0),function(a){k.call(b.classList,a)})):"string"===typeof b.className.baseVal?e$$0(b.className,"baseVal",c,d):e$$0(b,"className",c,d))},Za:function(b,
c){var d=a.a.c(c);if(null===d||d===n$$0)d="";var e=a.f.firstChild(b);!e||3!=e.nodeType||a.f.nextSibling(e)?a.f.da(b,[b.ownerDocument.createTextNode(d)]):e.data=d;a.a.Sc(b)},tc:function(a,b){a.name=b;if(7>=k$$0)try{a.mergeAttributes(s$$0.createElement("\x3cinput name\x3d'"+a.name+"'/\x3e"),!1)}catch(c){}},Sc:function(a){9<=k$$0&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},Oc:function(a){if(k$$0){var b=a.style.width;a.style.width=0;a.style.width=b}},jd:function(b,c){b=a.a.c(b);
c=a.a.c(c);var d=[];for(var e=b;e<=c;e++)d.push(e);return d},V:function(a){var b=[];var c=0;for(var d=a.length;c<d;c++)b.push(a[c]);return b},$b:function(a){return g$$0?Symbol(a):a},sd:6===k$$0,ud:7===k$$0,C:k$$0,gc:function(b,c){var d=a.a.V(b.getElementsByTagName("input")).concat(a.a.V(b.getElementsByTagName("textarea")));var e="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)};var k=[];for(var m=d.length-1;0<=m;m--)e(d[m])&&k.push(d[m]);return k},fd:function(b){return"string"==
typeof b&&(b=a.a.$a(b))?F&&F.parse?F.parse(b):(new Function("return "+b))():null},Eb:function(b,c,d){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE \x3c 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return F.stringify(a.a.c(b),c,d)},gd:function(c$$0,d,e){e=e||{};var k=e.params||{};var m=e.includeFields||this.ec;var f=c$$0;if("object"==typeof c$$0&&"form"===a.a.A(c$$0)){f=
c$$0.action;for(var l=m.length-1;0<=l;l--){var g=a.a.gc(c$$0,m[l]);for(var h=g.length-1;0<=h;h--)k[g[h].name]=g[h].value}}d=a.a.c(d);var r=s$$0.createElement("form");r.style.display="none";r.action=f;r.method="post";for(var n in d)c$$0=s$$0.createElement("input"),c$$0.type="hidden",c$$0.name=n,c$$0.value=a.a.Eb(a.a.c(d[n])),r.appendChild(c$$0);b$$1(k,function(a,b){var c=s$$0.createElement("input");c.type="hidden";c.name=a;c.value=b;r.appendChild(c)});s$$0.body.appendChild(r);e.submitter?e.submitter(r):
r.submit();setTimeout(function(){r.parentNode.removeChild(r)},0)}}}();a.b("utils",a.a);a.b("utils.arrayForEach",a.a.q);a.b("utils.arrayFirst",a.a.Tb);a.b("utils.arrayFilter",a.a.Ka);a.b("utils.arrayGetDistinctValues",a.a.Ub);a.b("utils.arrayIndexOf",a.a.o);a.b("utils.arrayMap",a.a.fb);a.b("utils.arrayPushAll",a.a.ra);a.b("utils.arrayRemoveItem",a.a.La);a.b("utils.extend",a.a.extend);a.b("utils.fieldsIncludedWithJsonPost",a.a.ec);a.b("utils.getFormFields",a.a.gc);a.b("utils.peekObservable",a.a.zb);
a.b("utils.postJson",a.a.gd);a.b("utils.parseJson",a.a.fd);a.b("utils.registerEventHandler",a.a.p);a.b("utils.stringifyJson",a.a.Eb);a.b("utils.range",a.a.jd);a.b("utils.toggleDomNodeCssClass",a.a.bb);a.b("utils.triggerEvent",a.a.Da);a.b("utils.unwrapObservable",a.a.c);a.b("utils.objectForEach",a.a.D);a.b("utils.addOrRemoveItem",a.a.pa);a.b("utils.setTextContent",a.a.Za);a.b("unwrap",a.a.c);Function.prototype.bind||(Function.prototype.bind=function(a){var c=this;if(1===arguments.length)return function(){return c.apply(a,
arguments)};var d=Array.prototype.slice.call(arguments,1);return function(){var e=d.slice(0);e.push.apply(e,arguments);return c.apply(a,e)}});a.a.e=new function(){function a$$0(b,g){var h=b[d$$0];if(!h||"null"===h||!e$$0[h]){if(!g)return n$$0;h=b[d$$0]="ko"+c$$0++;e$$0[h]={}}return e$$0[h]}var c$$0=0;var d$$0="__ko__"+(new Date).getTime();var e$$0={};return{get:function(c,d){var e=a$$0(c,!1);return e===n$$0?n$$0:e[d]},set:function(c,d,e){if(e!==n$$0||a$$0(c,!1)!==n$$0)a$$0(c,!0)[d]=e},clear:function(a){var b=
a[d$$0];return b?(delete e$$0[b],a[d$$0]=null,!0):!1},I:function(){return c$$0++ +d$$0}}};a.b("utils.domData",a.a.e);a.b("utils.domData.clear",a.a.e.clear);a.a.F=new function(){function b$$0(b,c){var e=a.a.e.get(b,d$$0);e===n$$0&&c&&(e=[],a.a.e.set(b,d$$0,e));return e}function c$$0(d){var e=b$$0(d,!1);if(e){e=e.slice(0);for(var l=0;l<e.length;l++)e[l](d)}a.a.e.clear(d);a.a.F.cleanExternalData(d);if(f[d.nodeType])for(e=d.firstChild;d=e;)e=d.nextSibling,8===d.nodeType&&c$$0(d)}var d$$0=a.a.e.I();var e$$0=
{1:!0,8:!0,9:!0};var f={1:!0,9:!0};return{oa:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b$$0(a,!0).push(c)},rc:function(c,e){var l=b$$0(c,!1);l&&(a.a.La(l,e),0==l.length&&a.a.e.set(c,d$$0,n$$0))},$:function(b){if(e$$0[b.nodeType]&&(c$$0(b),f[b.nodeType])){var d=[];a.a.ra(d,b.getElementsByTagName("*"));var l=0;for(var m=d.length;l<m;l++)c$$0(d[l])}return b},removeNode:function(b){a.$(b);b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){u&&
"function"==typeof u.cleanData&&u.cleanData([a])}}};a.$=a.a.F.$;a.removeNode=a.a.F.removeNode;a.b("cleanNode",a.$);a.b("removeNode",a.removeNode);a.b("utils.domNodeDisposal",a.a.F);a.b("utils.domNodeDisposal.addDisposeCallback",a.a.F.oa);a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.F.rc);(function(){var b$$0=[0,"",""];var c$$0=[1,"\x3ctable\x3e","\x3c/table\x3e"];var d$$0=[3,"\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e","\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"];var e$$0=[1,"\x3cselect multiple\x3d'multiple'\x3e",
"\x3c/select\x3e"];var f={thead:c$$0,tbody:c$$0,tfoot:c$$0,tr:[2,"\x3ctable\x3e\x3ctbody\x3e","\x3c/tbody\x3e\x3c/table\x3e"],td:d$$0,th:d$$0,option:e$$0,optgroup:e$$0};var g=8>=a.a.C;a.a.ma=function(c,d){var e;if(u)if(u.parseHTML)e=u.parseHTML(c,d)||[];else{if((e=u.clean([c],d))&&e[0]){for(var k=e[0];k.parentNode&&11!==k.parentNode.nodeType;)k=k.parentNode;k.parentNode&&k.parentNode.removeChild(k)}}else{(e=d)||(e=s$$0);k=e.parentWindow||e.defaultView||x$$0;var r=a.a.$a(c).toLowerCase();var q=e.createElement("div");
var p;p=(r=r.match(/^<([a-z]+)[ >]/))&&f[r[1]]||b$$0;r=p[0];p="ignored\x3cdiv\x3e"+p[1]+c+p[2]+"\x3c/div\x3e";for("function"==typeof k.innerShiv?q.appendChild(k.innerShiv(p)):(g&&e.appendChild(q),q.innerHTML=p,g&&q.parentNode.removeChild(q));r--;)q=q.lastChild;e=a.a.V(q.lastChild.childNodes)}return e};a.a.Cb=function(b,c){a.a.ob(b);c=a.a.c(c);if(null!==c&&c!==n$$0)if("string"!=typeof c&&(c=c.toString()),u)u(b).html(c);else{var d=a.a.ma(c,b.ownerDocument);for(var e=0;e<d.length;e++)b.appendChild(d[e])}}})();
a.b("utils.parseHtmlFragment",a.a.ma);a.b("utils.setHtml",a.a.Cb);a.M=function(){function b$$0(c,e){if(c)if(8==c.nodeType){var f=a.M.nc(c.nodeValue);null!=f&&e.push({Mc:c,dd:f})}else if(1==c.nodeType){f=0;var g=c.childNodes;for(var h=g.length;f<h;f++)b$$0(g[f],e)}}var c$$0={};return{wb:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);
c$$0[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},zc:function(a,b){var f=c$$0[a];if(f===n$$0)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return f.apply(null,b||[]),!0}finally{delete c$$0[a]}},Ac:function(c,e){var f=[];b$$0(c,f);var g=0;for(var h=f.length;g<h;g++){var l=f[g].Mc;var m=[l];e&&a.a.ra(m,e);a.M.zc(f[g].dd,m);l.nodeValue="";l.parentNode&&l.parentNode.removeChild(l)}},nc:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();
a.b("memoization",a.M);a.b("memoization.memoize",a.M.wb);a.b("memoization.unmemoize",a.M.zc);a.b("memoization.parseMemoText",a.M.nc);a.b("memoization.unmemoizeDomNodeAndDescendants",a.M.Ac);a.Y=function(){function b$$0(){if(e){var b=e;var c=0;for(var m;g<e;)if(m=d[g++]){if(g>b){if(5E3<=++c){g=e;a.a.bc(Error("'Too much recursion' after processing "+c+" task groups."));break}b=e}try{m()}catch(k){a.a.bc(k)}}}}function c$$0(){b$$0();g=e=d.length=0}var d=[];var e=0;var f=1;var g=0;return{scheduler:x$$0.MutationObserver?
function(a){var b=s$$0.createElement("div");(new MutationObserver(a)).observe(b,{attributes:!0});return function(){b.classList.toggle("foo")}}(c$$0):s$$0&&"onreadystatechange"in s$$0.createElement("script")?function(a){var b=s$$0.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null;s$$0.documentElement.removeChild(b);b=null;a()};s$$0.documentElement.appendChild(b)}:function(a){setTimeout(a,0)},Wa:function(b){e||a.Y.scheduler(c$$0);d[e++]=b;return f++},cancel:function(a){a-=
f-e;a>=g&&a<e&&(d[a]=null)},resetForTesting:function(){var a=e-g;g=e=d.length=0;return a},nd:b$$0}}();a.b("tasks",a.Y);a.b("tasks.schedule",a.Y.Wa);a.b("tasks.runEarly",a.Y.nd);a.ya={throttle:function(b,c){b.throttleEvaluation=c;var d=null;return a.B({read:b,write:function(e){clearTimeout(d);d=a.a.setTimeout(function(){b(e)},c)}})},rateLimit:function(a$$0,c){var d;var e;var f;"number"==typeof c?d=c:(d=c.timeout,e=c.method);a$$0.cb=!1;f="notifyWhenChangesStop"==e?T:S;a$$0.Ta(function(a){return f(a,
d)})},deferred:function(b,c$$0){if(!0!==c$$0)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");b.cb||(b.cb=!0,b.Ta(function(c){var e;return function(){a.Y.cancel(e);e=a.Y.Wa(c);b.notifySubscribers(n$$0,"dirty")}}))},notify:function(a,c){a.equalityComparer="always"==c?null:J}};var R={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.ya);a.xc=function(b,c,d){this.ia=b;this.gb=c;this.Lc=d;this.S=!1;a.G(this,
"dispose",this.k)};a.xc.prototype.k=function(){this.S=!0;this.Lc()};a.J=function(){a.a.Ya(this,D);D.rb(this)};var I="change";var D={rb:function(a){a.K={};a.Ob=1},X:function(b,c,d){var e=this;d=d||I;var f=new a.xc(e,c?b.bind(c):b,function(){a.a.La(e.K[d],f);e.Ia&&e.Ia(d)});e.sa&&e.sa(d);e.K[d]||(e.K[d]=[]);e.K[d].push(f);return f},notifySubscribers:function(b,c){c=c||I;c===I&&this.Ib();if(this.Pa(c))try{a.l.Vb();var d=this.K[c].slice(0);var e=0;for(var f;f=d[e];++e)f.S||f.gb(b)}finally{a.l.end()}},
Na:function(){return this.Ob},Vc:function(a){return this.Na()!==a},Ib:function(){++this.Ob},Ta:function(b){var c=this;var d=a.H(c);var e;var f;var g;c.Ha||(c.Ha=c.notifySubscribers,c.notifySubscribers=U);var h=b(function(){c.Nb=!1;d&&g===c&&(g=c());e=!1;c.tb(f,g)&&c.Ha(f=g)});c.Mb=function(a){c.Nb=e=!0;g=a;h()};c.Lb=function(a){e||(f=a,c.Ha(a,"beforeChange"))}},Pa:function(a){return this.K[a]&&this.K[a].length},Tc:function(b$$0){if(b$$0)return this.K[b$$0]&&this.K[b$$0].length||0;var c=0;a.a.D(this.K,
function(a,b){"dirty"!==a&&(c+=b.length)});return c},tb:function(a,c){return!this.equalityComparer||!this.equalityComparer(a,c)},extend:function(b$$0){var c=this;b$$0&&a.a.D(b$$0,function(b,e){var f=a.ya[b];"function"==typeof f&&(c=f(c,e)||c)});return c}};a.G(D,"subscribe",D.X);a.G(D,"extend",D.extend);a.G(D,"getSubscriptionsCount",D.Tc);a.a.ka&&a.a.Xa(D,Function.prototype);a.J.fn=D;a.jc=function(a){return null!=a&&"function"==typeof a.X&&"function"==typeof a.notifySubscribers};a.b("subscribable",
a.J);a.b("isSubscribable",a.jc);a.va=a.l=function(){function b$$0(a){d$$0.push(e$$0);e$$0=a}function c(){e$$0=d$$0.pop()}var d$$0=[];var e$$0;var f=0;return{Vb:b$$0,end:c,qc:function(b){if(e$$0){if(!a.jc(b))throw Error("Only subscribable things can act as dependencies");e$$0.gb.call(e$$0.Hc,b,b.Dc||(b.Dc=++f))}},w:function(a,d,e){try{return b$$0(),a.apply(d,e||[])}finally{c()}},Aa:function(){if(e$$0)return e$$0.m.Aa()},Sa:function(){if(e$$0)return e$$0.Sa}}}();a.b("computedContext",a.va);a.b("computedContext.getDependenciesCount",
a.va.Aa);a.b("computedContext.isInitial",a.va.Sa);a.b("ignoreDependencies",a.rd=a.l.w);var E=a.a.$b("_latestValue");a.N=function(b){function c(){if(0<arguments.length)return c.tb(c[E],arguments[0])&&(c.ga(),c[E]=arguments[0],c.fa()),this;a.l.qc(c);return c[E]}c[E]=b;a.a.ka||a.a.extend(c,a.J.fn);a.J.fn.rb(c);a.a.Ya(c,B);a.options.deferUpdates&&a.ya.deferred(c,!0);return c};var B={equalityComparer:J,t:function(){return this[E]},fa:function(){this.notifySubscribers(this[E])},ga:function(){this.notifySubscribers(this[E],
"beforeChange")}};a.a.ka&&a.a.Xa(B,a.J.fn);var H=a.N.hd="__ko_proto__";B[H]=a.N;a.Oa=function(b,c){return null===b||b===n$$0||b[H]===n$$0?!1:b[H]===c?!0:a.Oa(b[H],c)};a.H=function(b){return a.Oa(b,a.N)};a.Ba=function(b){return"function"==typeof b&&b[H]===a.N||"function"==typeof b&&b[H]===a.B&&b.Wc?!0:!1};a.b("observable",a.N);a.b("isObservable",a.H);a.b("isWriteableObservable",a.Ba);a.b("isWritableObservable",a.Ba);a.b("observable.fn",B);a.G(B,"peek",B.t);a.G(B,"valueHasMutated",B.fa);a.G(B,"valueWillMutate",
B.ga);a.la=function(b){b=b||[];if("object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");b=a.N(b);a.a.Ya(b,a.la.fn);return b.extend({trackArrayChanges:!0})};a.la.fn={remove:function(b){var c=this.t();var d=[];var e="function"!=typeof b||a.H(b)?function(a){return a===b}:b;for(var f=0;f<c.length;f++){var g=c[f];e(g)&&(0===d.length&&this.ga(),d.push(g),c.splice(f,1),f--)}d.length&&this.fa();return d},removeAll:function(b){if(b===
n$$0){var c$$0=this.t();var d=c$$0.slice(0);this.ga();c$$0.splice(0,c$$0.length);this.fa();return d}return b?this.remove(function(c){return 0<=a.a.o(b,c)}):[]},destroy:function(b){var c=this.t();var d="function"!=typeof b||a.H(b)?function(a){return a===b}:b;this.ga();for(var e=c.length-1;0<=e;e--)d(c[e])&&(c[e]._destroy=!0);this.fa()},destroyAll:function(b){return b===n$$0?this.destroy(function(){return!0}):b?this.destroy(function(c){return 0<=a.a.o(b,c)}):[]},indexOf:function(b){var c=this();return a.a.o(c,
b)},replace:function(a,c){var d=this.indexOf(a);0<=d&&(this.ga(),this.t()[d]=c,this.fa())}};a.a.ka&&a.a.Xa(a.la.fn,a.N.fn);a.a.q("pop push reverse shift sort splice unshift".split(" "),function(b){a.la.fn[b]=function(){var a=this.t();this.ga();this.Wb(a,b,arguments);var d=a[b].apply(a,arguments);this.fa();return d===a?this:d}});a.a.q(["slice"],function(b){a.la.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}});a.b("observableArray",a.la);a.ya.trackArrayChanges=function(b$$1,c$$1){function d$$0(){if(!e$$0){e$$0=
!0;l$$0=b$$1.notifySubscribers;b$$1.notifySubscribers=function(a,b){b&&b!==I||++h;return l$$0.apply(this,arguments)};var c=[].concat(b$$1.t()||[]);f=null;g$$0=b$$1.X(function(d){d=[].concat(d||[]);if(b$$1.Pa("arrayChange")){var e;if(!f||1<h)f=a.a.ib(c,d,b$$1.hb);e=f}c=d;f=null;h=0;e&&e.length&&b$$1.notifySubscribers(e,"arrayChange")})}}b$$1.hb={};c$$1&&"object"==typeof c$$1&&a.a.extend(b$$1.hb,c$$1);b$$1.hb.sparse=!0;if(!b$$1.Wb){var e$$0=!1;var f=null;var g$$0;var h=0;var l$$0;var m$$0=b$$1.sa;var k$$0=
b$$1.Ia;b$$1.sa=function(a){m$$0&&m$$0.call(b$$1,a);"arrayChange"===a&&d$$0()};b$$1.Ia=function(a){k$$0&&k$$0.call(b$$1,a);"arrayChange"!==a||b$$1.Pa("arrayChange")||(l$$0&&(b$$1.notifySubscribers=l$$0,l$$0=n$$0),g$$0.k(),e$$0=!1)};b$$1.Wb=function(b$$0,c$$0,d){function k(a,b,c){return m[m.length]={status:a,value:b,index:c}}if(e$$0&&!h){var m=[];var l=b$$0.length;var g=d.length;var G=0;switch(c$$0){case "push":G=l;case "unshift":for(c$$0=0;c$$0<g;c$$0++)k("added",d[c$$0],G+c$$0);break;case "pop":G=
l-1;case "shift":l&&k("deleted",b$$0[G],G);break;case "splice":c$$0=Math.min(Math.max(0,0>d[0]?l+d[0]:d[0]),l);l=1===g?l:Math.min(c$$0+(d[1]||0),l);g=c$$0+g-2;G=Math.max(l,g);var n=[];var s=[];for(var w=2;c$$0<G;++c$$0,++w)c$$0<l&&s.push(k("deleted",b$$0[c$$0],c$$0)),c$$0<g&&n.push(k("added",d[w],c$$0));a.a.fc(s,n);break;default:return}f=m}}}};var t=a.a.$b("_state");a.m=a.B=function(b,c,d){function e(){if(0<arguments.length){if("function"===typeof f)f.apply(g.pb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");
return this}a.l.qc(e);(g.T||g.s&&e.Qa())&&e.aa();return g.U}"object"===typeof b?d=b:(d=d||{},b&&(d.read=b));if("function"!=typeof d.read)throw Error("Pass a function that returns the value of the ko.computed");var f=d.write;var g={U:n$$0,T:!0,Ra:!1,Fb:!1,S:!1,Va:!1,s:!1,kd:d.read,pb:c||d.owner,i:d.disposeWhenNodeIsRemoved||d.i||null,wa:d.disposeWhen||d.wa,mb:null,r:{},L:0,dc:null};e[t]=g;e.Wc="function"===typeof f;a.a.ka||a.a.extend(e,a.J.fn);a.J.fn.rb(e);a.a.Ya(e,z$$0);d.pure?(g.Va=!0,g.s=!0,a.a.extend(e,
Y)):d.deferEvaluation&&a.a.extend(e,Z);a.options.deferUpdates&&a.ya.deferred(e,!0);g.i&&(g.Fb=!0,g.i.nodeType||(g.i=null));g.s||d.deferEvaluation||e.aa();g.i&&e.ba()&&a.a.F.oa(g.i,g.mb=function(){e.k()});return e};var z$$0={equalityComparer:J,Aa:function(){return this[t].L},Qb:function(a,c,d){if(this[t].Va&&c===this)throw Error("A 'pure' computed must not be called recursively");this[t].r[a]=d;d.Ga=this[t].L++;d.na=c.Na()},Qa:function(){var a;var c;var d=this[t].r;for(a in d)if(d.hasOwnProperty(a)&&
(c=d[a],c.ia.Vc(c.na)))return!0},cd:function(){this.Fa&&!this[t].Ra&&this.Fa()},ba:function(){return this[t].T||0<this[t].L},md:function(){this.Nb||this.cc()},wc:function(a){if(a.cb&&!this[t].i){var c=a.X(this.cd,this,"dirty");var d=a.X(this.md,this);return{ia:a,k:function(){c.k();d.k()}}}return a.X(this.cc,this)},cc:function(){var b=this;var c=b.throttleEvaluation;c&&0<=c?(clearTimeout(this[t].dc),this[t].dc=a.a.setTimeout(function(){b.aa(!0)},c)):b.Fa?b.Fa():b.aa(!0)},aa:function(b){var c=this[t];
var d=c.wa;var e=!1;if(!c.Ra&&!c.S){if(c.i&&!a.a.nb(c.i)||d&&d()){if(!c.Fb){this.k();return}}else c.Fb=!1;c.Ra=!0;try{e=this.Rc(b)}finally{c.Ra=!1}c.L||this.k();return e}},Rc:function(b){var c=this[t];var d=!1;var e=c.Va?n$$0:!c.L;var f={Ic:this,Ma:c.r,lb:c.L};a.l.Vb({Hc:f,gb:W,m:this,Sa:e});c.r={};c.L=0;f=this.Qc(c,f);this.tb(c.U,f)&&(c.s||this.notifySubscribers(c.U,"beforeChange"),c.U=f,c.s?this.Ib():b&&this.notifySubscribers(c.U),d=!0);e&&this.notifySubscribers(c.U,"awake");return d},Qc:function(b,
c){try{var d=b.kd;return b.pb?d.call(b.pb):d()}finally{a.l.end(),c.lb&&!b.s&&a.a.D(c.Ma,V),b.T=!1}},t:function(){var a=this[t];(a.T&&!a.L||a.s&&this.Qa())&&this.aa();return a.U},Ta:function(b){a.J.fn.Ta.call(this,b);this.Fa=function(){this.Lb(this[t].U);this[t].T=!0;this.Mb(this)}},k:function(){var b$$0=this[t];!b$$0.s&&b$$0.r&&a.a.D(b$$0.r,function(a,b){b.k&&b.k()});b$$0.i&&b$$0.mb&&a.a.F.rc(b$$0.i,b$$0.mb);b$$0.r=null;b$$0.L=0;b$$0.S=!0;b$$0.T=!1;b$$0.s=!1;b$$0.i=null}};var Y={sa:function(b$$0){var c=
this;var d=c[t];if(!d.S&&d.s&&"change"==b$$0){d.s=!1;if(d.T||c.Qa())d.r=null,d.L=0,d.T=!0,c.aa()&&c.Ib();else{var e$$0=[];a.a.D(d.r,function(a,b){e$$0[b.Ga]=a});a.a.q(e$$0,function(a,b){var e=d.r[a];var l=c.wc(e.ia);l.Ga=b;l.na=e.na;d.r[a]=l})}d.S||c.notifySubscribers(d.U,"awake")}},Ia:function(b$$0){var c=this[t];c.S||"change"!=b$$0||this.Pa("change")||(a.a.D(c.r,function(a,b){b.k&&(c.r[a]={ia:b.ia,Ga:b.Ga,na:b.na},b.k())}),c.s=!0,this.notifySubscribers(n$$0,"asleep"))},Na:function(){var b=this[t];
b.s&&(b.T||this.Qa())&&this.aa();return a.J.fn.Na.call(this)}};var Z={sa:function(a){"change"!=a&&"beforeChange"!=a||this.t()}};a.a.ka&&a.a.Xa(z$$0,a.J.fn);var P=a.N.hd;a.m[P]=a.N;z$$0[P]=a.m;a.Yc=function(b){return a.Oa(b,a.m)};a.Zc=function(b){return a.Oa(b,a.m)&&b[t]&&b[t].Va};a.b("computed",a.m);a.b("dependentObservable",a.m);a.b("isComputed",a.Yc);a.b("isPureComputed",a.Zc);a.b("computed.fn",z$$0);a.G(z$$0,"peek",z$$0.t);a.G(z$$0,"dispose",z$$0.k);a.G(z$$0,"isActive",z$$0.ba);a.G(z$$0,"getDependenciesCount",
z$$0.Aa);a.pc=function(b,c){if("function"===typeof b)return a.m(b,c,{pure:!0});b=a.a.extend({},b);b.pure=!0;return a.m(b,c)};a.b("pureComputed",a.pc);(function(){function b$$0(a,f,g){g=g||new d$$0;a=f(a);if("object"!=typeof a||null===a||a===n$$0||a instanceof RegExp||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var h=a instanceof Array?[]:{};g.save(a,h);c$$1(a,function(c){var d=f(a[c]);switch(typeof d){case "boolean":case "number":case "string":case "function":h[c]=
d;break;case "object":case "undefined":var k=g.get(d);h[c]=k!==n$$0?k:b$$0(d,f,g)}});return h}function c$$1(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function d$$0(){this.keys=[];this.Jb=[]}a.yc=function(c$$0){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b$$0(c$$0,function(b){for(var c=0;a.H(b)&&10>c;c++)b=b();return b})};a.toJSON=function(b,c,d){b=a.yc(b);return a.a.Eb(b,
c,d)};d$$0.prototype={save:function(b,c){var d=a.a.o(this.keys,b);0<=d?this.Jb[d]=c:(this.keys.push(b),this.Jb.push(c))},get:function(b){b=a.a.o(this.keys,b);return 0<=b?this.Jb[b]:n$$0}}})();a.b("toJS",a.yc);a.b("toJSON",a.toJSON);(function(){a.j={u:function(b){switch(a.a.A(b)){case "option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.xb):7>=a.a.C?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case "select":return 0<=b.selectedIndex?
a.j.u(b.options[b.selectedIndex]):n$$0;default:return b.value}},ha:function(b,c,d){switch(a.a.A(b)){case "option":switch(typeof c){case "string":a.a.e.set(b,a.d.options.xb,n$$0);"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__;b.value=c;break;default:a.a.e.set(b,a.d.options.xb,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"===typeof c?c:""}break;case "select":if(""===c||null===c)c=n$$0;var e=-1;var f=0;var g=b.options.length;for(var h;f<g;++f)if(h=a.j.u(b.options[f]),
h==c||""==h&&c===n$$0){e=f;break}if(d||0<=e||c===n$$0&&1<b.size)b.selectedIndex=e;break;default:if(null===c||c===n$$0)c="";b.value=c}}}})();a.b("selectExtensions",a.j);a.b("selectExtensions.readValue",a.j.u);a.b("selectExtensions.writeValue",a.j.ha);a.h=function(){function b$$0(b){b=a.a.$a(b);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c=[];var d=b.match(e$$1);var r;var h=[];var p=0;if(d){d.push(",");var A=0;for(var y;y=d[A];++A){var v=y.charCodeAt(0);if(44===v){if(0>=p){c.push(r&&h.length?{key:r,
value:h.join("")}:{unknown:r||h.join("")});r=p=0;h=[];continue}}else if(58===v){if(!p&&!r&&1===h.length){r=h.pop();continue}}else 47===v&&A&&1<y.length?(v=d[A-1].match(f$$0))&&!g$$0[v[0]]&&(b=b.substr(b.indexOf(y)+1),d=b.match(e$$1),d.push(","),A=-1,y="/"):40===v||123===v||91===v?++p:41===v||125===v||93===v?--p:r||h.length||34!==v&&39!==v||(y=y.slice(1,-1));h.push(y)}}return c}var c$$0=["true","false","null","undefined"];var d$$0=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;var e$$1=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]",
"g");var f$$0=/[\])"'A-Za-z0-9_$]+$/;var g$$0={"in":1,"return":1,"typeof":1};var h$$0={};return{ta:[],ea:h$$0,yb:b$$0,Ua:function(e$$0,m$$0){function k(b,e){var m;if(!A){var l=a.getBindingHandler(b);if(l&&l.preprocess&&!(e=l.preprocess(e,b,k)))return;if(l=h$$0[b])m=e,0<=a.a.o(c$$0,m)?m=!1:(l=m.match(d$$0),m=null===l?!1:l[1]?"Object("+l[1]+")"+l[2]:m),l=m;l&&g.push("'"+b+"':function(_z){"+m+"\x3d_z}")}p&&(e="function(){return "+e+" }");f.push("'"+b+"':"+e)}m$$0=m$$0||{};var f=[];var g=[];var p=m$$0.valueAccessors;
var A=m$$0.bindingParams;var y="string"===typeof e$$0?b$$0(e$$0):e$$0;a.a.q(y,function(a){k(a.key||a.unknown,a.value)});g.length&&k("_ko_property_writers","{"+g.join(",")+" }");return f.join(",")},bd:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},Ea:function(b,c,d,e,f){if(b&&a.H(b))!a.Ba(b)||f&&b.t()===e||b(e);else if((b=c.get("_ko_property_writers"))&&b[d])b[d](e)}}}();a.b("expressionRewriting",a.h);a.b("expressionRewriting.bindingRewriteValidators",a.h.ta);a.b("expressionRewriting.parseObjectLiteral",
a.h.yb);a.b("expressionRewriting.preProcessBindings",a.h.Ua);a.b("expressionRewriting._twoWayBindings",a.h.ea);a.b("jsonExpressionRewriting",a.h);a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.Ua);(function(){function b$$0(a){return 8==a.nodeType&&g$$0.test(f$$0?a.text:a.nodeValue)}function c$$0(a){return 8==a.nodeType&&h$$0.test(f$$0?a.text:a.nodeValue)}function d$$0(a,d){var e=a;var f=1;for(var l=[];e=e.nextSibling;){if(c$$0(e)&&(f--,0===f))return l;l.push(e);b$$0(e)&&f++}if(!d)throw Error("Cannot find closing comment tag to match: "+
a.nodeValue);return null}function e$$0(a,b){var c=d$$0(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var f$$0=s$$0&&"\x3c!--test--\x3e"===s$$0.createComment("test").text;var g$$0=f$$0?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/;var h$$0=f$$0?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/;var l$$0={ul:!0,ol:!0};a.f={Z:{},childNodes:function(a){return b$$0(a)?d$$0(a):a.childNodes},xa:function(c){if(b$$0(c)){c=a.f.childNodes(c);var d=0;for(var e=c.length;d<
e;d++)a.removeNode(c[d])}else a.a.ob(c)},da:function(c,d){if(b$$0(c)){a.f.xa(c);var e=c.nextSibling;var f=0;for(var l=d.length;f<l;f++)e.parentNode.insertBefore(d[f],e)}else a.a.da(c,d)},oc:function(a,c){b$$0(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},ic:function(c,d,e){e?b$$0(c)?c.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?c.insertBefore(d,e.nextSibling):c.appendChild(d):a.f.oc(c,d)},firstChild:function(a){return b$$0(a)?
!a.nextSibling||c$$0(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){b$$0(a)&&(a=e$$0(a));return a.nextSibling&&c$$0(a.nextSibling)?null:a.nextSibling},Uc:b$$0,qd:function(a){return(a=(f$$0?a.text:a.nodeValue).match(g$$0))?a[1]:null},mc:function(d){if(l$$0[a.a.A(d)]){var k=d.firstChild;if(k){do if(1===k.nodeType){var f;f=k.firstChild;var g=null;if(f){do if(g)g.push(f);else if(b$$0(f)){var h=e$$0(f,!0);h?f=h:g=[f]}else c$$0(f)&&(g=[f]);while(f=f.nextSibling)}if(f=g)for(g=k.nextSibling,
h=0;h<f.length;h++)g?d.insertBefore(f[h],g):d.appendChild(f[h])}while(k=k.nextSibling)}}}}})();a.b("virtualElements",a.f);a.b("virtualElements.allowedBindings",a.f.Z);a.b("virtualElements.emptyNode",a.f.xa);a.b("virtualElements.insertAfter",a.f.ic);a.b("virtualElements.prepend",a.f.oc);a.b("virtualElements.setDomNodeChildren",a.f.da);(function(){a.R=function(){this.Gc={}};a.a.extend(a.R.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);
case 8:return a.f.Uc(b);default:return!1}},getBindings:function(b,c){var d=this.getBindingsString(b,c);d=d?this.parseBindingsString(d,c,b):null;return a.g.Pb(d,b,c,!1)},getBindingAccessors:function(b,c){var d=this.getBindingsString(b,c);d=d?this.parseBindingsString(d,c,b,{valueAccessors:!0}):null;return a.g.Pb(d,b,c,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.qd(b);default:return null}},parseBindingsString:function(b,c,d,e){try{var f=
this.Gc;var g=b+(e&&e.valueAccessors||"");var h;if(!(h=f[g])){var l;var m="with($context){with($data||{}){return{"+a.h.Ua(b,e)+"}}}";l=new Function("$context","$element",m);h=f[g]=l}return h(c,d)}catch(k){throw k.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+k.message,k;}}});a.R.instance=new a.R})();a.b("bindingProvider",a.R);(function(){function b$$2(a){return function(){return a}}function c$$1(a){return a()}function d$$1(b){return a.a.Ca(a.l.w(b),function(a,c){return function(){return b()[c]}})}
function e$$0(c,e,k){return"function"===typeof c?d$$1(c.bind(null,e,k)):a.a.Ca(c,b$$2)}function f$$0(a,b){return d$$1(this.getBindings.bind(this,a,b))}function g$$0(b,c,d){var e;var k=a.f.firstChild(c);var f=a.R.instance;var m=f.preprocessNode;if(m){for(;e=k;)k=a.f.nextSibling(e),m.call(f,e);k=a.f.firstChild(c)}for(;e=k;)k=a.f.nextSibling(e),h$$0(b,e,d)}function h$$0(b,c,d){var e=!0;var k=1===c.nodeType;k&&a.f.mc(c);if(k&&d||a.R.instance.nodeHasBindings(c))e=m$$1(c,null,b,d).shouldBindDescendants;
e&&!r$$0[a.a.A(c)]&&g$$0(b,c,!k)}function l$$0(b){var c$$0=[];var d={};var e=[];a.a.D(b,function X(k){if(!d[k]){var f=a.getBindingHandler(k);f&&(f.after&&(e.push(k),a.a.q(f.after,function(c){if(b[c]){if(-1!==a.a.o(e,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+e.join(", "));X(c)}}),e.length--),c$$0.push({key:k,hc:f}));d[k]=!0}});return c$$0}function m$$1(b,d$$0,e,k$$0){var m$$0=a.a.e.get(b,q);if(!d$$0){if(m$$0)throw Error("You cannot apply bindings multiple times to the same element.");
a.a.e.set(b,q,!0)}!m$$0&&k$$0&&a.vc(b,e);var g;if(d$$0&&"function"!==typeof d$$0)g=d$$0;else{var h=a.R.instance;var r=h.getBindingAccessors||f$$0;var p=a.B(function(){(g=d$$0?d$$0(e,b):r.call(h,b,e))&&e.P&&e.P();return g},null,{i:b});g&&p.ba()||(p=null)}var s;if(g){var u=p?function(a){return function(){return c$$1(p()[a])}}:function(a){return g[a]};var t=function(){return a.a.Ca(p?p():g,c$$1)};t.get=function(a){return g[a]&&c$$1(u(a))};t.has=function(a){return a in g};k$$0=l$$0(g);a.a.q(k$$0,function(c){var d=
c.hc.init;var k=c.hc.update;var f=c.key;if(8===b.nodeType&&!a.f.Z[f])throw Error("The binding '"+f+"' cannot be used with virtual elements");try{"function"==typeof d&&a.l.w(function(){var a=d(b,u(f),t,e.$data,e);if(a&&a.controlsDescendantBindings){if(s!==n$$0)throw Error("Multiple bindings ("+s+" and "+f+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");s=f}}),"function"==typeof k&&a.B(function(){k(b,u(f),t,e.$data,e)},
null,{i:b})}catch(m){throw m.message='Unable to process binding "'+f+": "+g[f]+'"\nMessage: '+m.message,m;}})}return{shouldBindDescendants:s===n$$0}}function k$$1(b){return b&&b instanceof a.Q?b:new a.Q(b)}a.d={};var r$$0={script:!0,textarea:!0,template:!0};a.getBindingHandler=function(b){return a.d[b]};a.Q=function(b$$1,c,d,e,k$$0){function f(){var k=g?b$$1():b$$1;var m=a.a.c(k);c?(c.P&&c.P(),a.a.extend(l,c),l.P=r):(l.$parents=[],l.$root=m,l.ko=a);l.$rawData=k;l.$data=m;d&&(l[d]=m);e&&e(l,c,m);return l.$data}
function m$$0(){return h&&!a.a.Rb(h)}var l=this;var g="function"==typeof b$$1&&!a.H(b$$1);var h;var r;k$$0&&k$$0.exportDependencies?f():(r=a.B(f,null,{wa:m$$0,i:!0}),r.ba()&&(l.P=r,r.equalityComparer=null,h=[],r.Bc=function(b$$0){h.push(b$$0);a.a.F.oa(b$$0,function(b){a.a.La(h,b);h.length||(r.k(),l.P=r=n$$0)})}))};a.Q.prototype.createChildContext=function(b$$0,c,d,e){return new a.Q(b$$0,this,c,function(a,b){a.$parentContext=b;a.$parent=b.$data;a.$parents=(b.$parents||[]).slice(0);a.$parents.unshift(a.$parent);
d&&d(a)},e)};a.Q.prototype.extend=function(b){return new a.Q(this.P||this.$data,this,null,function(c,d){c.$rawData=d.$rawData;a.a.extend(c,"function"==typeof b?b():b)})};a.Q.prototype.Zb=function(a,b){return this.createChildContext(a,b,null,{exportDependencies:!0})};var q=a.a.e.I();var p$$0=a.a.e.I();a.vc=function(b,c){if(2==arguments.length)a.a.e.set(b,p$$0,c),c.P&&c.P.Bc(b);else return a.a.e.get(b,p$$0)};a.Ja=function(b,c,d){1===b.nodeType&&a.f.mc(b);return m$$1(b,c,k$$1(d),!0)};a.Ec=function(b,
c,d){d=k$$1(d);return a.Ja(b,e$$0(c,d,b),d)};a.eb=function(a,b){1!==b.nodeType&&8!==b.nodeType||g$$0(k$$1(a),b,!0)};a.Sb=function(a,b){!u&&x$$0.jQuery&&(u=x$$0.jQuery);if(b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||x$$0.document.body;h$$0(k$$1(a),b,!0)};a.kb=function(b){switch(b.nodeType){case 1:case 8:var c=a.vc(b);if(c)return c;if(b.parentNode)return a.kb(b.parentNode)}return n$$0};a.Kc=
function(b){return(b=a.kb(b))?b.$data:n$$0};a.b("bindingHandlers",a.d);a.b("applyBindings",a.Sb);a.b("applyBindingsToDescendants",a.eb);a.b("applyBindingAccessorsToNode",a.Ja);a.b("applyBindingsToNode",a.Ec);a.b("contextFor",a.kb);a.b("dataFor",a.Kc)})();(function(b$$0){function c$$0(c,e$$0){var m=f$$0.hasOwnProperty(c)?f$$0[c]:b$$0;var k;m?m.X(e$$0):(m=f$$0[c]=new a.J,m.X(e$$0),d$$0(c,function(b,d){var e=!(!d||!d.synchronous);g$$0[c]={definition:b,$c:e};delete f$$0[c];k||e?m.notifySubscribers(b):
a.Y.Wa(function(){m.notifySubscribers(b)})}),k=!0)}function d$$0(a$$0,b){e$$1("getConfig",[a$$0],function(c){c?e$$1("loadComponent",[a$$0,c],function(a){b(a,c)}):b(null,null)})}function e$$1(c,d,f,k){k||(k=a.g.loaders.slice(0));var g=k.shift();if(g){var q=g[c];if(q){var p=!1;if(q.apply(g,d.concat(function(a){p?f(null):null!==a?f(a):e$$1(c,d,f,k)}))!==b$$0&&(p=!0,!g.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");
}else e$$1(c,d,f,k)}else f(null)}var f$$0={};var g$$0={};a.g={get:function(d,e){var f=g$$0.hasOwnProperty(d)?g$$0[d]:b$$0;f?f.$c?a.l.w(function(){e(f.definition)}):a.Y.Wa(function(){e(f.definition)}):c$$0(d,e)},Yb:function(a){delete g$$0[a]},Kb:e$$1};a.g.loaders=[];a.b("components",a.g);a.b("components.get",a.g.get);a.b("components.clearCachedDefinition",a.g.Yb)})();(function(){function b$$0(b,c$$0,d,e){function g(){0===--y&&e(h)}var h={};var y=2;var v=d.template;d=d.viewModel;v?f$$0(c$$0,v,function(c){a.g.Kb("loadTemplate",
[b,c],function(a){h.template=a;g()})}):g();d?f$$0(c$$0,d,function(c){a.g.Kb("loadViewModel",[b,c],function(a){h[l$$0]=a;g()})}):g()}function c$$1(a$$0,b,d){if("function"===typeof b)d(function(a){return new b(a)});else if("function"===typeof b[l$$0])d(b[l$$0]);else if("instance"in b){var e=b.instance;d(function(){return e})}else"viewModel"in b?c$$1(a$$0,b.viewModel,d):a$$0("Unknown viewModel value: "+b)}function d$$0(b){switch(a.a.A(b)){case "script":return a.a.ma(b.text);case "textarea":return a.a.ma(b.value);
case "template":if(e$$0(b.content))return a.a.ua(b.content.childNodes)}return a.a.ua(b.childNodes)}function e$$0(a){return x$$0.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function f$$0(a,b,c){"string"===typeof b.require?O||x$$0.require?(O||x$$0.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function g$$0(a){return function(b){throw Error("Component '"+a+"': "+b);}}var h$$0={};a.g.register=function(b,c){if(!c)throw Error("Invalid configuration for "+
b);if(a.g.ub(b))throw Error("Component "+b+" is already registered");h$$0[b]=c};a.g.ub=function(a){return h$$0.hasOwnProperty(a)};a.g.pd=function(b){delete h$$0[b];a.g.Yb(b)};a.g.ac={getConfig:function(a,b){b(h$$0.hasOwnProperty(a)?h$$0[a]:null)},loadComponent:function(a,c$$0,d){var e=g$$0(a);f$$0(e,c$$0,function(c){b$$0(a,e,c,d)})},loadTemplate:function(b,c,f){b=g$$0(b);if("string"===typeof c)f(a.a.ma(c));else if(c instanceof Array)f(c);else if(e$$0(c))f(a.a.V(c.childNodes));else if(c.element)if(c=
c.element,x$$0.HTMLElement?c instanceof HTMLElement:c&&c.tagName&&1===c.nodeType)f(d$$0(c));else if("string"===typeof c){var l=s$$0.getElementById(c);l?f(d$$0(l)):b("Cannot find element with ID "+c)}else b("Unknown element type: "+c);else b("Unknown template value: "+c)},loadViewModel:function(a,b,d){c$$1(g$$0(a),b,d)}};var l$$0="createViewModel";a.b("components.register",a.g.register);a.b("components.isRegistered",a.g.ub);a.b("components.unregister",a.g.pd);a.b("components.defaultLoader",a.g.ac);
a.g.loaders.push(a.g.ac);a.g.Cc=h$$0})();(function(){function b$$0(b,e$$0){var f=b.getAttribute("params");if(f){f=c$$0.parseBindingsString(f,e$$0,b,{valueAccessors:!0,bindingParams:!0});f=a.a.Ca(f,function(c){return a.m(c,null,{i:b})});var g=a.a.Ca(f,function(c){var e=c.t();return c.ba()?a.m({read:function(){return a.a.c(c())},write:a.Ba(e)&&function(a){c()(a)},i:b}):e});g.hasOwnProperty("$raw")||(g.$raw=f);return g}return{$raw:{}}}a.g.getComponentNameForNode=function(b){var c=a.a.A(b);if(a.g.ub(c)&&
(-1!=c.indexOf("-")||"[object HTMLUnknownElement]"==""+b||8>=a.a.C&&b.tagName===c))return c};a.g.Pb=function(c,e,f,g){if(1===e.nodeType){var h=a.g.getComponentNameForNode(e);if(h){c=c||{};if(c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var l={name:h,params:b$$0(e,f)};c.component=g?function(){return l}:l}}return c};var c$$0=new a.R;9>a.a.C&&(a.g.register=function(a){return function(b){s$$0.createElement(b);return a.apply(this,arguments)}}(a.g.register),
s$$0.createDocumentFragment=function(b){return function(){var c=b();var f=a.g.Cc;for(var g in f)f.hasOwnProperty(g)&&c.createElement(g);return c}}(s$$0.createDocumentFragment))})();(function(b$$0){function c$$0(b,c,d){c=c.template;if(!c)throw Error("Component '"+b+"' has no template");b=a.a.ua(c);a.f.da(d,b)}function d$$0(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var e$$0=0;a.d.component={init:function(f,g,h$$0,l$$1,m){function k(){var a=r&&r.dispose;"function"===
typeof a&&a.call(r);q=r=null}var r;var q;var p=a.a.V(a.f.childNodes(f));a.a.F.oa(f,k);a.m(function(){var l$$0=a.a.c(g());var h;var v;"string"===typeof l$$0?h=l$$0:(h=a.a.c(l$$0.name),v=a.a.c(l$$0.params));if(!h)throw Error("No component name specified");var n=q=++e$$0;a.g.get(h,function(e){if(q===n){k();if(!e)throw Error("Unknown component '"+h+"'");c$$0(h,e,f);var l=d$$0(e,f,p,v);e=m.createChildContext(l,b$$0,function(a){a.$component=l;a.$componentTemplateNodes=p});r=l;a.eb(e,f)}})},null,{i:f});
return{controlsDescendantBindings:!0}}};a.f.Z.component=!0})();var Q={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,c$$0){var d$$0=a.a.c(c$$0())||{};a.a.D(d$$0,function(c,d){d=a.a.c(d);var g=!1===d||null===d||d===n$$0;g&&b.removeAttribute(c);8>=a.a.C&&c in Q?(c=Q[c],g?b.removeAttribute(c):b[c]=d):g||b.setAttribute(c,d.toString());"name"===c&&a.a.tc(b,g?"":d.toString())})}};(function(){a.d.checked={after:["value","attr"],init:function(b,c,d$$0){function e$$0(){var e=b.checked;var f=
p?g():e;if(!a.va.Sa()&&(!l||e)){var h=a.l.w(c);if(k){var m=r?h.t():h;q!==f?(e&&(a.a.pa(m,f,!0),a.a.pa(m,q,!1)),q=f):a.a.pa(m,f,e);r&&a.Ba(h)&&h(m)}else a.h.Ea(h,d$$0,"checked",f,!0)}}function f$$0(){var d=a.a.c(c());b.checked=k?0<=a.a.o(d,g()):h$$0?d:g()===d}var g=a.pc(function(){return d$$0.has("checkedValue")?a.a.c(d$$0.get("checkedValue")):d$$0.has("value")?a.a.c(d$$0.get("value")):b.value});var h$$0="checkbox"==b.type;var l="radio"==b.type;if(h$$0||l){var m$$0=c();var k=h$$0&&a.a.c(m$$0)instanceof
Array;var r=!(k&&m$$0.push&&m$$0.splice);var q=k?g():n$$0;var p=l||k;l&&!b.name&&a.d.uniqueName.init(b,function(){return!0});a.m(e$$0,null,{i:b});a.a.p(b,"click",e$$0);a.m(f$$0,null,{i:b});m$$0=n$$0}}};a.h.ea.checked=!0;a.d.checkedValue={update:function(b,c){b.value=a.a.c(c())}}})();a.d.css={update:function(b,c$$0){var d$$0=a.a.c(c$$0());null!==d$$0&&"object"==typeof d$$0?a.a.D(d$$0,function(c,d){d=a.a.c(d);a.a.bb(b,c,d)}):(d$$0=a.a.$a(String(d$$0||"")),a.a.bb(b,b.__ko__cssValue,!1),b.__ko__cssValue=
d$$0,a.a.bb(b,d$$0,!0))}};a.d.enable={update:function(b,c){var d=a.a.c(c());d&&b.disabled?b.removeAttribute("disabled"):d||b.disabled||(b.disabled=!0)}};a.d.disable={update:function(b,c){a.d.enable.update(b,function(){return!a.a.c(c())})}};a.d.event={init:function(b$$0,c,d,e,f){var g$$0=c()||{};a.a.D(g$$0,function(g){"string"==typeof g&&a.a.p(b$$0,g,function(b){var m;var k=c()[g];if(k){try{var r=a.a.V(arguments);e=f.$data;r.unshift(e);m=k.apply(e,r)}finally{!0!==m&&(b.preventDefault?b.preventDefault():
b.returnValue=!1)}!1===d.get(g+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}};a.d.foreach={kc:function(b){return function(){var c=b();var d=a.a.zb(c);if(!d||"number"==typeof d.length)return{foreach:c,templateEngine:a.W.sb};a.a.c(c);return{foreach:d.data,as:d.as,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:a.W.sb}}},init:function(b,c){return a.d.template.init(b,
a.d.foreach.kc(c))},update:function(b,c,d,e,f){return a.d.template.update(b,a.d.foreach.kc(c),d,e,f)}};a.h.ta.foreach=!1;a.f.Z.foreach=!0;a.d.hasfocus={init:function(b,c,d){function e$$0(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(k){g=f.body}e=g===b}f=c();a.h.Ea(f,d,"hasfocus",e,!0);b.__ko_hasfocusLastValue=e;b.__ko_hasfocusUpdating=!1}var f$$0=e$$0.bind(null,!0);var g$$0=e$$0.bind(null,!1);a.a.p(b,"focus",f$$0);a.a.p(b,"focusin",
f$$0);a.a.p(b,"blur",g$$0);a.a.p(b,"focusout",g$$0)},update:function(b,c){var d=!!a.a.c(c());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===d||(d?b.focus():b.blur(),!d&&b.__ko_hasfocusLastValue&&b.ownerDocument.body.focus(),a.l.w(a.a.Da,null,[b,d?"focusin":"focusout"]))}};a.h.ea.hasfocus=!0;a.d.hasFocus=a.d.hasfocus;a.h.ea.hasFocus=!0;a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Cb(b,c())}};K("if");K("ifnot",!1,!0);K("with",!0,!1,function(a,c){return a.Zb(c)});
var L={};a.d.options={init:function(b){if("select"!==a.a.A(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b$$0,c$$0,d$$0){function e$$0(){return a.a.Ka(b$$0.options,function(a){return a.selected})}function f$$0(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g$$0(c,e){if(A&&k)a.j.ha(b$$0,a.a.c(d$$0.get("value")),!0);else if(p.length){var f=0<=a.a.o(p,a.j.u(e[0]));a.a.uc(e[0],
f);A&&!f&&a.l.w(a.a.Da,null,[b$$0,"change"])}}var h=b$$0.multiple;var l=0!=b$$0.length&&h?b$$0.scrollTop:null;var m=a.a.c(c$$0());var k=d$$0.get("valueAllowUnset")&&d$$0.has("value");var r=d$$0.get("optionsIncludeDestroyed");c$$0={};var q;var p=[];k||(h?p=a.a.fb(e$$0(),a.j.u):0<=b$$0.selectedIndex&&p.push(a.j.u(b$$0.options[b$$0.selectedIndex])));m&&("undefined"==typeof m.length&&(m=[m]),q=a.a.Ka(m,function(b){return r||b===n$$0||null===b||!a.a.c(b._destroy)}),d$$0.has("optionsCaption")&&(m=a.a.c(d$$0.get("optionsCaption")),
null!==m&&m!==n$$0&&q.unshift(L)));var A=!1;c$$0.beforeRemove=function(a){b$$0.removeChild(a)};m=g$$0;d$$0.has("optionsAfterRender")&&"function"==typeof d$$0.get("optionsAfterRender")&&(m=function(b,c){g$$0(0,c);a.l.w(d$$0.get("optionsAfterRender"),null,[c[0],b!==L?b:n$$0])});a.a.Bb(b$$0,q,function(c,e,g){g.length&&(p=!k&&g[0].selected?[a.j.u(g[0])]:[],A=!0);e=b$$0.ownerDocument.createElement("option");c===L?(a.a.Za(e,d$$0.get("optionsCaption")),a.j.ha(e,n$$0)):(g=f$$0(c,d$$0.get("optionsValue"),
c),a.j.ha(e,a.a.c(g)),c=f$$0(c,d$$0.get("optionsText"),g),a.a.Za(e,c));return[e]},c$$0,m);a.l.w(function(){k?a.j.ha(b$$0,a.a.c(d$$0.get("value")),!0):(h?p.length&&e$$0().length<p.length:p.length&&0<=b$$0.selectedIndex?a.j.u(b$$0.options[b$$0.selectedIndex])!==p[0]:p.length||0<=b$$0.selectedIndex)&&a.a.Da(b$$0,"change")});a.a.Oc(b$$0);l&&20<Math.abs(l-b$$0.scrollTop)&&(b$$0.scrollTop=l)}};a.d.options.xb=a.a.e.I();a.d.selectedOptions={after:["options","foreach"],init:function(b$$0,c,d){a.a.p(b$$0,"change",
function(){var e=c();var f=[];a.a.q(b$$0.getElementsByTagName("option"),function(b){b.selected&&f.push(a.j.u(b))});a.h.Ea(e,d,"selectedOptions",f)})},update:function(b$$0,c$$0){if("select"!=a.a.A(b$$0))throw Error("values binding applies only to SELECT elements");var d=a.a.c(c$$0());var e=b$$0.scrollTop;d&&"number"==typeof d.length&&a.a.q(b$$0.getElementsByTagName("option"),function(b){var c=0<=a.a.o(d,a.j.u(b));b.selected!=c&&a.a.uc(b,c)});b$$0.scrollTop=e}};a.h.ea.selectedOptions=!0;a.d.style={update:function(b,
c$$0){var d$$0=a.a.c(c$$0()||{});a.a.D(d$$0,function(c,d){d=a.a.c(d);if(null===d||d===n$$0||!1===d)d="";b.style[c]=d})}};a.d.submit={init:function(b,c,d$$0,e$$0,f){if("function"!=typeof c())throw Error("The value for a submit binding must be a function");a.a.p(b,"submit",function(a){var d;var e=c();try{d=e.call(f.$data,b)}finally{!0!==d&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}};a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Za(b,c())}};
a.f.Z.text=!0;(function(){if(x$$0&&x$$0.navigator){var b$$0=function(a){if(a)return parseFloat(a[1])};var c$$0=x$$0.opera&&x$$0.opera.version&&parseInt(x$$0.opera.version());var d$$1=x$$0.navigator.userAgent;var e=b$$0(d$$1.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i));var f=b$$0(d$$1.match(/Firefox\/([^ ]*)/))}if(10>a.a.C){var g$$0=a.a.e.I();var h$$0=a.a.e.I();var l$$0=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,h$$0))&&c(b)};var m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,
g$$0)||(a.a.e.set(d,g$$0,!0),a.a.p(d,"selectionchange",l$$0));a.a.e.set(b,h$$0,c)}}a.d.textInput={init:function(b,d$$0,g){function l(c,d){a.a.p(b,c,d)}function h(){var c=a.a.c(d$$0());if(null===c||c===n$$0)c="";u!==n$$0&&c===u?a.a.setTimeout(h,4):b.value!==c&&(s=c,b.value=c)}function y(){t||(u=b.value,t=a.a.setTimeout(v,4))}function v(){clearTimeout(t);u=t=n$$0;var c=b.value;s!==c&&(s=c,a.h.Ea(d$$0(),g,"textInput",c))}var s=b.value;var t;var u;var x=9==a.a.C?y:v;10>a.a.C?(l("propertychange",function(a){"value"===
a.propertyName&&x(a)}),8==a.a.C&&(l("keyup",v),l("keydown",v)),8<=a.a.C&&(m(b,x),l("dragend",y))):(l("input",v),5>e&&"textarea"===a.a.A(b)?(l("keydown",y),l("paste",y),l("cut",y)):11>c$$0?l("keydown",y):4>f&&(l("DOMAutoComplete",v),l("dragdrop",v),l("drop",v)));l("change",v);a.m(h,null,{i:b})}};a.h.ea.textInput=!0;a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}})();a.d.uniqueName={init:function(b,c){if(c()){var d="ko_unique_"+ ++a.d.uniqueName.Jc;a.a.tc(b,d)}}};a.d.uniqueName.Jc=0;a.d.value=
{after:["options","foreach"],init:function(b,c$$0,d$$0){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e$$0=["change"];var f$$0=d$$0.get("valueUpdate");var g$$0=!1;var h=null;f$$0&&("string"==typeof f$$0&&(f$$0=[f$$0]),a.a.ra(e$$0,f$$0),e$$0=a.a.Ub(e$$0));var l=function(){h=null;g$$0=!1;var e=c$$0();var f=a.j.u(b);a.h.Ea(e,d$$0,"value",f)};!a.a.C||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.o(e$$0,
"propertychange")||(a.a.p(b,"propertychange",function(){g$$0=!0}),a.a.p(b,"focus",function(){g$$0=!1}),a.a.p(b,"blur",function(){g$$0&&l()}));a.a.q(e$$0,function(c){var d=l;a.a.od(c,"after")&&(d=function(){h=a.j.u(b);a.a.setTimeout(l,0)},c=c.substring(5));a.a.p(b,c,d)});var m=function(){var e=a.a.c(c$$0());var f=a.j.u(b);if(null!==h&&e===h)a.a.setTimeout(m,0);else if(e!==f)if("select"===a.a.A(b)){var g=d$$0.get("valueAllowUnset");f=function(){a.j.ha(b,e,g)};f();g||e===a.j.u(b)?a.a.setTimeout(f,0):
a.l.w(a.a.Da,null,[b,"change"])}else a.j.ha(b,e)};a.m(m,null,{i:b})}else a.Ja(b,{checkedValue:c$$0})},update:function(){}};a.h.ea.value=!0;a.d.visible={update:function(b,c){var d=a.a.c(c());var e="none"!=b.style.display;d&&!e?b.style.display="":!d&&e&&(b.style.display="none")}};(function(b){a.d[b]={init:function(c,d,e,f,g){return a.d.event.init.call(this,c,function(){var a={};a[b]=d();return a},e,f,g)}}})("click");a.O=function(){};a.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");
};a.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};a.O.prototype.makeTemplateSource=function(b,c){if("string"==typeof b){c=c||s$$0;var d=c.getElementById(b);if(!d)throw Error("Cannot find template with ID "+b);return new a.v.n(d)}if(1==b.nodeType||8==b.nodeType)return new a.v.qa(b);throw Error("Unknown template type: "+b);};a.O.prototype.renderTemplate=function(a,c,d,e){a=this.makeTemplateSource(a,e);return this.renderTemplateSource(a,
c,d,e)};a.O.prototype.isTemplateRewritten=function(a,c){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,c).data("isRewritten")};a.O.prototype.rewriteTemplate=function(a,c,d){a=this.makeTemplateSource(a,d);c=c(a.text());a.text(c);a.data("isRewritten",!0)};a.b("templateEngine",a.O);a.Gb=function(){function b$$1(b,c,d,h){b=a.h.yb(b);var l=a.h.ta;for(var m=0;m<b.length;m++){var k=b[m].key;if(l.hasOwnProperty(k)){var r=l[k];if("function"===typeof r){if(k=r(b[m].value))throw Error(k);
}else if(!r)throw Error("This template engine does not support the '"+k+"' binding within its templates");}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.Ua(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')";return h.createJavaScriptEvaluatorBlock(d)+c}var c$$0=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi;var d$$0=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Pc:function(b$$0,
c,d){c.isTemplateRewritten(b$$0,d)||c.rewriteTemplate(b$$0,function(b){return a.Gb.ed(b,c)},d)},ed:function(a$$0,f){return a$$0.replace(c$$0,function(a,c,d,e,k){return b$$1(k,c,d,f)}).replace(d$$0,function(a,c){return b$$1(c,"\x3c!-- ko --\x3e","#comment",f)})},Fc:function(b,c){return a.M.wb(function(d,h){var l=d.nextSibling;l&&l.nodeName.toLowerCase()===c&&a.Ja(l,b,h)})}}}();a.b("__tr_ambtns",a.Gb.Fc);(function(){a.v={};a.v.n=function(b){if(this.n=b){var c=a.a.A(b);this.ab="script"===c?1:"textarea"===
c?2:"template"==c&&b.content&&11===b.content.nodeType?3:4}};a.v.n.prototype.text=function(){var b=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[b];var c=arguments[0];"innerHTML"===b?a.a.Cb(this.n,c):this.n[b]=c};var b$$0=a.a.e.I()+"_";a.v.n.prototype.data=function(c){if(1===arguments.length)return a.a.e.get(this.n,b$$0+c);a.a.e.set(this.n,b$$0+c,arguments[1])};var c$$0=a.a.e.I();a.v.n.prototype.nodes=function(){var b=this.n;if(0==arguments.length)return(a.a.e.get(b,
c$$0)||{}).jb||(3===this.ab?b.content:4===this.ab?b:n$$0);a.a.e.set(b,c$$0,{jb:arguments[0]})};a.v.qa=function(a){this.n=a};a.v.qa.prototype=new a.v.n;a.v.qa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.n,c$$0)||{};b.Hb===n$$0&&b.jb&&(b.Hb=b.jb.innerHTML);return b.Hb}a.a.e.set(this.n,c$$0,{Hb:arguments[0]})};a.b("templateSources",a.v);a.b("templateSources.domElement",a.v.n);a.b("templateSources.anonymousTemplate",a.v.qa)})();(function(){function b$$2(b,c,d){var e;for(c=a.f.nextSibling(c);b&&
(e=b)!==c;)b=a.f.nextSibling(e),d(e,b)}function c$$1(c$$0,d$$0){if(c$$0.length){var e=c$$0[0];var f=c$$0[c$$0.length-1];var g=e.parentNode;var h=a.R.instance;var n=h.preprocessNode;if(n){b$$2(e,f,function(a,b){var c=a.previousSibling;var d=n.call(h,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))});c$$0.length=0;if(!e)return;e===f?c$$0.push(e):(c$$0.push(e,f),a.a.za(c$$0,g))}b$$2(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.Sb(d$$0,b)});b$$2(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||
a.M.Ac(b,[d$$0])});a.a.za(c$$0,g)}}function d$$1(a){return a.nodeType?a:0<a.length?a[0]:null}function e$$0(b,e,f,h,q){q=q||{};var p=(b&&d$$1(b)||f||{}).ownerDocument;var n=q.templateEngine||g$$0;a.Gb.Pc(f,n,p);f=n.renderTemplate(f,h,q,p);if("number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");p=!1;switch(e){case "replaceChildren":a.f.da(b,f);p=!0;break;case "replaceNode":a.a.sc(b,f);p=!0;break;case "ignoreTargetNode":break;
default:throw Error("Unknown renderMode: "+e);}p&&(c$$1(f,h),q.afterRender&&a.l.w(q.afterRender,null,[f,h.$data]));return f}function f$$0(b,c,d){return a.H(b)?b():"function"===typeof b?b(c,d):b}var g$$0;a.Db=function(b){if(b!=n$$0&&!(b instanceof a.O))throw Error("templateEngine must inherit from ko.templateEngine");g$$0=b};a.Ab=function(b,c,k,h,q){k=k||{};if((k.templateEngine||g$$0)==n$$0)throw Error("Set a template engine before calling renderTemplate");q=q||"replaceChildren";if(h){var p=d$$1(h);
return a.B(function(){var g=c&&c instanceof a.Q?c:new a.Q(c,null,null,null,{exportDependencies:!0});var n=f$$0(b,g.$data,g);g=e$$0(h,q,n,g,k);"replaceNode"==q&&(h=g,p=d$$1(h))},null,{wa:function(){return!p||!a.a.nb(p)},i:p&&"replaceNode"==q?p.parentNode:p})}return a.M.wb(function(d){a.Ab(b,c,k,d,"replaceNode")})};a.ld=function(b$$1,d$$0,g,h,q){function p(a,b){c$$1(b,t);g.afterRender&&g.afterRender(b,a);t=null}function s(a$$0,c){t=q.createChildContext(a$$0,g.as,function(a){a.$index=c});var d=f$$0(b$$1,
a$$0,t);return e$$0(null,"ignoreTargetNode",d,t,g)}var t;return a.B(function(){var b$$0=a.a.c(d$$0)||[];"undefined"==typeof b$$0.length&&(b$$0=[b$$0]);b$$0=a.a.Ka(b$$0,function(b){return g.includeDestroyed||b===n$$0||null===b||!a.a.c(b._destroy)});a.l.w(a.a.Bb,null,[h,b$$0,s,g,p])},null,{i:h})};var h$$0=a.a.e.I();a.d.template={init:function(b,c){var d=a.a.c(c());if("string"==typeof d||d.name)a.f.xa(b);else{if("nodes"in d){if(d=d.nodes||[],a.H(d))throw Error('The "nodes" option must be a plain, non-observable array.');
}else d=a.f.childNodes(b);d=a.a.lc(d);(new a.v.qa(b)).nodes(d)}return{controlsDescendantBindings:!0}},update:function(b,c,d,e,f){var g=c();c=a.a.c(g);d=!0;e=null;"string"==typeof c?c={}:(g=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in c&&(d=!a.a.c(c.ifnot)));"foreach"in c?e=a.ld(g||b,d&&c.foreach||[],c,b,f):d?(f="data"in c?f.Zb(c.data,c.as):f,e=a.Ab(g||b,f,c,b)):a.f.xa(b);f=e;(c=a.a.e.get(b,h$$0))&&"function"==typeof c.k&&c.k();a.a.e.set(b,h$$0,f&&f.ba()?f:n$$0)}};a.h.ta.template=function(b){b=
a.h.yb(b);return 1==b.length&&b[0].unknown||a.h.bd(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"};a.f.Z.template=!0})();a.b("setTemplateEngine",a.Db);a.b("renderTemplate",a.Ab);a.a.fc=function(a,c,d){if(a.length&&c.length){var e;var f;var g;var h;var l;for(e=f=0;(!d||e<d)&&(h=a[f]);++f){for(g=0;l=c[g];++g)if(h.value===l.value){h.moved=l.index;l.moved=h.index;c.splice(g,1);e=g=0;break}e+=g}}};a.a.ib=function(){function b$$0(b,d,e,f,g){var h=
Math.min;var l=Math.max;var m=[];var k;var n=b.length;var q;var p=d.length;var s=p-n||1;var t=n+p+1;var v;var u;var x;for(k=0;k<=n;k++)for(u=v,m.push(v=[]),x=h(p,k+s),q=l(0,k-1);q<=x;q++)v[q]=q?k?b[k-1]===d[q-1]?u[q-1]:h(u[q]||t,v[q-1]||t)+1:q+1:k+1;h=[];l=[];s=[];k=n;for(q=p;k||q;)p=m[k][q]-1,q&&p===m[k][q-1]?l.push(h[h.length]={status:e,value:d[--q],index:q}):k&&p===m[k-1][q]?s.push(h[h.length]={status:f,value:b[--k],index:k}):(--q,--k,g.sparse||h.push({status:"retained",value:d[q]}));a.a.fc(s,
l,!g.dontLimitMoves&&10*n);return h.reverse()}return function(a,d,e){e="boolean"===typeof e?{dontLimitMoves:e}:e||{};a=a||[];d=d||[];return a.length<d.length?b$$0(a,d,"added","deleted",e):b$$0(d,a,"deleted","added",e)}}();a.b("utils.compareArrays",a.a.ib);(function(){function b$$0(b,c,d,h,l){var m=[];var k$$0=a.B(function(){var k=c(d,l,a.a.za(m,b))||[];0<m.length&&(a.a.sc(m,k),h&&a.l.w(h,null,[d,k,l]));m.length=0;a.a.ra(m,k)},null,{i:b,wa:function(){return!a.a.Rb(m)}});return{ca:m,B:k$$0.ba()?k$$0:
n$$0}}var c$$0=a.a.e.I();var d$$0=a.a.e.I();a.a.Bb=function(e$$0,f,g,h,l){function m(b,c){w=q[c];u!==c&&(D[b]=w);w.qb(u++);a.a.za(w.ca,e$$0);t.push(w);z.push(w)}function k(b,c){if(b){var d=0;for(var e=c.length;d<e;d++)c[d]&&a.a.q(c[d].ca,function(a){b(a,d,c[d].ja)})}}f=f||[];h=h||{};var r=a.a.e.get(e$$0,c$$0)===n$$0;var q=a.a.e.get(e$$0,c$$0)||[];var p=a.a.fb(q,function(a){return a.ja});var s=a.a.ib(p,f,h.dontLimitMoves);var t=[];var v=0;var u=0;var x=[];var z=[];f=[];var D=[];p=[];var w;var C=0;
var B;for(var E;B=s[C];C++)switch(E=B.moved,B.status){case "deleted":E===n$$0&&(w=q[v],w.B&&(w.B.k(),w.B=n$$0),a.a.za(w.ca,e$$0).length&&(h.beforeRemove&&(t.push(w),z.push(w),w.ja===d$$0?w=null:f[C]=w),w&&x.push.apply(x,w.ca)));v++;break;case "retained":m(C,v++);break;case "added":E!==n$$0?m(C,E):(w={ja:B.value,qb:a.N(u++)},t.push(w),z.push(w),r||(p[C]=w))}a.a.e.set(e$$0,c$$0,t);k(h.beforeMove,D);a.a.q(x,h.beforeRemove?a.$:a.removeNode);C=0;r=a.f.firstChild(e$$0);for(var F;w=z[C];C++){w.ca||a.a.extend(w,
b$$0(e$$0,g,w.ja,l,w.qb));for(v=0;s=w.ca[v];r=s.nextSibling,F=s,v++)s!==r&&a.f.ic(e$$0,s,F);!w.Xc&&l&&(l(w.ja,w.ca,w.qb),w.Xc=!0)}k(h.beforeRemove,f);for(C=0;C<f.length;++C)f[C]&&(f[C].ja=d$$0);k(h.afterMove,D);k(h.afterAdd,p)}})();a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Bb);a.W=function(){this.allowTemplateRewriting=!1};a.W.prototype=new a.O;a.W.prototype.renderTemplateSource=function(b,c,d,e){if(c=(9>a.a.C?0:b.nodes)?b.nodes():null)return a.a.V(c.cloneNode(!0).childNodes);b=b.text();
return a.a.ma(b,e)};a.W.sb=new a.W;a.Db(a.W.sb);a.b("nativeTemplateEngine",a.W);(function(){a.vb=function(){var a$$0=this.ad=function(){if(!u||!u.tmpl)return 0;try{if(0<=u.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,f,g){g=g||s$$0;f=f||{};if(2>a$$0)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var h=b.data("precompiled");h||(h=b.text()||"",h=u.template(null,"{{ko_with $item.koBindingContext}}"+
h+"{{/ko_with}}"),b.data("precompiled",h));b=[e.$data];e=u.extend({koBindingContext:e},f.templateOptions);e=u.tmpl(h,b,e);e.appendTo(g.createElement("div"));u.fragments={};return e};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"};this.addTemplate=function(a,b){s$$0.write("\x3cscript type\x3d'text/html' id\x3d'"+a+"'\x3e"+b+"\x3c/script\x3e")};0<a$$0&&(u.tmpl.tag.ko_code={open:"__.push($1 || '');"},u.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};
a.vb.prototype=new a.O;var b$$0=new a.vb;0<b$$0.ad&&a.Db(b$$0);a.b("jqueryTmplTemplateEngine",a.vb)})()})})()})();
(function(a$$0,b$$1,c$$0){var d$$0="ko_sortItem";var e$$0="ko_sortList";var f$$0="ko_parentList";var g$$1=function(b$$0,c){a$$0.utils.arrayForEach(b$$0,function(b){b.nodeType===1&&(a$$0.utils.domData.set(b,d$$0,c),a$$0.utils.domData.set(b,f$$0,a$$0.utils.domData.get(b.parentNode,e$$0)))})};var h$$0=function(b$$0){var c={};var d=a$$0.utils.unwrapObservable(b$$0());var e;return d.data?(c.foreach=d.data,c.name=d.template):c.foreach=b$$0(),a$$0.utils.arrayForEach(["afterAdd","afterRender","beforeRemove",
"includeDestroyed","templateEngine","templateOptions"],function(b){c[b]=d[b]||a$$0.bindingHandlers.sortable[b]}),c.afterRender?(e=c.afterRender,c.afterRender=function(a,b){g$$1.call(b,a,b),e.call(b,a,b)}):c.afterRender=g$$1,c};a$$0.bindingHandlers.sortable={init:function(g$$0,i$$0,j,k$$0,l$$0){var m$$0=b$$1(g$$0);var n=a$$0.utils.unwrapObservable(i$$0())||{};var o=h$$0(i$$0);var p={};var q;var r;return a$$0.utils.arrayForEach(g$$0.childNodes,function(a){a&&a.nodeType===3&&a.parentNode.removeChild(a)}),
b$$1.extend(!0,p,a$$0.bindingHandlers.sortable),n.options&&p.options&&(a$$0.utils.extend(p.options,n.options),delete n.options),a$$0.utils.extend(p,n),p.connectClass&&(a$$0.isObservable(p.allowDrop)||typeof p.allowDrop=="function")?a$$0.computed({read:function(){var b=a$$0.utils.unwrapObservable(p.allowDrop);var c=typeof b=="function"?b.call(this,o.foreach):b;a$$0.utils.toggleDomNodeCssClass(g$$0,p.connectClass,c)},disposeWhenNodeIsRemoved:g$$0},this):a$$0.utils.toggleDomNodeCssClass(g$$0,p.connectClass,
p.allowDrop),a$$0.bindingHandlers.template.init(g$$0,function(){return o},j,k$$0,l$$0),q=p.options.start,r=p.options.update,setTimeout(function(){m$$0.sortable(a$$0.utils.extend(p.options,{start:function(a,b){b.item.find("input:focus").change(),q&&q.apply(this,arguments)},update:function(c,g){var h;var i;var j;var k;var l=g.item[0];var m=a$$0.utils.domData.get(l,d$$0);if(m){h=a$$0.utils.domData.get(l,f$$0),i=a$$0.utils.domData.get(l.parentNode,e$$0),j=a$$0.utils.arrayIndexOf(g.item.parent().children(),
l);if(p.beforeMove||p.afterMove)k={item:m,sourceParent:h,sourceParentNode:l.parentNode,sourceIndex:h.indexOf(m),targetParent:i,targetIndex:j,cancelDrop:!1};if(p.beforeMove){p.beforeMove.call(this,k,c,g);if(k.cancelDrop){b$$1(k.sourceParent===k.targetParent?this:g.sender).sortable("cancel");return}}j>=0&&(h.remove(m),i.splice(j,0,m)),a$$0.utils.domData.set(l,d$$0,null),g.item.remove(),p.afterMove&&p.afterMove.call(this,k,c,g)}r&&r.apply(this,arguments)},connectWith:p.connectClass?"."+p.connectClass:
!1})),p.isEnabled!==c$$0&&a$$0.computed({read:function(){m$$0.sortable(a$$0.utils.unwrapObservable(p.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:g$$0})},0),a$$0.utils.domNodeDisposal.addDisposeCallback(g$$0,function(){m$$0.sortable("destroy")}),{controlsDescendantBindings:!0}},update:function(b,c,d,f,g){var i=h$$0(c);a$$0.utils.domData.set(b,e$$0,i.foreach),a$$0.bindingHandlers.template.update(b,function(){return i},d,f,g)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,
options:{}}})(ko,jQuery);
(function(b,k){"function"===typeof define&&define.amd?define(["knockout"],k):k(b.ko)})(this,function(b$$0){function k$$0(a,f){var c=m(f.$switchValueAccessor());return"boolean"==typeof c?a?c:!c:"boolean"==typeof a?a:a instanceof Array?-1!==b$$0.utils.arrayIndexOf(a,c):a==c}function v(a,b){return!k$$0(a,b)}function w(a){return function(){return a}}function h$$0(a$$0,f$$1,c$$0){var n$$0=f$$1?v:k$$0;a$$0||(a$$0="if");c$$0||(c$$0=w);return{flags:d$$0[a$$0].flags,init:function(f$$0,g,l,x,e){if(!e.$switchSkipNextArray)throw Error("case binding must only be used with a switch binding");
if(e.$switchIndex!==p)throw Error("case binding cannot be nested");e.$switchIndex=e.$switchSkipNextArray.push(b$$0.observable(!1))-1;e.$caseValue=b$$0.observable();b$$0.computed(function(){var a=e.$switchIndex;var b=a===e.$switchSkipNextArray.length-1;var c;var f;var d;a&&e.$switchSkipNextArray[a-1]()?(c=!1,f=!0):(c=m(g()),c===e.$else?(c=e.$switchDefault()||b,f=!1):d=f=c=n$$0(c,e));e.$caseValue(c);e.$switchSkipNextArray[a](f);d?e.$switchDefault(!1):!f&&b&&e.$switchDefault(!0)},null,{disposeWhenNodeIsRemoved:f$$0});
if(d$$0[a$$0].init)return d$$0[a$$0].init(f$$0,c$$0(e.$caseValue),l,x,e)},update:function(b,f,g,n,e){if(d$$0[a$$0].update)return d$$0[a$$0].update(b,c$$0(e.$caseValue),g,n,e)}}}function r(a,b,c){g$$0.allowedBindings[a]&&(g$$0.allowedBindings[c]=!0);return h$$0(a,"casenot"===b)}function y(a,b,c){return r(b,a,c)}function s(a,b){d$$0[a]=h$$0("if",b);t[a]=!1;g$$0.allowedBindings[a]=!0;d$$0[a].makeSubkeyHandler=y;d$$0[a].getNamespacedHandler=r}var p;if(!b$$0.virtualElements)throw Error("Switch-case requires at least Knockout 2.1");
var g$$0=b$$0.virtualElements;var q=b$$0.bindingFlags||{};var t=b$$0.bindingRewriteValidators||b$$0.jsonExpressionRewriting.bindingRewriteValidators;var m=b$$0.utils.unwrapObservable;var d$$0=b$$0.bindingHandlers;var u={};d$$0["switch"]={flags:q.contentBind|q.canUseVirtual|q.noValue,init:function(a$$0,f,c,d,k){var h={$switchSkipNextArray:[],$switchValueAccessor:f,$switchDefault:b$$0.observable(!0),$default:u,$else:u};var l=[];b$$0.computed(function(){var a=m(f());h.$value=a;b$$0.utils.arrayForEach(l,
function(b){b.$value=a})},null,{disposeWhenNodeIsRemoved:a$$0});for(c=g$$0.firstChild(a$$0);a$$0=c;)switch(c=g$$0.nextSibling(a$$0),a$$0.nodeType){case 1:case 8:d=k.extend(h),d.$switchIndex=p,b$$0.applyBindings(d,a$$0),d.$switchIndex!==p&&l.push(d)}return{controlsDescendantBindings:!0}},preprocess:function(a){return a||"true"}};t["switch"]=!1;g$$0.allowedBindings["switch"]=!0;s("case");s("casenot",!0);d$$0["case.visible"]=h$$0("visible");d$$0["casenot.visible"]=h$$0("visible",!0);d$$0["switch"].makeCaseHandler=
h$$0});
(function(window,ko){function doAnimateVisibleUpdate(element,value,allBindings){var animation=ko.utils.unwrapObservable(allBindings.animationType)||"fade";var speed=ko.utils.unwrapObservable(allBindings.animationSpeed)||"fast";var inspeed=ko.utils.unwrapObservable(allBindings.inSpeed);var outspeed=ko.utils.unwrapObservable(allBindings.outSpeed);var completeCallback=ko.utils.unwrapObservable(allBindings.afterAnimateVisible);if(inspeed===undefined)inspeed=speed;if(outspeed===undefined)outspeed=speed;
speed=value?inspeed:outspeed;if(speed==="fast")speed=150;else if(speed==="slow")speed=400;switch(animation){case "fade":if(value)$(element).fadeIn(speed,completeCallback);else $(element).fadeOut(speed,completeCallback);break;case "slide":$(element).slideToggleBool(!!value,speed,null,completeCallback);break;case "toggle":if(value)$(element).show(speed,completeCallback);else $(element).hide(speed,completeCallback);break;default:throw"Unknown animation type "+animation;}}function getErrorBubble(element){var $element=
$(element);return $element.nextAll(".error-bubble").eq(0)}function updateErrorBubble(element,valueAccessor,animate){var error=ko.utils.unwrapObservable(valueAccessor());var $element=$(element);var $bubble=getErrorBubble($element);if(error){$bubble.find(".message").text(error);if(animate)$bubble.fadeIn("fast");else $bubble.show()}else if(animate)$bubble.fadeOut("fast");else $bubble.hide();$element.toggleClass("error",!!error)}if(window._knockout_utils_has_been_initialized_already){Log.error("FIXME: _knockout_utils_has_been_initialized_already is already true, which means knockout is going to be re-initialized, which means knockout dependency tracking will be broken in some situations");
if(window.isDebug)window.alert("FIXME: knockout being loaded more than once. Check your js_bundles.")}window._knockout_utils_has_been_initialized_already=true;ko.extenders.float=function(target,options){return ko.computed({read:function(){return"undefined"===typeof target()||target()===null?target():parseFloat(target())},write:target})};ko.extenders.integer=function(target,options){return ko.computed({read:function(){return parseInt(target()||0)},write:target})};ko.extenders.price=function(target,
options){var currency=options.currency;var numericOnly=options.numericOnly;var informal=options.informal;var terse=options.terse;if(!currency&&"CurrencyData"in window)currency=window.CurrencyData.current;return ko.computed({read:function(){var val=target();var currencyUnwrapped=ko.utils.unwrapObservable(currency);var num=val;if(typeof val==="string"){val=$.trim(val);if(val.search(/^\d*,\d{0,2}$/)===0)val=val.replace(",",".");num=parseFloat(val)}if(typeof num==="number"&&!isNaN(num))return Text.unescapeHtml(TextFormat.currency(num,
currencyUnwrapped,numericOnly,informal,terse));else return val},write:target})};ko.extenders.date=function(target,ignored){var fourDigitYear=true;var utc=true;return ko.computed({read:function(){var val=target();var date=val;if(typeof val==="string")date=Time.strToDate(val);if(date)return Time.toUiDate(date,fourDigitYear,utc);else return val},write:function(newValue){var date=Time.strToDate(newValue);target(date||newValue)}})};ko.extenders.liquidFilters=function(target,options){return ko.computed({read:function(){var newValue=
target();if(newValue){Iter.each(options,function(element){if(element instanceof Object){var newArgs=[newValue];if(element.args!==undefined)newArgs=newArgs.concat(element.args);newValue=Templ.filters[element.name].apply(this,newArgs)}else newValue=Templ.filters[element](newValue)});return newValue}},write:target})};ko.extenders.httpURL=function(target,options){var result=ko.computed({read:target,write:function(newValue){newValue=$.trim(newValue);if(newValue&&!newValue.match(/^\w+:\/\//))target("http://"+
newValue);else target(newValue)}});result(target());return result};ko.extenders.min=function(target,options){return ko.computed({read:function(){var min=ko.utils.unwrapObservable(options);return Math.max(min,target())},write:target})};ko.extenders.max=function(target,options){return ko.computed({read:function(){var max=ko.utils.unwrapObservable(options);return Math.min(max,target())},write:target})};ko.extenders.numbersOnly=function(target,options){var maxLength=options.maxLength;var acceptFullYear=
options.acceptFullYear;target.subscribe(function(newValue){var inputValue;var filteredValue;var truncatedValue;if(newValue===undefined||newValue==="")return;inputValue=newValue;if(acceptFullYear&&/(19|20)\d\d/.test(newValue))inputValue=inputValue.slice(2,4);filteredValue=inputValue.replace(/\D+/,"");truncatedValue=maxLength?filteredValue.slice(0,maxLength):filteredValue;if(truncatedValue!==newValue)target(truncatedValue)})};ko.extenders.creditCardNumber=function(target,options){target.formatted=ko.computed({read:function(){var val=
target();return val?val.slice(0,16).match(/.{1,4}/g).join(" "):""},write:function(newValue){var current=target();var strippedValue=newValue.replace(/\D+/g,"");var valueToWrite=strippedValue.slice(0,16);if(valueToWrite!==current)target(valueToWrite);else if(valueToWrite!==strippedValue)target.formatted.notifySubscribers(valueToWrite)}});return target};ko.extenders.maxLength=function(target,maxLength){var view=ko.dependentObservable({read:target,write:function(value){if(value.length<=maxLength)target(value);
else view.notifySubscribers(target())}});target.view=view;target.maxLength=maxLength;return target};ko.bindingHandlers.pluralize={init:function(element,valueAccessor,allBindingsAccessor){var allBindings=allBindingsAccessor();if(!("singleText"in allBindings))$(element).data("ko-utils-pluralizeText-singular",$(element).text())},update:function(element,valueAccessor,allBindingsAccessor){var value=ko.utils.unwrapObservable(valueAccessor());var allBindings=allBindingsAccessor();var singleText="singleText"in
allBindings?ko.utils.unwrapObservable(allBindings.singleText):$(element).data("ko-utils-pluralizeText-singular");var pluralText=ko.utils.unwrapObservable(allBindings.pluralText)||singleText+"s";$(element).text(value===1?singleText:pluralText)}};ko.bindingHandlers.animateVisible={init:function(element,valueAccessor,allBindingsAccessor){var value=ko.utils.unwrapObservable(valueAccessor());$(element).css("display",value?null:"none")},update:function(element,valueAccessor,allBindingsAccessor){var value=
ko.utils.unwrapObservable(valueAccessor());doAnimateVisibleUpdate(element,value,allBindingsAccessor())}};ko.bindingHandlers.animateText={init:function(element,valueAccessor,allBindingsAccessor){var value=ko.utils.unwrapObservable(valueAccessor());$(element).css("display",value?null:"none").text(value)},update:function(element,valueAccessor,allBindingsAccessor){var value=ko.utils.unwrapObservable(valueAccessor());if(value)$(element).text(value);doAnimateVisibleUpdate(element,value,allBindingsAccessor())}};
ko.bindingHandlers.disableClick={init:function(element,valueAccessor){var clickHandler;if(document.addEventListener){clickHandler=function(event){var target=event.target||event.srcElement;if(target&&(target==element||$(element).closest(target))){var value=ko.utils.unwrapObservable(valueAccessor());if(value){if(event.stopPropagation)event.stopPropagation();if(event.preventDefault)event.preventDefault()}return false}};$(element).parent()[0].addEventListener("click",clickHandler,true);ko.utils.domNodeDisposal.addDisposeCallback(element,
function(){$(element).parent()[0].removeEventListener("click",clickHandler,true)})}else{clickHandler=function(evt){var value=ko.utils.unwrapObservable(valueAccessor());if(value)evt.stopImmediatePropagation()};$(element).on("click",clickHandler);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){$(element).off("click",clickHandler)})}}};ko.bindingHandlers.liquid={update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingsContext){var templateName=ko.utils.unwrapObservable(valueAccessor());
var allBindings=allBindingsAccessor();var hash=ko.unwrap(allBindings.liquidHash||bindingsContext.$data);var afterLiquid=allBindings.afterLiquid||$.noop;Templ.renderElem(element,templateName,hash);afterLiquid.call(null,element,hash)}};ko.bindingHandlers.tralbum_url={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());var myhash=$.extend({},Templ.getGlobals(),{});var context=new Templ.Context(myhash);Templ.current_context=context;$(element).attr("href",
Templ.filters.tralbum_url(v))}};ko.bindingHandlers.band_url={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());var myhash=$.extend({},Templ.getGlobals(),{});var context=new Templ.Context(myhash);Templ.current_context=context;$(element).attr("href",Templ.filters.band_url(v))}};ko.bindingHandlers.src_image={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());$(element).attr("src",
ImageUtils.imageURL(v.image_id,v.format))}};ko.bindingHandlers.href_image={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());$(element).attr("href",ImageUtils.imageURL(v.image_id,v.format))}};ko.bindingHandlers.src_art={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());$(element).attr("src",ImageUtils.artURL(v.art_id,v.format))}};ko.bindingHandlers.href_art={update:function(element,
valueAccessor,allBindingsAccessor,viewModel){var v=ko.utils.unwrapObservable(valueAccessor());$(element).attr("href",ImageUtils.artURL(v.art_id,v.format))}};ko.bindingHandlers.placeholder={update:function(element,valueAccessor,allBindingsAccessor,viewModel){var text=ko.utils.unwrapObservable(valueAccessor())||"";$(element).attr("placeholder",text)}};ko.bindingHandlers.valueAfterDescendants={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){ko.applyBindingsToDescendants(bindingContext,
element);ko.bindingHandlers.value.init.apply(this,arguments);return{controlsDescendantBindings:true}},update:ko.bindingHandlers.value.update};ko.bindingHandlers.price={init:function(element,valueAccessor,allBindingsAccessor){if(element.tagName.toLowerCase()=="input"){var value=valueAccessor();$(element).blur(function(event){value($(event.target).val())})}},update:function(element,valueAccessor,allBindingsAccessor){var num=ko.utils.unwrapObservable(valueAccessor());var value=num;var allBindings=allBindingsAccessor();
var result=null;var currency=ko.utils.unwrapObservable(allBindings.currency);var numericOnly=allBindings.numericOnly;var informal=allBindings.informal;var terse=allBindings.terse;if(!currency&&"CurrencyData"in window)currency=window.CurrencyData.current;if(!$.isPlainObject(currency)&&"CurrencyData"in window)currency=window.CurrencyData.info[currency||"USD"];if(!currency)return null;if(typeof value==="string"){value=$.trim(value);if(value.search(/^\d*,\d{0,2}$/)===0)value.replace(",",".");num=parseFloat(value)}if(typeof num===
"number"&&!isNaN(num))result=TextFormat.currency(num,currency,numericOnly,informal,terse);else result=value;result=Text.unescapeHtml(result);var tagName=element.tagName.toLowerCase();if(tagName=="input")$(element).val(result);else $(element).text(result)}};ko.bindingHandlers.money={update:function(element,valueAccessor,allBindingsAccessor){var money=ko.utils.unwrapObservable(valueAccessor());var allBindings=allBindingsAccessor();var format=allBindings.format;var result="";if(money&&money.is_money)result=
TextFormat.money(money,format);$(element).text(result)}};ko.bindingHandlers.time={update:function(element,valueAccessor,allBindings){var time=ko.unwrap(valueAccessor());var format=ko.unwrap(allBindings.get("format"));var timezone=ko.unwrap(allBindings.get("timezone"));if(timezone==="local")timezone=Time.get_local_timezone();$(element).text(Time.to_ui(time,format,undefined,timezone,true))}};ko.bindingHandlers.localTime={OPTION_KEYS:["localeMatcher","timeZone","hour12","hourCycle","formatMatcher","weekday",
"era","year","month","day","hour","minute","second","timeZoneName"],update:function(element,valueAccessor,allBindings){var val=ko.unwrap(valueAccessor());var date=typeof val==="string"?new Date(val):val;var options={};ko.bindingHandlers.localTime.OPTION_KEYS.forEach(function(key){if(allBindings.has(key))options[key]=allBindings.get(key)});$(element).text(date.toLocaleString(Translate.locale,options))}};ko.bindingHandlers.datepicker={init:function(element,valueAccessor,allBindings){var params=ko.unwrap(allBindings.get("datepickerParams"))||
{};params.onSelect=function(str,picker){valueAccessor()($(element).datepicker("getDate"));element.blur()};if(!params.dateFormat)params.dateFormat=$.datepicker.RFC_2822;if(element.nodeName.toLowerCase()==="input"){var initialDate=ko.unwrap(valueAccessor());element.value=initialDate?$.datepicker.formatDate(params.dateFormat,initialDate):"";element.addEventListener("change",function(){try{var newDate=$.datepicker.parseDate(params.dateFormat,element.value);valueAccessor()(newDate)}catch(e){console.warn("date parse error",
e);element.value=initialDate?$.datepicker.formatDate(params.dateFormat,initialDate):""}})}$(element).datepicker(params)},update:function(element,valueAccessor,allBindings){$(element).datepicker("setDate",ko.unwrap(valueAccessor()));valueAccessor()($(element).datepicker("getDate"))}};ko.bindingHandlers.timepicker={init:function(element,valueAccessor,allBindings){var initialDate=ko.unwrap(valueAccessor());element.value=ko.bindingHandlers.timepicker._formatTime(initialDate);element.addEventListener("change",
function(){var val=element.value;var match=val&&ko.bindingHandlers.timepicker.TIME_REGEX.exec(val);if(match){var date=new Date(ko.unwrap(valueAccessor()));var hour=parseInt(match[1]);var minute=match[2]?parseInt(match[2]):0;if(match[3]&&match[3].toLowerCase()==="pm")hour+=12;date.setHours(hour,minute);valueAccessor()(date)}else valueAccessor()(null)})},update:function(element,valueAccessor,allBindings){var date=ko.unwrap(valueAccessor());element.value=ko.bindingHandlers.timepicker._formatTime(date)},
_formatTime:function(date){if(!date)return"";var hour=date.getHours();var min=date.getMinutes();return hour+":"+TextFormat.pad(min,"0",10)},TIME_REGEX:/^(\d{1,2})(?::(\d\d))? *(am|pm)?$/i};ko.bindingHandlers.executeOnEnter={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var allBindings=allBindingsAccessor();$(element).keypress(function(event){var keyCode=event.which?event.which:event.keyCode;if(keyCode===13){allBindings.executeOnEnter.call(viewModel);return false}return true})}};
ko.bindingHandlers.errorBubble={init:function(element,valueAccessor,allBindingsAccessor){if(getErrorBubble(element).length===0)$('\x3cdiv class\x3d"error-bubble"\x3e').css("display","none").append('\x3cdiv class\x3d"message"\x3e').insertAfter(element);updateErrorBubble(element,valueAccessor,false)},update:function(element,valueAccessor,allBindingsAccessor){updateErrorBubble(element,valueAccessor,true)}};ko.extenders.errorKeys=function(target,options){target.error_key=ko.observable();target.error_msg=
ko.computed(function(){var key=target.error_key();return key?ko.utils.unwrapObservable(options[key])||"Unknown error":null});if(options.validator)target.validate=function(){target.error_key(options.validator(target()));return target.error_key()};target.subscribe(function(){target.error_key(null)});return target};ko.applyBandcampValidators=function(model,validators){$.each(validators,function(key,validator){var prop=model[key];var errorKey=key+"_error";if(model.hasOwnProperty(key)&&ko.isObservable(prop)&&
!(errorKey in model))model[errorKey]=ko.computed({deferEvaluation:true,read:function(){var val=prop();var valString=val===null||typeof val==="undefined"?val:String(val);var error=Form.validate._check_value_error_inner(key,validator,{},valString);if(error)switch(typeof prop.validationMessage){case "string":return prop.validationMessage;case "function":return prop.validationMessage(error);default:return error.reason}else return null}})});model.has_errors=ko.computed({deferEvaluation:true,read:function(){for(var key in model)if(model.hasOwnProperty(key)&&
errorPropRegex.test(key)&&ko.isObservable(model[key])){var error=model[key]();if(error){Log.warn("property "+key+" has an error: ",error);return true}}return false}})};ko.bindingHandlers.focusOn={init:function(element,valueAccessor,allBindingsAccessor){var targetObservable=valueAccessor();if(targetObservable===undefined)return;targetObservable.subscribe(function(newVal){if(newVal===true)element.focus()})}};ko.bindingHandlers.selectionRange={init:function(element,valueAccessor){var observable=valueAccessor();
var updateSelection=function(){observable({selectionEnd:element.selectionEnd,selectionStart:element.selectionStart})};updateSelection();element.addEventListener("focus",function(){document.addEventListener("selectionchange",updateSelection)});element.addEventListener("blur",function(){document.removeEventListener("selectionchange",updateSelection)})},update:function(element,valueAccessor){var value=ko.unwrap(valueAccessor());element.setSelectionRange(value.selectionStart,value.selectionEnd)}};ko.addIsDirtyObservables=
function(model,includes){$.each(model,function(key,prop){var dirtyKey=key+"_is_dirty";if((!$.isArray(includes)||$.inArray(key,includes)>=0)&&model.hasOwnProperty(key)&&!dirtyPropRegex.test(key)&&!errorPropRegex.test(key)&&key!=="has_errors"&&ko.isWriteableObservable(prop)&&!(dirtyKey in model))model[dirtyKey]=ko.makeIsDirtyObservable(prop)});model.is_dirty=ko.makeModelIsDirtyObservable(model)};ko.resetIsDirtyObservables=function(model,includes){$.each(model,function(key,prop){var dirtyKey=key+"_is_dirty";
if((!$.isArray(includes)||$.inArray(key,includes)>=0)&&model[dirtyKey]!==undefined&&ko.isWriteableObservable(prop))model[dirtyKey](false);model.is_dirty(false)})};ko.makeModelIsDirtyObservable=function(model){var prop=ko.computed({deferEvaluation:true,read:function(){for(var key in model)if(model.hasOwnProperty(key)&&dirtyPropRegex.test(key)&&ko.isObservable(model[key])){var isDirty=model[key]();if(isDirty)return key}return false},write:function(dirty){for(var key in model)if(model.hasOwnProperty(key)&&
dirtyPropRegex.test(key)&&ko.isWriteableObservable(model[key]))model[key](dirty)}});prop.revert=function(){for(var key in model)if(model.hasOwnProperty(key)&&dirtyPropRegex.test(key)&&ko.isWriteableObservable(model[key])&&typeof model[key].revert==="function")model[key].revert()};return prop};ko.makeIsDirtyObservable=function(prop){var currentValue=prop();var cleanProp=ko.observable($.isArray(currentValue)?currentValue.slice():currentValue);var dirtyProp=ko.computed({deferEvaluation:true,read:function(){var val=
prop();var cleanValue=cleanProp();if($.isArray(val)&&$.isArray(cleanValue)){if(val.length!==cleanValue.length)return true;for(var i=0;i<val.length;i++){var item=val[i];var cleanItem=cleanValue[i];if(item!=cleanItem&&(typeof item==="number"||typeof cleanItem==="number"||cleanItem||item))return true;else if(typeof item==="object"&&ko.isObservable(item.is_dirty)&&item.is_dirty())return true}}else if(cleanValue!=val&&(typeof val==="number"||typeof cleanValue==="number"||cleanValue||val))return true;return false},
write:function(dirty){if(dirty)cleanProp(alwaysDirtyValue);else{var cleanValue=prop();cleanProp($.isArray(cleanValue)?cleanValue.slice():cleanValue);if($.isArray(cleanValue))for(var i=0;i<cleanValue.length;i++){var item=cleanValue[i];if(typeof item==="object"&&ko.isWriteableObservable(item.is_dirty))item.is_dirty(false)}}}});dirtyProp.clean_value=cleanProp;dirtyProp.revert=function(){prop(cleanProp())};return dirtyProp};ko.eachObservable=function(vm,fn){var result;var undef;for(var key in vm){if(!vm.hasOwnProperty(key))continue;
var val=vm[key];var unwrapped=ko.utils.unwrapObservable(val);if($.isArray(unwrapped))for(var i=0;i<unwrapped.length;i++){if(unwrapped[i]&&typeof unwrapped[i]=="object"){result=ko.eachObservable(unwrapped[i],fn);if(result)return result}}else if(ko.isObservable(val)){result=fn(vm,key,val);if(result)return result}}return undef};var errorPropRegex=/_error$/;var dirtyPropRegex=/_is_dirty$/;var alwaysDirtyValue="this is just some string that is designed to always mismatch a legit model property value";
ko.when=function(predicate,callback,context){function kowhen(resolve){var observable=ko.pureComputed(predicate,context).extend({notify:"always"});var subscription=observable.subscribe(function(value){if(value){subscription.dispose();resolve(value)}});observable["notifySubscribers"](observable.peek());return subscription}if(typeof Promise==="function"&&!callback)return new Promise(kowhen);else return kowhen(callback.bind(context))}})(window,ko);
var LogAll=function(level,msg){var d=new Date;for(var ms=d.getMilliseconds().toString();ms.length<3;)ms="0"+ms;var timestamp=d.toTimeString().substring(0,8)+"."+ms+":";var args=Array.prototype.slice.call(arguments,1);args.unshift(timestamp);if(typeof LogView!="undefined")LogView.add(args.join(" "));if(typeof console=="undefined")return;var logFn=console[level]||console.log;logFn.apply(console,args)};
LogAll.proxy=function(level){return function(msg){try{var args=Array.prototype.slice.call(arguments);args.unshift(level);LogAll.apply(Log,args)}catch(e){}}};
var Log={debug:LogAll.proxy("log"),info:LogAll.proxy("info"),note:LogAll.proxy("info"),warn:LogAll.proxy("warn"),error:LogAll.proxy("error"),server:function(msg,level,isException){level=level||"info";var url="/client_log";var params=new FormData;params.append("exc",isException?"1":"0");params.append("msg",msg.substring(0,1E3));params.append("lvl",level);params.append("r",Math.random().toString().substring(2));var staging=document.body.classList.contains("staging");if(navigator.sendBeacon&&!staging){Log.debug("server log "+
level+": "+msg);navigator.sendBeacon(url,params)}else{Log.debug("(image beacon) about to send server log entry: "+level+": "+msg);params.append("old","1");var bcn=document.createElement("img");bcn.style.display="none";bcn.onload=function(){var e$$0;try{Log.debug("server log entry success: "+level+": "+msg);bcn.onload=bcn.onerror=null;bcn=null}catch(e){}};bcn.onerror=function(){var e$$0;try{Log.debug("server log entry error: "+level+": "+msg);bcn.onload=bcn.onerror=null;bcn=null}catch(e){}};var data=
new URLSearchParams(params);bcn.src=url+"?"+data.toString();bcn=null}}};
var U={trim:function(str){return $.trim(str)},isObject:function(o){return $.isPlainObject(o)},augmentObject:function(r,s,args){if(!args)for(var k in s)r[k]=s[k];else for(var i in args){var key=args[i];r[key]=s[key]}},isString:function(o){return typeof o==="string"},isNumber:function(o){return typeof o==="number"&&isFinite(o)},isArray:function(o){return $.isArray(o)},elt:function(e){if(U.isString(e)){e=e.replace(/\./g,"\\.");return $("#"+e.toString()).get(0)}return $(e).get(0)},stopEvent:function(e){var evt=
$.Event(e);evt.stopPropagation();evt.preventDefault()},pagedataBlob:function(){return window.PagedataBlob||$("#pagedata").data("blob")||{}}};function $assert(expr,msg){if(!expr){if(msg==null)msg="";var skipDebug=confirm("Assertion failed. "+msg+"\n\nSelect Cancel to debug.");if(!skipDebug)debugger}}var ErrorCollector;
ErrorCollector=function(exports){function filter(msg,scriptURL,line){if(!msg)return null;if(msg.toString()=="[object Event]"){msg=msg.message||msg.msg||msg.toString();scriptURL=scriptURL||msg.filename||msg.file||"";var normalize=function(val){return val===0?new Number(0):val};line=normalize(line)||normalize(msg.lineno)||normalize(msg.line)||""}if(scriptURL){var scriptHost=Url.toHash(scriptURL).host;var pageHost=location.host;if(!scriptHost)return null;if(!/(^|\.)(bandcamp\.com|bcbits\.com)$/.test(scriptHost)){var idx=
pageHost.length-scriptHost.length;if(idx<0||pageHost.lastIndexOf(scriptHost)!=idx)return null}}if(Browser.type=="gecko"&&line==0&&(/Permission denied to access property 'toString'/.test(msg)||/Location\.toString/.test(msg)))return null;var pageURL=location.href;if(scriptURL==pageURL)pageURL="---";var scripts=[];var jsb=window._jsb;if(jsb){var len=Math.min(jsb.length,20);for(var i=0;i<len;i++)scripts.push(jsb[i].n+":"+(jsb[i].c||0));if(len<jsb.length)scripts.unshift("(omitted "+(jsb.length-len)+")")}scripts=
scripts.join(",");return[msg,scriptURL,line,pageURL,++errorCount,domready,scripts]}function flush(){if(!timer){var delay=Math.max(lastSave+exports.saveDelay-(new Date).getTime(),250);timer=setTimeout(save,delay)}}function save(){clearTimeout(timer);timer=null;if(!isActive()||!errors.length)return;var out=[];var len=Math.min(errors.length,exports.maxBatchSize);for(var i=0;i<len;i++)out.push(errors[i].join("\t"));Log.server(out.join("\n"),"debug",true);lastSave=(new Date).getTime();errors.length=0;
batchCount++}function isActive(){return exports.enabled&&batchCount<exports.maxBatches}var defaults={enabled:true,sampleRate:null,maxBatchSize:3,maxBatches:3,saveDelay:5E3};var errors=[];var lastSave=0;var batchCount=0;var errorCount=0;var timer=null;var domready="";for(var prop in defaults)if(defaults.hasOwnProperty(prop)&&!exports.hasOwnProperty(prop))exports[prop]=defaults[prop];if(exports.enabled&&exports.sampleRate!=null&&Math.random()>exports.sampleRate){Log.debug("ErrorCollector: disabled due to sample rate");
exports.enabled=false}else Log.debug("ErrorCollector: "+(exports.enabled?"enabled":"disabled"));if(window.$){domready=0;$(document).ready(function(){domready=1})}exports.add=function(msg,scriptURL,line){if(window.isDebug||window.Identities&&window.Identities.isAdmin())alert("JavaScript error: "+msg+". Check the console.");if(isActive()){var data=filter(msg,scriptURL,line);if(data){errors.push(data);flush()}else Log.debug("ErrorCollector: skipping runtime error")}};if(exports.enabled)window.onerror=
exports.add;return exports}(ErrorCollector||{});
var Iter={each:function(a,f){var i=0;var v=null;for(i=0;a&&i<a.length;i++){v=f(a[i]);if(v)return v}},eachWithIndex:function(a,f){var i=0;var v=null;for(i=0;a&&i<a.length;i++){v=f(a[i],i);if(v)return v}},collect:function(arr,fn){if(!fn)fn=function(item){return item};var len=arr.length;var out=new Array(len);for(var i=0;i<len;i++)out[i]=fn(arr[i]);return out},find:function(arr,fn){var len=arr.length;for(var i=0;i<len;i++)if(fn(arr[i]))return arr[i];return null},findAll:function(arr,fn){var len=arr.length;
var out=[];for(var i=0;i<len;i++){var entry=arr[i];if(fn(entry))out.push(entry)}return out},index:function(arr,item){if(typeof arr.indexOf==="function")return arr.indexOf(item);var len=arr.length;for(var i=0;i<len;i++)if(arr[i]==item)return i;return-1},reduce:function(arr,fn,initialValue){if("function"===typeof arr.reduce)if(arguments.length<3)return arr.reduce(fn);else return arr.reduce(fn,initialValue);var prevValue=initialValue;var i=0;var len=arr.length;if(arguments.length<3){for(;i<len&&!(i in
arr);)i++;if(i>=len)throw new TypeError("Reduce of empty array with no initial value");prevValue=arr[i++]}for(;i<len;i++)if(i in arr)prevValue=fn(prevValue,arr[i],i,arr);return prevValue}};
var Text={notEmpty:function(str){return str!=null&&str.toString().length>0},collate:function(){for(var i=0;i<arguments.length;i++){var str=arguments[i];if(Text.notEmpty(str))return str}return""},escapeHtml:function(str){str=str.toString();return str.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")},unescapeHtml:function(str){var unescape_div=document.createElement("div");unescape_div.innerHTML=str;return unescape_div.firstChild.nodeValue},
markupMatch:function(str,match,pre,post,caseSensitive){var matchIndex=!caseSensitive?str.toLowerCase().indexOf(match.toLowerCase()):str.indexOf(match);if(matchIndex==-1)return str;return[str.substr(0,matchIndex),pre,str.substr(matchIndex,match.length),post,str.substr(matchIndex+match.length)].join("")},regexpEscape:function(str){return str.replace(/([\\\^\$\*\+\?\.\,\:\!\|\(\)\[\]\{\}])/g,"\\$1")},truncate:function(str,len,ellipsis){if(!str)return"";if(len==null)len=50;if(ellipsis==null)ellipsis=
"";if(str.length<=len)return str;if(ellipsis.length>len)return"";len=Math.max(0,len-ellipsis.length);return str.substr(0,len)+ellipsis}};
var Url={PATTERN_URL:/^(?:(https?\:)\/\/([^\:\/\?#]+)(?:\:(\d+))?)?(\/?[^\?#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,PATTERN_URL_NO_SPACE:/^(?:(https?\:)\/\/([^\:\/\?\s#]+)(?:\:(\d+))?)?(\/?[^\?\s#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,toHash:function(url,noSpace){url=url.trim();var matches=Url.PATTERN_URL.exec(url)||[];if(noSpace)matches=Url.PATTERN_URL_NO_SPACE.exec(url)||[];return{href:matches[0]||"",protocol:matches[1]||"",host:(matches[2]||"")+(matches[3]?":"+matches[3]:""),hostname:matches[2]||"",port:matches[3]||
"",pathname:matches[4]||"/",search:matches[5]||"",hash:matches[6]||""}},fromHash:function(urlHash){$assert(U.isObject(urlHash));var out=[];if(urlHash.protocol)out.push(urlHash.protocol,"//");if(urlHash.hostname)out.push(urlHash.hostname);if(urlHash.port)out.push(":",urlHash.port);if(urlHash.pathname)out.push(urlHash.pathname);if(urlHash.search)out.push(urlHash.search);if(urlHash.hash)out.push(urlHash.hash);return out.join("")},isLocal:function(url){var urlHash=Url._hashify(url);return urlHash.protocol==
location.protocol&&urlHash.host==location.host},isFullyQualified:function(url){var urlHash=Url._hashify(url);return urlHash.protocol&&urlHash.host},equals:function(urlA,urlB,skipHash){var hashA=Url._hashify(urlA);var hashB=Url._hashify(urlB);return hashA.protocol==hashB.protocol&&hashA.hostname==hashB.hostname&&(hashA.port||80)==(hashB.port||80)&&hashA.pathname==hashB.pathname&&hashA.search==hashB.search&&(skipHash||hashA.hash==hashB.hash)},fullyQualify:function(url,baseUrl){var urlHash=Url._hashify(url);
baseUrl=baseUrl||location;var baseUrlHash=Url._hashify(baseUrl);$assert(!urlHash.protocol&&!urlHash.hostname&&!urlHash.port,"expected a non-qualified URL");$assert(baseUrlHash.protocol&&baseUrlHash.hostname,"expected a fully-qualified base URL");$(["protocol","hostname","port"]).each(function(i,prop){urlHash[prop]=baseUrlHash[prop]});if(!urlHash.pathname)urlHash.pathname="/";else if(urlHash.pathname.charAt(0)!="/"){var basePath=baseUrlHash.pathname||"/";$assert(basePath.charAt(0)=="/","expected a fully-qualified base URL path");
if(basePath.charAt(basePath.length-1)=="/")urlHash.pathname=basePath+urlHash.pathname;else urlHash.pathname=basePath.replace(/[^\/]+$/,urlHash.pathname)}return Url.fromHash(urlHash)},parseQuery:function(query){var out={};$.each(Url.parseQueryArray(query),function(){out[this.name]=this.value});return out},joinQuery:function(queryHash){var out=[];for(var key in queryHash)if(queryHash.hasOwnProperty(key))out.push({name:key,value:queryHash[key]});return Url.joinQueryArray(out)},parseQueryArray:function(query){query=
query.replace(/^[\?&\s]*(.*?)[&\s]*$/,"$1");var out=[];if(query){var pairs=query.split(/&+/);$.each(pairs,function(){if(this&&this!="\x3d"){var pair=this.split("\x3d");var paramName;var paramValue;try{paramName=decodeURIComponent(pair[0]);paramValue=pair[1]?decodeURIComponent(pair[1]):""}catch(e){Log.error("parseQueryArray: error when decoding URL parameter, skipping; ",e);return true}out.push({name:paramName,value:paramValue})}})}return out},joinQueryArray:function(arr){arr=arr||[];var out=[];var param;
for(var i=0;i<arr.length;i++){param=arr[i];if(param&&(param.name!=null&&param.name!="")){if(out.length)out.push("\x26");out.push(encodeURIComponent(param.name));if(param.value!=null&&param.value!="")out.push("\x3d",encodeURIComponent(param.value))}}return out.join("")},addQueryParams:function(url,hash){if(!hash)return url;var queryIndex=url.indexOf("?")+1;var query=queryIndex>0?url.substr(queryIndex):"";var queryHash=Url.parseQuery(query);for(var key in hash)queryHash[key]=hash[key];var prefix=queryIndex>
0?url.substring(0,queryIndex):url+"?";return prefix+Url.joinQuery(queryHash)},removeQueryParams:function(url,arr){if(!arr)return url;var queryIndex=url.indexOf("?")+1;var query=queryIndex>0?url.substr(queryIndex):"";var queryHash=Url.parseQuery(query);var update=0;for(var i in arr){delete queryHash[arr[i]];update+=1}if(update===0)return url;var prefix=queryIndex>0?url.substring(0,queryIndex):url+"?";return prefix+Url.joinQuery(queryHash)},getQueryParam:function(url,param){var u=Url.toHash(url);return Url.parseQuery(u.search)[param]},
_hashify:function(url){return U.isString(url)?Url.toHash(url):url},isCustomDomain:function(hostnameMinusPort){$assert(window.siteroot,"expected siteroot");var hostname=hostnameMinusPort||location.hostname;var baseDomainPattern=new RegExp("\\.?"+Url.toHash(siteroot).hostname.replace(/\./g,"\\.")+"$");return!baseDomainPattern.test(hostname)}};var elt=U.elt;
var LangUtils={makeclass:function(classdef){return LangUtils.makesubclass(null,classdef)},makesubclass:function(superclass,classdef){var f=function(){};if(classdef.ctor){f=classdef.ctor;classdef.ctor=null}if(superclass)$.extend(f,superclass);for(var x in classdef.prototype)f.prototype[x]=classdef.prototype[x];for(x in classdef.statics)f[x]=classdef.statics[x];return f}};
var EventSender=LangUtils.makeclass({ctor:function(){this._listeners=[]},prototype:{get_adder:function(){var that=this;return function(callback,target){that._listeners.push({callback:callback,target:target})}},get_remover:function(){var that=this;return function(callback,target){for(var i=0;i<that._listeners.length;)if(that._listeners[i].callback==callback&&that._listeners[i].target==target)that._listeners.splice(i,1);else i++}},fire:function(){for(var i=0;i<this._listeners.length;i++){var l=this._listeners[i];
try{l.callback.apply(l.target,arguments)}catch(e){Log.debug("exception caught in event handler: "+l.callback.toString())}}}},statics:{create:function(obj,eventname){var sender=new EventSender;sender.serial=EventSender.serial++;obj["on"+eventname]=sender.get_adder();obj["remove_on"+eventname]=sender.get_remover();return function(){sender.fire.apply(sender,arguments)}},serial:1}});
var Form={_classDefinition:1,_allowSubmit:false,_submitTimer:null,delaySubmitUntilReady:function(e,submitter,change_ui,delay_interval){if(!delay_interval)delay_interval=100;var debugstring="event: "+e.type+", delay_interval: "+delay_interval+", change_ui: "+typeof change_ui;Log.debug("delaySubmitUntilReady: "+debugstring);if(!Form._allowSubmit){U.stopEvent(e);if(change_ui)change_ui();if(submitter){fn=Form.makeSubmitClosure(delay_interval,submitter);Form._submitTimer=setTimeout(fn,delay_interval)}else alert("The page is still loading; please wait just a moment...")}else;
},makeSubmitClosure:function(delay,submitter){return function(){Log.debug("anon fn: delay interval: "+delay);if(Form._submitTimer)clearTimeout(Form._submitTimer);if(!Form._allowSubmit){Log.debug("delaying "+delay+" millis...");var nextTry=Form.makeSubmitClosure(delay,submitter);Form._submitTimer=setTimeout(nextTry,delay)}else{Log.debug("Allowing Submit");submitter(null,true)}}}};
HTML5Player=function(){function DebugLog(name,flushInterval){this.buffer=[];this.flushInterval=flushInterval||1E4;this.tag=Math.round(Math.random()*Math.pow(2,32)).toString(16);this.name=name||"DebugLog";this.enable()}function HTML5Player(){var platform=Browser.platform;var browserMake=Browser.make;var browserType=Browser.type;var volumeCookie=Cookie.get("volume");if(volumeCookie)volumeCookie=parseFloat(volumeCookie,10);this._id=nextId;nextId++;this._options={debug:false,simulateEndedAndroid:browserMake==
"chrome"&&platform=="android",safeLoad:browserMake=="androidbrowser"&&platform=="android",playKick:browserMake=="androidbrowser"&&platform=="android"&&Browser.version[0]<4,loadStartKick:browserMake=="androidbrowser"&&platform=="android"&&Browser.version[0]>=4,deferPlayEvents:(browserMake=="chrome"||browserMake=="androidbrowser")&&platform=="android"||platform=="iphone",retryErrors:true,volume:volumeCookie||.7,deferredSeeks:false,resetOnStall:false,reloadOnSeek:false,simulateEndedSafari:false};if(HTML5Player.logEnabled()){this._debugLog=
new DebugLog("HTML5Player");this._options.debug=true}if(window.Url){var params=Url.parseQuery(location.search);for(var opt in this._options)if(params.hasOwnProperty(opt))if(opt=="volume"){var v=parseFloat(params[opt]);if(v)this._options[opt]=v}else this._options[opt]=!(params[opt]=="0"||params[opt]=="false")}this._handlers={state:[],time:[],loaded:[],info:[],volume:[]};this._listeners=[];this._volume=this._options.volume;this._recentpos=[];if(this._options.debug){var msg=["constructed; options: "];
for(var k in this._options)msg.push(k,"\x3d",this._options[k],"; ");this._info(msg.join(""))}this._createmedia();this._changestate(IDLE);if(Browser.platform=="iphone"){var that=this;window.addEventListener("popstate",function(){var recent=that._recentpos;if(that._state==PLAYING&&recent.length){that.pause();if(recent.length>1&&recent[recent.length-1]===0&&recent[recent.length-2]>0){var restorePos=recent[recent.length-2];that._warn("detected iOS page navigation bug; resetting playhead position to "+
restorePos);that._fire_event("time",{position:restorePos});recent.pop()}}})}if(this._options.safeLoad)this._nativeLoad=this._nativeLoadSafe}function _parseversion(str){var vparts=str.split(".");for(var i=0;i<vparts.length;i++)vparts[i]=Number(vparts[i]);return vparts}DebugLog.prototype.log=function(msg){var d=new Date;for(var ms=d.getMilliseconds().toString();ms.length<3;)ms="0"+ms;var timestamp=d.toTimeString().substring(0,8)+"."+ms;this.buffer.push(timestamp+" : "+msg)};DebugLog.prototype.flush=
function(){if(this.buffer.length>0){Log.debug("DebugLog flushing "+this.buffer.length+" messages to server");var messages=this.buffer;this.buffer=[];var data={tag:this.tag,name:this.name,messages:messages};$.ajax({url:"/api/debug/1/clientlog",type:"post",data:JSON.stringify(data),dataType:"json",success:function(result){Log.debug("posted client log")},failure:function(err){Log.error("failed to post client log: "+err)}})}};DebugLog.prototype.disable=function(){if(this.interval){window.clearInterval(this.interval);
this.interval=null}this.flush()};DebugLog.prototype.enable=function(){if(!this.interval){this.interval=window.setInterval(this.flush.bind(this),this.flushInterval);this.interval=null}};var nextId=1;HTML5Player.prototype={load:function(url){this._debug("load()");this._stallcount=0;this._errorRetryCount=0;this._loadedurl=url;this._wantstoplay=false;this._recentpos.length=0;if(!_useLocationHack){this._nativePause();this._nativeLoad();this._changestate(BUFFERING);this._nativeSrc(url);this._nativeLoad();
this._finishedloading=false;this._loadStartKicked=false;this._playingEventDeferred=false}},play:function(){this._debug("play()");if(_useLocationHack)window.location=this._loadedurl;else if(!this._wantstoplay){this._wantstoplay=true;this._nativePlay()}},pause:function(){this._debug("pause()");this._cancelPlayKick();this._wantstoplay=false;this._nativePause()},playpause:function(){this._debug("playpause()");switch(this._state){case PLAYING:case BUFFERING:this.pause();break;default:this.play()}},stop:function(){this._debug("stop()");
this._cancelPlayKick();this._wantstoplay=false;this._nativePause()},seek:function(seconds){this._debug("seek() to "+seconds);var performed_reload_seek=false;var that=this;if(this._options.reloadOnSeek&&this._mediaElem.src.substring(this._mediaElem.src.length-5)!="\x26nl\x3d1"){var already_buffered=false;for(var i=0;i<this._mediaElem.buffered.length;i++)if(this._mediaElem.buffered.start(i)<=seconds&&seconds<=this._mediaElem.buffered.end(i)){already_buffered=true;break}if(!already_buffered){this._debug("refreshing with non-rate-limited URL");
this._nativePause();this._nativeSrc(this._mediaElem.src+"\x26nl\x3d1");var seek_on_metadata_load=function(e){this.removeEventListener("loadedmetadata",seek_on_metadata_load);that._nativeSeek(seconds);that._nativePlay()};this._mediaElem.addEventListener("loadedmetadata",seek_on_metadata_load,false);this._nativeLoad();performed_reload_seek=true}}if(!performed_reload_seek)if(this._options.deferredSeeks){this._wantstoplay=true;switch(this._state){case PLAYING:case BUFFERING:this._debug("doing deferred seek during playback");
this._wantseek=true;this._wantpos=seconds;break;default:this._seek_inner(seconds)}}else this._seek_inner(seconds)},_seek_inner:function(seconds){if(this.position()==seconds)this._debug("seek: new position ("+seconds+") matches current, so taking no action");else try{this._nativeSeek(seconds)}catch(e){this._warn("caught error seeking -- perhaps your downloader does not support byte ranges? "+e)}this.play()},position:function(){return this._mediaElem&&this._mediaElem.currentTime},state:function(){return this._state},
setrate:function(r){this._mediaElem.playbackRate=r},vol_up:function(){this.setvol(this._volume+.05)},vol_down:function(){this.setvol(this._volume-.05)},setvol:function(vol){if(vol>1)vol=1;else if(vol<0)vol=0;if(this._volume!=vol){this._volume=vol;this._debug("setting media element volume to "+this._volume);try{this._mediaElem.volume=this._volume}catch(e){this._warn("caught exception setting volume: "+e)}}this._fire_event("volume",{volume:this._volume})},getvol:function(){return this._volume},onstate:function(handler){this._add_event_handler("state",
handler)},ontime:function(handler){this._add_event_handler("time",handler)},onloaded:function(handler){this._cancelReset();this._add_event_handler("loaded",handler)},oninfo:function(handler){this._add_event_handler("info",handler)},onvolume:function(handler){this._add_event_handler("volume",handler)},enableLog:function(doIt){if(doIt){this._options.debug=true;var DEBUG_LOG_TIMEOUT=1E3*60*60*24*7;Cookie.set("PlayerDebugLog",(new Date).valueOf()+DEBUG_LOG_TIMEOUT);if(!this._debugLog)this._debugLog=new DebugLog("HTML5Player")}else{Cookie.clear("PlayerDebugLog");
if(this._debugLog){this._debugLog.disable();this._debugLog=null}}},_createmedia:function(){this._mediaElem=document.createElement("audio");this._mediaElem.style.width="0px";this._mediaElem.style.height="0px";this._mediaElem.style.visibility="hidden";this._mediaElem.controls=false;document.body.appendChild(this._mediaElem);if(this._options.debug)for(var i=0;i<this._loggedEvents.length;i++)this._logevt(this._loggedEvents[i]);this._mediaElem.volume=this._volume;this._addlistener("loadstart",this._handle_loadstart,
this);this._addlistener("timeupdate",this._handle_timeupdate,this);this._addlistener("progress",this._handle_progress,this);this._addlistener("canplay",this._handle_canplay,this);this._addlistener("canplaythrough",this._handle_canplay,this);this._addlistener("durationchange",this._handle_durationchange,this);this._addlistener("playing",this._handle_playing,this);this._addlistener("pause",this._handle_pause,this);this._addlistener("ended",this._handle_ended,this);this._addlistener("stalled",this._handle_stalled,
this);this._addlistener("waiting",this._handle_waiting,this);this._addlistener("error",this._handle_error,this)},_loggedEvents:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],_logevt:function(name){this._addlistener(name,this._loghandler(name),this)},_destroymedia:function(){this._removelisteners();if(this._mediaElem){document.body.removeChild(this._mediaElem);
this._nativePause();this._mediaElem=null}},_addlistener:function(name,fn,instance){var handler=function(){fn.apply(instance,arguments)};this._listeners.push({name:name,handler:handler});this._mediaElem.addEventListener(name,handler,false)},_removelisteners:function(){if(!this._mediaElem)return;for(;this._listeners.length>0;){var info=this._listeners.pop();this._mediaElem.removeEventListener(info.name,info.handler,false)}},_handle_loadstart:function(arg){var media=this._mediaElem;if(this._options.loadStartKick&&
!this._loadStartKicked&&media.duration==1&&media.readyState==4){this._loadStartKicked=true;this._warn("loadstart: looks like Android Browser duration\x3d1 bug; kicking media.src...");this._nativeSrc(media.src)}},_handle_waiting:function(arg){this._debug("waiting")},_handle_timeupdate:function(arg){try{var media=this._mediaElem;if(this._options.deferredSeeks&&this._wantseek){this._debug("applying deferred seek");this._seek_inner(this._wantpos);this._wantseek=false}this._cancelPlayKick();if(this._recentpos.length==
5)this._recentpos.shift();this._recentpos.push(media.currentTime);if(this._playingEventDeferred&&this._state==BUFFERING){this._warn("Play event was deferred; simulating it now...");this._playingEventDeferred=false;this._handle_playing_inner()}var evtparams={position:media.currentTime};if(isFinite(media.duration)&&media.duration>0)evtparams.duration=media.duration;this._fire_event("time",evtparams);if(this._options.simulateEndedSafari&&this._mediaElem.ended)this._handle_ended_inner();if(!this._finishedloading){var amtLoaded=
this._amountLoaded();if(amtLoaded>=media.duration)this._finishedloading=true;if(amtLoaded!=this._lastloaded){this._lastloaded=amtLoaded;evtparams={loaded:amtLoaded};if(isFinite(media.duration))evtparams.total=media.duration;this._cancelReset();this._fire_event("loaded",evtparams)}}}catch(e){this._warn("exception in _handle_timeupdate: "+e)}},_handle_progress:function(){var media=this._mediaElem;if(this._options.simulateEndedAndroid&&this._state==PLAYING&&!media.paused&&!media.ended&&!isNaN(media.duration)){var rnd=
function(val){return Math.round(val*1E3)};var cur=rnd(media.currentTime);var dur=rnd(media.duration);var buf=rnd(this._amountLoaded());if(cur>0&&cur===dur&&cur===buf){this._warn("Did we just hit the Chrome/Android bug in which the 'ended' event isn't fired?");this._warn("Compensating by simulating the event ourselves...");this._handle_ended_inner()}}},_handle_ended:function(){this._debug("_handle_ended");if(!this._options.simulateEndedSafari)this._handle_ended_inner()},_handle_ended_inner:function(){this._debug("_handle_ended_inner");
try{this._wantstoplay=false;this._changestate(COMPLETED)}catch(e){this._warn("exception in _handle_ended: "+e)}},_scheduleReset:function(timeout){if(!this._options.resetOnStall)return;this._cancelReset();var that=this;this._warn("scheduling media reset in "+timeout+"ms");this._resetTimer=setTimeout(function(){that._resetTimer=null;that._warn("Resetting media (amtloaded \x3d "+that._amountLoaded()+")");that._nativeLoad()},timeout)},_cancelReset:function(){if(!this._options.resetOnStall)return;if(this._resetTimer){this._warn("canceling media reset due to load progress (amtloaded \x3d "+
this._amountLoaded()+")");clearTimeout(this._resetTimer);this._resetTimer=null}},_schedulePlayKick:function(timeout){if(!this._options.playKick)return;this._cancelPlayKick();var that=this;this._warn("scheduling playkick in "+timeout+"ms");this._playKickTimer=setTimeout(function(){that._warn("kicking");that._playKickTimer=null;that._nativePause();that._nativePlay();that._warn("kicked")},timeout)},_cancelPlayKick:function(){if(!this._options.playKick)return;if(this._playKickTimer){this._warn("canceling playkick timer");
clearTimeout(this._playKickTimer);this._playKickTimer=null}},_amountLoaded:function(){if(this._mediaElem.buffered.length>0)return this._mediaElem.buffered.end(this._mediaElem.buffered.length-1);return 0},_handle_stalled:function(){if(this._mediaElem.readyState==HAVE_ENOUGH_DATA)return;this._stallcount+=1;if(this._stallcount>MAX_STALLS){this._error("Too many stalls.  Giving up on this track.");this._nativePause();this._changestate(COMPLETED)}else{this._debug("stalled, readyState\x3d"+this._mediaElem.readyState+
", amtloaded\x3d"+this._amountLoaded());this._scheduleReset(7500)}},_handle_playing:function(){if(!(this._options.deferPlayEvents&&this._state==BUFFERING))this._handle_playing_inner();else{this._debug("deferring play event to the next timeupdate");this._playingEventDeferred=true}},_handle_playing_inner:function(){try{this._changestate(PLAYING)}catch(e){this._warn("exception in _handle_playing_inner: "+e)}},_handle_pause:function(){if(this._state===COMPLETED&&(this._options.simulateEndedSafari||this._options.simulateEndedAndroid)){this._debug("ignoring 'pause' event because state is COMPLETED");
return}if(this._mediaElem.paused)this._changestate(PAUSED)},_handle_canplaythrough:function(){this._handle_canplay()},_handle_canplay:function(){try{if(this._wantstoplay)this._nativePlay()}catch(e){this._warn("exception in _handle_canplay: "+e)}},_is_cloud_streaming_url:function(){var srcUrl=Url.toHash(this._mediaElem.src);var pathElems=srcUrl.pathname.split("/");if(pathElems.length==5&&pathElems[0]==""&&pathElems[1]=="stream"){var trackId=parseInt(pathElems[4],10);if(trackId!=NaN)return trackId;
else return null}else return null},_refresh_cloud_streaming_url:function(){var that=this;var oldUrl=this._mediaElem.src;$.ajax({url:"/api/stream/1/refresh",type:"get",data:{url:oldUrl},dataType:"json",success:function(result){var currentTrackId=that._is_cloud_streaming_url();if(currentTrackId==result.track_id){that._nativeSrc(result.url);that._nativeLoad()}}})},_handle_error:function(arg){var errorCode=this._mediaElem.error&&this._mediaElem.error.code;this._error("got native error event; error.code\x3d"+
errorCode);if(this._options.retryErrors)if(errorCode==this._mediaElem.error.MEDIA_ERR_SRC_NOT_SUPPORTED)if(this._errorRetryCount<5){this._errorRetryCount+=1;this._warn("assuming error is due to an expired stream URL and reloading; count\x3d"+this._errorRetryCount);var trackId=this._is_cloud_streaming_url();if(trackId!=null)this._refresh_cloud_streaming_url()}else{this._warn("exceeded maximum number of error retries; giving up on this track");this._nativePause();this._changestate(COMPLETED)}},_handle_durationchange:function(){this._schedulePlayKick(500)},
_loghandler:function(name){var self=this;return function(){var media=self._mediaElem;var buffered=null;try{buffered=media.buffered.end(media.buffered.length-1)}catch(e){}this._debug("[native] "+name+"; paused\x3d"+media.paused+"; ended\x3d"+media.ended+"; readyState\x3d"+media.readyState+"; duration\x3d"+media.duration+"; currentTime\x3d"+media.currentTime+"; buffered\x3d"+buffered)}},_isbuffering:function(){try{return this._mediaElem.readyState<HAVE_FUTURE_DATA}catch(e){}return false},_changestate:function(newstate){if(newstate==
PLAYING&&this._isbuffering())newstate=BUFFERING;if(newstate!=this._state){var oldstate=this._state;this._state=newstate;this._debug("state changed from "+oldstate+" to "+newstate);this._fire_event("state",{newstate:this._state,oldstate:oldstate})}},_fire_event:function(name,arg){var handlers=this._handlers[name];if(handlers)for(var i=0;i<handlers.length;i++)try{handlers[i](this,arg)}catch(e){this._warn('caught exception in handler for event "'+name+'": '+e)}},_add_event_handler:function(eventname,
handler){this._handlers[eventname].push(handler)},_nativeSrc:function(url){this._debug("[native] setting src to: "+url);this._mediaElem.src=url},_nativeLoad:function(){this._debug("[native] load()");this._mediaElem.load()},_nativeLoadSafe:function(){this._debug("[native] load() -- with exception handling");try{this._mediaElem.load()}catch(e){this._warn("Got exception when calling native load() -- assuming this is okay and continuing: "+e)}},_nativePlay:function(){this._debug("[native] play()");this._mediaElem.play()},
_nativePause:function(){this._debug("[native] pause()");this._mediaElem.pause()},_nativeSeek:function(position){this._debug("[native] setting currentTime to: "+position+"; previous position: "+this._mediaElem.currentTime);this._mediaElem.currentTime=position},_debug:function(str){if(this._options.debug)this._log("debug",str)},_info:function(str){this._log("info",str)},_warn:function(str){this._log("warn",str)},_error:function(str){this._log("error",str)},_log:function(level,str){if(this._debugLog)this._debugLog.log(level.toUpperCase()+
" - "+str);if(typeof Log!="undefined")Log[level]("HTML5Player-"+this._id+": "+str)}};var BUFFERING="BUFFERING";var PLAYING="PLAYING";var PAUSED="PAUSED";var IDLE="IDLE";var COMPLETED="COMPLETED";var HAVE_FUTURE_DATA=3;var HAVE_ENOUGH_DATA=4;var MAX_STALLS=20;var _useLocationHack=false;HTML5Player.supportedFormats=function(){function iphoneVersion(uastring){var match=uastring.match(/Version\/([0-9\.]*)/);if(!match)return null;return _parseversion(match[1])}var formats={};if(navigator.userAgent.indexOf("iPhone")!=
-1){var iphoneVer=iphoneVersion(navigator.userAgent);if(iphoneVer&&(iphoneVer[0]<4||iphoneVer[0]===4&&iphoneVer[1]===0&&(iphoneVer.length===2||iphoneVer[2]===0)))return{}}try{var media=document.createElement("audio");var canplay=media.canPlayType("audio/mpeg");formats["mp3-128"]=canplay=="probably"||canplay=="maybe";formats["mp3-v0"]=canplay=="probably"||canplay=="maybe";canplay=media.canPlayType('audio/mpeg; codecs\x3d"mp4a.40.2"');formats["aac-lo"]=canplay=="probably"||canplay=="maybe";if(!formats["aac-lo"]){canplay=
media.canPlayType('audio/mp4; codecs\x3d"mp4a.40.2"');formats["aac-lo"]=canplay=="probably"||canplay=="maybe"}canplay=media.canPlayType('audio/ogg; codecs\x3d"vorbis"');formats["vorbis-lo"]=canplay=="probably"||canplay=="maybe";canplay=media.canPlayType('audio/ogg; codecs\x3d"opus"');formats["opus-lo"]=canplay=="probably"||canplay=="maybe";if(formats["opus-lo"]&&navigator.userAgent.indexOf(" Chrome/")!=-1)formats["opus-lo"]=false}catch(e){}if(!formats){var match$$0=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);
if(match$$0){var ver=_parseversion(match$$0[1]);if(ver[0]<2||ver[0]==2&&ver[1]<3){_useLocationHack=true;Log.debug("using location \x3c\x3d stream workaround");formats["mp3-128"]=true;formats["aac-lo"]=true}}}return formats};HTML5Player.needLocationHack=function(){var match=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(!match)return false;var v=_parseversion(match[1]);return v[0]<3||v[0]==3&&v[1]<3};HTML5Player.enableLog=function(doIt){var DEBUG_LOG_TIMEOUT=1E3*60*60*24*7;if(doIt)Cookie.set("PlayerDebugLog",
(new Date).valueOf()+DEBUG_LOG_TIMEOUT);else Cookie.clear("PlayerDebugLog")};HTML5Player.logEnabled=function(){var cookie=Cookie.get("PlayerDebugLog");return cookie&&parseInt(cookie)>(new Date).valueOf()};return HTML5Player}();
var ImageUtils=function(){function dynamicURL(kind,image_id,format,is_https){if(!image_id)return TemplGlobals.static_siteroot+"/img/blank.gif";format=getFormat(format);var siteroot=ImageUtils.imageRoot(is_https);var ext;if(format.anim_ok)ext="";else if(format.file_format&&format.file_format!="original")ext="."+FORMAT_EXTENSIONS[format.file_format];else ext="";image_id=("000000000"+image_id).slice(-10);return siteroot+"/img/"+kind+image_id+"_"+format.id+ext}function getFormat(format){if(typeof format===
"object")return format;var fmts=TemplGlobals.image_formats;if(fmts)for(var i=0;i<fmts.length;++i)if(fmts[i].id==format||fmts[i].name==format)return fmts[i];Log.error("bad image format",format);return null}function calculateDimensions(width,height,format){format=getFormat(format);var format_width;var format_height;if(!format||format.resize_algo=="original"){format_width=width;format_height=height}else if(format.resize_algo=="thumb"){format_width=format.width;format_height=format.height}else if(format.resize_algo==
"fit")if(width<=format.width&&height<=format.height){format_width=width;format_height=height}else if(width/format.width>height/format.height){format_width=format.width;format_height=Math.round(height*(format.width/width))}else{format_width=Math.round(width*(format.height/height));format_height=format.height}else{Log.error("bad image resize algo",format);format_width=width;format_height=height}return{width:format_width,height:format_height}}var FORMAT_EXTENSIONS={"JPEG":"jpg","PNG":"png"};var returnVal=
{imageURL:function(image_id,format,is_https){return dynamicURL("",image_id,format,is_https)},artURL:function(art_id,format,is_https){return dynamicURL("a",art_id,format,is_https)},imageFormat:getFormat,imageDimensions:calculateDimensions,imageRoot:function(is_https){if("undefined"===typeof is_https)is_https=window.location.protocol==="https:";return is_https?TemplGlobals.image_siteroot_https:TemplGlobals.image_siteroot}};if("uploadImage"in window)returnVal.upload=uploadImage;return returnVal}();
var Sound={_callbacks:[],_status:null,_loadstarted:false,whenloaded:function(callback){Sound._showdebug("wl");if(!Sound._status){Sound._showdebug("init");Sound._callbacks.push(callback);Sound._load_wrapper()}else try{callback(Sound._status)}catch(e){}},_docallbacks:function(){for(;Sound._callbacks.length>0;)Sound._docallback(Sound._callbacks.pop())},_docallback:function(cb){try{cb(Sound._status)}catch(e){Log.error("caught error in Sound.whenloaded callback: "+e)}},_showdebug:function(text){var e=
document.getElementById("sounddebug");if(e)e.innerText=text},_load_wrapper:function(){Sound._status={success:true,subsystem:"wrapper",has_viz:"false"};Sound.SoundPlayer=WrapperSoundPlayer;Sound._docallbacks()}};
var WrapperSoundPlayer=function(){function WrapperSoundPlayer(){function make_lazy_stub(fname){return function(){var args=arguments;if(self._currentplayer=="html5")self._html5player[fname].apply(self._html5player,args)}}function make_simple_proxy(fname){return function(){var args=arguments;if(self._currentplayer=="html5")self._html5player[fname].apply(self._html5player,args);else Log.error("WrapperSoundPlayer proxy for "+fname+"(): no _soundplayer instance!")}}var self=this;self._html5player=null;
self._html5formats=HTML5Player.supportedFormats();self._currentplayer=null;self._handlers={state:[],time:[],loaded:[],info:[],volume:[]};var formatsSupported=[];for(var format in self._html5formats)if(self._html5formats.hasOwnProperty(format)&&self._html5formats[format]==true)formatsSupported.push(format);if(formatsSupported.length>0){self._html5player=new HTML5Player;self._html5player.ontime(function(target,x){self._fire_event("time",x)});self._html5player.onstate(function(target,x){self._fire_event("state",
x)});self._html5player.onloaded(function(target,x){self._fire_event("loaded",x)});self._html5player.oninfo(function(target,x){self._fire_event("info",x)});self._html5player.onvolume(function(target,x){self._fire_event("volume",x)});self._currentplayer="html5"}self._add_event_handler=function(eventname,handler){self._handlers[eventname].push(handler)};self.onstate=function(handler){self._add_event_handler("state",handler)};self.ontime=function(handler){self._add_event_handler("time",handler)};self.onloaded=
function(handler){self._add_event_handler("loaded",handler)};self.oninfo=function(handler){self._add_event_handler("info",handler)};self.onvolume=function(handler){self._add_event_handler("volume",handler)};self._fire_event=function(name,arg){handlers=self._handlers[name];if(handlers)for(var i=0;i<handlers.length;i++)try{if(self._currentplayer=="html5")handlers[i](self._html5player,arg)}catch(e){Log.debug('caught exception in handler for event "'+name+'": '+e)}};self.load=function(url,hq){var preferredformat=
null;var preferredurl=null;if(typeof url==="string"){preferredurl=url;preferredformat="mp3-128"}else{var formats=["aac-lo","mp3-128","opus-lo","vorbis-lo"];if(hq)formats.unshift("mp3-v0");for(var i=0;i<formats.length;i++)if(self._html5formats[formats[i]]&&url[formats[i]]){preferredformat=formats[i];break}if(!preferredformat)Log.error("no available HTML5-supported format");preferredurl=url[preferredformat]}self._currentplayer="html5";self._html5player.load(preferredurl)};var lazystubs=["play","pause",
"stop","seek"];var lazymap={};for(var i$$0=0;i$$0<lazystubs.length;i$$0++)lazymap[lazystubs[i$$0]]=true;for(var k in HTML5Player.prototype){if(k=="load")continue;if(k=="ontime")continue;if(k=="onstate")continue;if(k=="onloaded")continue;if(k=="oninfo")continue;if(k=="onvolume")continue;if(typeof HTML5Player.prototype[k]=="function"&&k.substr(0,1)!="_")if(lazymap[k])self[k]=make_lazy_stub(k);else self[k]=make_simple_proxy(k)}}return WrapperSoundPlayer}();
var LazySound=function(){function LazySound(){function make_lazy_stub(fname){return function(){var args=arguments;self.whenInstanceReady(function(sp){sp[fname].apply(sp,args)})}}function make_simple_proxy(fname){return function(){var args=arguments;if(self._soundplayer)try{self._soundplayer[fname].apply(self._soundplayer,args)}catch(e){if(!self._loggedException){self._loggedException=true;Log.error("LazySound proxy for "+fname+"(): caught exception: "+e)}}else Log.error("LazySound proxy for "+fname+
"(): no _soundplayer instance!")}}var self=this;self._soundplayer=null;self._loggedException=false;self.whenInstanceReady=function(callback){Sound.whenloaded(function(status){if(status.success){if(!self._soundplayer)self._soundplayer=new Sound.SoundPlayer;callback(self._soundplayer)}else Log.error("LazySound: Sound.whenloaded failed: ",status)})};var lazystubs=["play","pause","stop","load","onstate","ontime","onloaded","oninfo","onvolume","seek"];var lazymap={};for(var i=0;i<lazystubs.length;i++)lazymap[lazystubs[i]]=
true;for(var k in HTML5Player.prototype)if(typeof HTML5Player.prototype[k]=="function"&&k.substr(0,1)!="_")if(lazymap[k])self[k]=make_lazy_stub(k);else self[k]=make_simple_proxy(k)}return LazySound}();
var CommUtils={beacon:function(url,args){return this._loadImage(url,args,true)},loadImage:function(url){return this._loadImage(url)},_loadImage:function(url,args,randomize,on_finish){var bcn=document.createElement("img");var save_my_bcn=bcn;bcn.style.display="none";bcn.onload=bcn.onerror=function(){var e$$0;try{bcn=null;if(on_finish)on_finish()}catch(e){}};if(randomize&&!args.rand)args.rand=Math.random().toString().substring(2);bcn.src=Url.addQueryParams(url,args);return save_my_bcn},zzz:null};
var Cookie={ALT_IDENTITY_PARAM:"BandcampIdentity",get:function(cookieName){$assert(Text.notEmpty(cookieName));var cookie=Cookie.getAll()[cookieName];if(cookie==null)cookie=null;return cookie},getAll:function(){function push(name,val){var existingVal=out[name];if(!existingVal)out[name]=val;else if(U.isArray(existingVal))existingVal.push(val);else out[name]=[existingVal,val]}var pairs=document.cookie.split(/;\s*/);var out={};for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("\x3d");if(pair[1]){var paramName;
var paramValue;try{paramName=decodeURIComponent(pair[0]);paramValue=decodeURIComponent(pair[1])}catch(e){Log.error("Cookie.getAll: error when decoding URL parameter, skipping; ",e);continue}push(paramName,paramValue)}}return out},set:function(cookieName,cookieValue,maxAge,path,domain,secure){$assert(Text.notEmpty(cookieName));$assert(maxAge==null||U.isNumber(maxAge));if(cookieValue==null)cookieValue="";if(!path)path="/";if(!domain)domain=Cookie._secondLevelDomain();var expiresDate;if(maxAge!=null)expiresDate=
new Date((new Date).getTime()+maxAge*1E3);var enc=encodeURIComponent;var cookie=enc(cookieName)+"\x3d"+enc(cookieValue)+";path\x3d"+path+(domain!=null?";domain\x3d"+domain:"")+(expiresDate?";expires\x3d"+expiresDate.toUTCString():"")+(secure?";secure":"");document.cookie=cookie;return cookie},clear:function(cookieName,path,domain,secure){return Cookie.set(cookieName,"",-1,path,domain,secure)},_secondLevelDomain:function(){var parts=location.hostname.split(".");var len=parts.length;$assert(len>=1);
if(len==1)return null;return"."+parts[len-2]+"."+parts[len-1]}};var HiddenParams={};
(function(){HiddenParams.hide=function(keys){if(!Array.isArray(keys))keys=[keys];Log.debug("hiding params ["+keys.join(", ")+"] from url query");var keySet={};keys.forEach(function(k){keySet[k]=true});var query=Url.parseQueryArray(location.search);var remaining=[];for(var i=0;i<query.length;i++)if(!keySet[query[i].name])remaining.push(query[i]);var newUrl=location.pathname.replace(/^\/+/,"/");if(remaining.length>0)newUrl+="?"+Url.joinQueryArray(remaining);newUrl+=location.hash;BCTracker.afterPageView(function(){history.replaceState(null,
document.title,newUrl)})};HiddenParams.get=function(key,hide){if(!HiddenParams.hasOwnProperty(key)){if(hide===undefined)hide=true;var query=Url.parseQueryArray(location.search);var value;for(var i=0;i<query.length;i++)if(query[i].name===key){value=query[i].value;break}HiddenParams[key]=value;if(hide)HiddenParams.hide(key)}return HiddenParams[key]};var autoHideAttr=document.currentScript.dataset.hideParams;if(autoHideAttr){var autoHideKeys=JSON.parse(autoHideAttr);autoHideKeys.push(".reload");autoHideKeys.forEach(function(k){HiddenParams.get(k,
false)});HiddenParams.hide(autoHideKeys)}})();if(!window.Cookie)throw"expected Cookie library";
Cookie.CommChannel=function(channelName,uniquify){$assert(Text.notEmpty(channelName));this._id=Math.round(Math.random()*1E9);if(uniquify)channelName+=this._id;this._channelName=channelName;var namePrefix=Cookie.CommChannel.COOKIE_NAME_PREFIX+channelName;this._cookieName=namePrefix+"_"+this._id;this._namePattern=new RegExp("^"+Text.regexpEscape(namePrefix)+"_(\\d+)$");this._queue={last:0,msgs:[]};this._lastSeen={};this._scanTimer=null;Cookie.clear(this._cookieName)};Cookie.CommChannel.EVENT_NAME="cookiecomm_message";
Cookie.CommChannel.COOKIE_NAME_PREFIX="_comm_";Cookie.CommChannel.MAX_QUEUE_SIZE=5;Cookie.CommChannel.SCAN_TIMEOUT=250;Cookie.CommChannel.COOKIE_MAX_AGE=5;
Cookie.CommChannel.prototype={getName:function(){return this._channelName},startListening:function(){if(!this._scanTimer){var that=this;var timerCallback=function(){that._scanAllQueues()};this._scanTimer=setInterval(timerCallback,Cookie.CommChannel.SCAN_TIMEOUT);Log.info("Cookie comm channel "+this.getName()+" started listening.")}},stopListening:function(){if(this._scanTimer){clearInterval(this._scanTimer);this._scanTimer=null;Log.info("Cookie comm channel "+this.getName()+" stopped listening.")}},
subscribe:function(callback){$(document).on(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},unsubscribe:function(callback){$(document).off(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},send:function(msgName){$assert(U.isString(msgName));var msg=Iter.collect(arguments);Log.debug("Cookie comm channel "+this.getName()+" sending message "+msg[0],msg);for(var i=msg.length-1;i>0;i--)if(msg[i]==null)msg.pop();else break;var msgs=this._queue.msgs;msgs.push(msg);this._queue.last++;if(msgs.length>
Cookie.CommChannel.MAX_QUEUE_SIZE)this._queue.msgs=msgs.slice(1);if(this._writeTimeout)clearTimeout(this._writeTimeout);var self=this;this._writeTimeout=setTimeout(function(){self._writeQueue()},0)},cleanup:function(){Cookie.clear(this._cookieName);this.stopListening();this._lastSeen=this._queue=null},_writeQueue:function(){var json=JSON.stringify(this._queue);Cookie.set(this._cookieName,json,Cookie.CommChannel.COOKIE_MAX_AGE)},_scanAllQueues:function(){var cookies=Cookie.getAll();for(var name in cookies){var match=
this._namePattern.exec(name);if(!match)continue;var queueId=match[1]-0;if(queueId===this._id)continue;var json=cookies[name];$assert(!U.isArray(json),"we expect only one cookie per name");var queue=JSON.parse(json);this._scanOneQueue(queueId,queue)}},_scanOneQueue:function(queueId,queue){var lastIndex=queue.last;$assert(U.isNumber(lastIndex));var lastSeenIndex=this._lastSeen[queueId]||0;var newCount=lastIndex-lastSeenIndex;if(newCount>0){var newMsgs=queue.msgs.slice(-newCount);$assert(newMsgs.length);
this._lastSeen[queueId]=lastIndex;for(var i=0;i<newMsgs.length;i++){var msgArr=newMsgs[i];Log.debug("Cookie comm channel "+this.getName()+" received from "+queueId+" message "+msgArr[0],msgArr);msgArr.unshift(queueId);$.event.trigger(Cookie.CommChannel.EVENT_NAME+"_"+this._id,[msgArr]);if(!this._scanTimer)break}}}};
var Stats=function(){return{RECORD_URL:"/stat_record",hash_code:function(str){if(!str)return 0;var h=0;var len=str.length;for(var i=0;i<len;i++){var ch=str.charCodeAt(i);h=(h<<5)-h+ch;h|=0}if(h<0)h=4294967295+h+1;return h.toString(16)},record_sendbeacon:function(args){if(!args.band_id&&window.BandData)args.band_id=BandData.id;args.uac=Stats.hash_code(navigator.userAgent);if(navigator.sendBeacon){args.rand="b"+Math.round(Math.random()*1E16).toString();var url=siteroot_current+Stats.RECORD_URL;url=
Url.addQueryParams(url,args);navigator.sendBeacon(url)}else Stats.record(args)},record:function(args){var pd=$("#pagedata").data();var disableStats=pd&&pd.blob&&pd.blob.disable_stats;if(disableStats)if(Array.isArray(disableStats)){if(disableStats.includes(args.kind))return}else return;if(!args.band_id&&window.BandData)args.band_id=BandData.id;try{CommUtils.beacon(siteroot_current+Stats.RECORD_URL,args)}catch(e){Log.warn("CommsUtil.beacon error")}},_recorded_clicks:{},record_click_once:function(click){if(!Stats._recorded_clicks[click]){Stats._recorded_clicks[click]=
true;Stats.record({kind:"click",click:click})}},share_menu_click:function(variant){if(variant=="wordpress")variant="wordpress.com";Stats.record({kind:"share menu",click:variant})}}}();
Stats.PhasedStat=function(){function PhasedStat(params,phase){this._params=params;this._params.phase=phase;this._params.reference_num=Math.round(Math.random()*1E9);Stats.record(this._params)}PhasedStat.prototype={change_phase:function(phase){this._params.phase=phase;Stats.record(this._params)},done:function(){this.change_phase("complete")},error:function(info){this._params.info=info;this.change_phase("error")},add_params:function(params){this._params=this.merge(this._params,params)},merge:function(a,
b){var result={};for(var i in a)result[i]=a[i];for(i in b)result[i]=b[i];return result}};return PhasedStat}();
var Identities=function($){function IdentitiesVM(data){var self=this;this.initialData=data;this.user=ko.observable(data.user);this.fan=ko.observable(data.fan);this.partner=ko.observable(data.partner);this.isAdmin=ko.observable(data.is_admin);this.ip_country_code=data.ip_country_code;this.pageBand=data.page_band&&new BandVM(data.page_band);this.bmgr=new BandsMgr(data.bands);this.lmgr=new LabelsMgr(data.labels);this.labels=this.lmgr.labels;this.labelIds=ko.computed(function(){return Iter.collect(self.labels(),
function(label){return label.id})});this.linkedNonLabelMemberBands=ko.computed(function(){return Iter.findAll(self.bmgr.bands(),function(b){return!self.lmgr.isLabelMemberBand(b.id)})});this.linkedNonLabelBands=ko.computed(function(){return Iter.findAll(self.linkedNonLabelMemberBands(),function(b){return $.inArray(b.id,self.labelIds())===-1})});this.hasLabels=ko.computed(function(){return self.labels().length>0});this.pageBandParentLabel=ko.computed(function(){return Iter.find(self.labels(),function(label){return label.id===
data.page_band_parent_label_id})});var pageLabelForAdmin=data.page_label&&new LabelVM(data.page_label);this.pageLabel=ko.computed(function(){return self.pageBandParentLabel()||self.pageBand&&self.labels()&&Iter.find(self.labels(),function(label){return label.id===self.pageBand.id})||pageLabelForAdmin});this.isPageBandMember=ko.observable(data.is_page_band_member);this.isPageBandNonLabelMember=ko.computed(function(){return self.pageBand&&Iter.find(self.bmgr.bands(),function(band){return band.id==self.pageBand.id})});
this.isParentLabel=ko.computed(function(){return!!self.pageBandParentLabel()});this.hasFullAccess=ko.computed(function(){return self.isPageBandMember()||self.isAdmin()});this.hasLimitedAccess=ko.computed(function(){return self.isParentLabel()&&data.page_band&&!data.page_band.authed});this.isPageBand=function(bandID){return self.pageBand&&bandID===self.pageBand.id};this.isMemberOfBand=function(bandID){return self.bmgr.bandByID(bandID)||self.lmgr.isMemberBandAuthed(bandID)};this.activeLicenses=ko.observableArray(data.active_licenses);
this.subscribedToPageBand=ko.observable(data.subscribed_to_page_band||false);this.updateFromHash=function(updateHash){if(updateHash.bands)self.bmgr.updateBands(Iter.collect(updateHash.bands,function(b){return new BandVM(b)}));if(updateHash.page_band&&self.pageBand){if(updateHash.page_band.name)self.pageBand.name(updateHash.page_band.name);if(updateHash.page_band.photo)self.pageBand.photo(updateHash.page_band.photo);if(updateHash.page_band.trackpipe_local_url)self.pageBand.trackpipeLocalUrl(updateHash.page_band.trackpipe_local_url)}self.isPageBandMember(updateHash.is_page_band_member)};
this.add=function(newEntities){if(newEntities.bands&&newEntities.bands.length>0)self.bmgr.addBands(newEntities.bands);if(newEntities.labels&&newEntities.labels.length>0)self.lmgr.addLabels(newEntities.labels)};this.remove=function(entities){if(entities.bands&&entities.bands.length>0)self.bmgr.removeBands(entities.bands);if(entities.labels&&entities.labels.length>0){self.lmgr.removeLabels(entities.labels);self.bmgr.removeBands(entities.labels)}}}function BandVM(data){var self=this;this.id=data.id;
this.name=ko.observable(data.name);this.photo=ko.observable(data.photo||data.bio&&data.bio.image_id);this.trackpipeUrl=ko.observable(data.trackpipe_url||data.url);this.trackpipeLocalUrl=ko.observable(data.trackpipe_local_url||data.url||data.trackpipe_url);this.trackpipeUrlHttps=ko.observable(data.trackpipe_url_https);this.dashboardUrl=ko.computed(function(){return self.trackpipeLocalUrl()+"/dashboard"});this.isPro=ko.observable(data.is_pro);this.hasService=ko.observable(data.has_service);this.serviceName=
ko.observable(data.service_name);this.serviceUrlFragment=ko.observable(data.service_url_fragment);this.isLabel=ko.observable(data.is_label);this.isLabelMemberBand=ko.observable(false)}function BandsMgr(initial_bands){var self=this;var bandsArray;this.addBands=function(bands){var newBandVMs;var args;newBandVMs=Iter.collect(bands,function(b){return b instanceof BandVM?b:new BandVM(b)});args=[Number.MAX_VALUE,0].concat(newBandVMs);bandsArray.splice.apply(bandsArray,args)};this.bandByID=function(band_id){return Iter.find(bandsArray(),
function(b){return b.id===band_id})};this.removeBands=function(band_ids){var bandsToRemove=Iter.findAll(bandsArray(),function(b){return!!Iter.find(band_ids,function(id){return id===b.id})});bandsArray.removeAll(bandsToRemove)};this.updateBandName=function(bandId,newBandName){var bandToUpdate=self.bandByID(bandId);if(bandToUpdate)bandToUpdate.name(newBandName)};this.updateBands=function(newArray){bandsArray(newArray)};bandsArray=ko.observableArray(Iter.collect(initial_bands||[],function(b){return new BandVM(b)}));
this.bands=ko.computed(function(){var bands=bandsArray.slice(0);bands.sort(function(a,b){a=a.name().toLowerCase();b=b.name().toLowerCase();return a<b?-1:a>b?1:0});return bands}).extend({throttle:1});this.anyPro=ko.computed(function(){return!!Iter.find(bandsArray(),function(b){return b.isPro()})})}function LabelVM(data){var self=this;this.id=data.id;this.name=ko.observable(data.name);this.url=ko.observable(data.url);this.memberBands=ko.observableArray(Iter.collect(data.member_bands,function(band){var bandVM=
new BandVM(band);bandVM.isLabelMemberBand(true);bandVM.isAuthed=ko.observable(band.authed);bandVM.hasItems=ko.observable(band.band_has_items);return bandVM}));this.memberBandIds=ko.computed(function(){return Iter.collect(self.memberBands(),function(memberBand){return memberBand.id})})}function LabelsMgr(initialLabels){var self=this;this.labels=ko.observableArray(Iter.collect(initialLabels||[],function(label){return new LabelVM(label)}));var memberBandsAuthHash=ko.computed(function(){var hash={};Iter.each(self.labels(),
function(label){Iter.each(label.memberBands(),function(band){hash[band.id]=hash[band.id]||band.isAuthed()})});return hash});this.isMemberBandAuthed=function(memberBandID){return memberBandsAuthHash()[memberBandID]};this.isLabelMemberBand=function(memberBandID){return memberBandID in memberBandsAuthHash()};this.labelByID=function(labelId){return Iter.find(self.labels(),function(l){return l.id===labelId})};this.addLabels=function(labels){var newLabelVMs=Iter.collect(labels,function(l){return new LabelVM(l)});
var args=[Number.MAX_VALUE,0].concat(newLabelVMs);self.labels.splice.apply(self.labels,args)};this.removeLabels=function(labelIds){Iter.each(labelIds,function(labelId){var labelToRemove=self.labelByID(labelId);self.labels.remove(labelToRemove)})}}var instance=new IdentitiesVM(U.pagedataBlob().identities||{});instance.BandVM=BandVM;instance.BandsMgr=BandsMgr;return instance}(jQuery);
var Color={isDark:function(hexcolor){var rgb=this.hex2rgb(hexcolor);return this.rgb2hsl(rgb)[2]<.5},lowContrast:function(bgcolor,fgcolor,min_ratio){if(min_ratio===undefined)min_ratio=3;var lighter;var darker;if(this.luminance(fgcolor)>this.luminance(bgcolor)){lighter=this.luminance(fgcolor);darker=this.luminance(bgcolor)}else{lighter=this.luminance(bgcolor);darker=this.luminance(fgcolor)}ratio=(lighter+.05)/(darker+.05);if(ratio<min_ratio)return true;return false},luminance:function(hexcolor){var rgb=
this.hex2rgb(hexcolor);var R;var G;var B;for(var i=0;i<rgb.length;i++)if(rgb[i]<=.03928)rgb[i]=rgb[i]/12.92;else rgb[i]=Math.pow((rgb[i]+.055)/1.055,2.4);R=rgb[0];G=rgb[1];B=rgb[2];return.2126*R+.7152*G+.0722*B},rgb2hex:function(rgb){var r=Math.round(rgb[0]*255);var g=Math.round(rgb[1]*255);var b=Math.round(rgb[2]*255);return(r<16?"0":"")+r.toString(16)+(g<16?"0":"")+g.toString(16)+(b<16?"0":"")+b.toString(16)},hex2rgb:function(color){color=color.replace(/^#/,"");if(color.length==6)return[parseInt("0x"+
color.substring(0,2))/255,parseInt("0x"+color.substring(2,4))/255,parseInt("0x"+color.substring(4,6))/255];else if(color.length==3)return[parseInt("0x"+color.substring(0,1))/15,parseInt("0x"+color.substring(1,2))/15,parseInt("0x"+color.substring(2,3))/15]},hsl2rgb:function(hsl){var m1;var m2;var r;var g;var b;var h$$0=hsl[0];var s=hsl[1];var l=hsl[2];m2=l<=.5?l*(s+1):l+s-l*s;m1=l*2-m2;var hueToRGB=function(m1,m2,h){h=h<0?h+1:h>1?h-1:h;if(h*6<1)return m1+(m2-m1)*h*6;if(h*2<1)return m2;if(h*3<2)return m1+
(m2-m1)*(.66666-h)*6;return m1};return[hueToRGB(m1,m2,h$$0+.33333),hueToRGB(m1,m2,h$$0),hueToRGB(m1,m2,h$$0-.33333)]},rgb2hsl:function(rgb){var min;var max;var delta;var h;var s;var l;var r=rgb[0];var g=rgb[1];var b=rgb[2];min=Math.min(r,Math.min(g,b));max=Math.max(r,Math.max(g,b));delta=max-min;l=(min+max)/2;s=0;if(l>0&&l<1)s=delta/(l<.5?2*l:2-2*l);h=0;if(delta>0){if(max==r&&max!=g)h+=(g-b)/delta;if(max==g&&max!=b)h+=2+(b-r)/delta;if(max==b&&max!=r)h+=4+(r-g)/delta;h/=6}return[h,s,l]}};
var Share={showFromEmbed:function(){Share.panelAsDialog()},openFacebookShare:function(url,title){var fburl="http://www.facebook.com/sharer.php?u\x3d"+encodeURIComponent(url);fburl+="\x26p[title]\x3dptitle\x26p[summary]\x3dpsummary";if(title)fburl+="\x26t\x3d"+encodeURIComponent(title);window.open(fburl,"sharer","toolbar\x3d0,status\x3d0,width\x3d626,height\x3d436");return false},openTwitterShare:function(message,url){var params={};params["text"]=message;if(url)params["url"]=url;window.open(Url.addQueryParams("https://twitter.com/intent/tweet",
params));return false},panelLinkPromise:new $.Deferred,_panelInited:false,_panelData:null,initPanel:function(isTrackPage,enableSocialButtons,linkback){if(MediaView.mode=="phone"||$(".share-embed").length)return;var twitterUsername;$("#band-links a").each(function(){var match=/twitter\.com\/(?:#!)?(\w+)/i.exec($(this).attr("href"));if(match){twitterUsername=match[1];return false}});Share._panelData={linkback:linkback,is_track:isTrackPage,enable_social_buttons:enableSocialButtons,title:TralbumData.current.title,
artist:TralbumData.artist,twitter_username:twitterUsername,download_pref:TralbumData.current.download_pref,embed_info:EmbedData.embed_info};var p={"embed_info":$("#pagedata").data("blob").embed_info};$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_collect_controls",p));$(".share-embed").click(function(){Share.togglePanel()});$(".exclusive-embed").click(function(){EmbedDialog.open("exclusive")});if(enableSocialButtons)Share.initSocialButtons();Share.panelLinkPromise.resolve()},
initSocialButtons:function(){FacebookUtils.initSDK()},panelAsDialog:function(){Share.panelLinkPromise.then(Share._panelAsDialog)},_panelAsDialog:function(){var data=Share._panelData;var delem=$(Templ.render("tralbum_common/share_embed_panel",data));var dialogparams={draggable:true,position:"center",modal:true,title:"Share",width:380,height:260};var d=delem.dialog(dialogparams);d.find(".email-im-link-text").blur();Share._initPanelControls(d,data,function(){d.dialog("close")});if(Share._panelData.enable_social_buttons)SocialControls.initFromDOM(d)},
_initPanelControls:function(root,data,closehandler){var $root=$(root);$root.find(".close").click(function(){closehandler()});$root.find(".embed-other-services a").click(function(){Stats.record({kind:"click",click:"embed_other"});EmbedDialog.open();closehandler()});$root.find(".embed-other-services-exclusive a").click(function(){Stats.record({kind:"click",click:"embed_other_exclusive"});EmbedDialog.open("exclusive");closehandler()});$root.find(".share-buttons").on("click",".twitter-link, .tumblr-link",
function(){closehandler()});$root.find(".email-im-link input").focus(function(){EmailIMUtils.onFocus()}).click(function(){$(this).select()})},togglePanel:function(){var $root=null;if(!Share._panelInited){var data=Share._panelData;$root=$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_embed_panel",data));Share._initPanelControls($root,data,function(){Share.togglePanel()});Share._panelRoot=$root}else $root=Share._panelRoot;var container=$root.find(".share-embed-container");
var willShow=container.css("display")=="none";container.slideToggle("fast",function(){if(willShow)Dom.scrollToElement(container,20,true)});if(!Share._panelInited){if(Share._panelData.enable_social_buttons)SocialControls.initFromDOM($root);Share._panelInited=true}},xxx:null};
var Dom={getText:function(elem){elem=elt(elem);return elem?elem.textContent:""},setText:function(elem,text){elem=elt(elem);if(elem)elem.textContent=text},getValue:function(formElem){formElem=elt(formElem);switch(formElem.type){case "checkbox":return formElem.checked?formElem.value:null;case "radio":var radios=document.getElementsByName(formElem.name);var i=0;for(var n=radios.length;i<n;i++)if(radios[i].checked)return radios[i].value;return null}return formElem.value},setUnselectable:function(elem){elem=
elt(elem);if(elem)elem.style.userSelect="none"},focus:function(elem){elem=elt(elem);try{elem.focus()}catch(e){}},select:function(elem,doFocus){elem=elt(elem);try{elem.select();if(doFocus)elem.focus()}catch(e){}},getDocumentHeight:function(){return document.documentElement[Browser.type=="gecko"?"offsetHeight":"scrollHeight"]},wrapElem:function(elem,wrapperElem){if(U.isString(wrapperElem))wrapperElem=document.createElement(wrapperElem);$(wrapperElem).insertBefore(elem).append(elem);return wrapperElem},
scrollToElement:function(revealElt,clearance,gently){if(revealElt.charAt&&revealElt.charAt(0)!="#")revealElt="#"+revealElt;revealElt=$(revealElt);if(!revealElt.length)return;revealElt.parents().each(function(i,domElem){if(domElem.style&&domElem.style.display=="none")domElem.style.display=""});var animElt=document.scrollingElement;if(!animElt)animElt=document.documentElement&&document.documentElement.scrollTop!=null?document.documentElement:document.body;if(clearance==null)clearance=-10;if(gently){var viewHeight=
document.documentElement.clientHeight;var eltHeight=revealElt.height();var viewTop=animElt.scrollTop;var viewBottom=animElt.scrollTop+viewHeight;var eltTop=revealElt.offset().top;var eltBottom=revealElt.offset().top+eltHeight;if(eltTop>=viewTop){if(eltBottom<viewBottom)return;clearance+=eltBottom-viewHeight}else clearance+=eltTop}else clearance+=revealElt.offset().top;$(animElt).animate({"scrollTop":clearance},500)},hideEverythingStack:[],hideEverythingThanksAndroid:function(){if(Browser.make=="androidbrowser"){var args=
Array.prototype.slice.call(arguments);if(args.length==0)return;var devlog=$(".logView")[0];if(devlog)args.push(devlog);$(this.hideEverythingStack[0]).css("visibility","inherit");$(args).css("visibility","visible");$(args).each(function(i,elt){});this.hideEverythingStack.unshift(args);$(document.body).css("visibility","hidden")}},unhideEverythingThanksAndroid:function(){if(Browser.make=="androidbrowser"){var args=Array.prototype.slice.call(arguments);var top=this.hideEverythingStack[0];var found_one=
false;if(top&&top.length>0)$(args).each(function(i,elti){$(top).each(function(j,eltj){found_one=found_one||elti==eltj})});if(!found_one){Log.error("Elt not found unhiding for android fixup");return}this.hideEverythingStack.shift();elems=this.hideEverythingStack[0]||document.body;$(elems).css("visibility","visible");$(elems).each(function(i,elt){})}},hackLinkClicksThanksSafari:function(elts,clickHandler){elts=$(elts);if(Browser.platform!="iphone"){if(clickHandler)elts.on("click",clickHandler);return}elts.on({"touchend":function(ev){var href=
this.getAttribute("href");if(href&&href.substring(0,1)!="#")this.setAttribute("href","#"+href)},"click":function(ev){var href=this.getAttribute("href");if(href&&href.substring(0,1)=="#")this.setAttribute("href",href.substring(1));if(clickHandler)return clickHandler.apply(this,arguments)}})},inViewport:function(el){var top=el.offsetTop;var left=el.offsetLeft;var width=el.offsetWidth;for(var height=el.offsetHeight;el.offsetParent;){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top<
window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset},getCursorPosition:function(el){var sel;var pos=0;if(document.selection){el.focus();sel=document.selection.createRange();sel.moveStart("character",-el.value.length);pos=sel.text.length}else if(el.selectionStart!==undefined)pos=el.selectionStart;return pos},setCursorPosition:function(el,pos){var range;if(el.setSelectionRange){el.focus();el.setSelectionRange(pos,
pos)}else if(el.createTextRange){range=el.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}},getXY:function(el){if(window.getComputedStyle(el).display=="none")return false;var doc=el.ownerDocument;var docEl=doc.documentElement;var docBody=doc.body;var scrollLeft=Math.max(docEl.scrollLeft,docBody.scrollLeft);var scrollTop=Math.max(docEl.scrollTop,docBody.scrollTop);var box=el.getBoundingClientRect();xy=new Array(2);xy[0]=Math.round(box.left+
scrollLeft);xy[1]=Math.round(box.top+scrollTop);return xy},xxx:null};
var Time={useIntl:typeof Intl!=="undefined"&&typeof Intl.DateTimeFormat!=="undefined",timeFormats:{en:{yyyyMd:{form:"%-m/%-d/%Y"},yyyyMMdd:{form:"%m/%d/%Y"},yyyyMMM:{form:"%b %Y"},yyyyMMMM:{form:"%B %Y"},yyyyMMMd:{form:"%b %-d, %Y"},yyyyMMMMd:{form:"%B %-d, %Y"},yyyyMMMdhmm:{form:"%b %-d, %Y %-I:%M\u00a0%p"},yyyyMMMMdhmm:{form:"%B %-d, %Y %-I:%M\u00a0%p"},yyyyMMMMdhmmzz:{form:"%B %-d, %Y\u00a0at\u00a0%-I:%M\u00a0%p\u00a0%Z"},yyyyMMMMdEEEEhmmzz:{form:"%A, %B %-d, %Y\u00a0at\u00a0%-I:%M\u00a0%p\u00a0%Z"},MMMMd:{form:"%B %-d"},
hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M\u00a0%p\u00a0%Z"},hhmm:{form:"%l:%M\u00a0%p"}},fr:{yyyyMd:{form:"%d/%m/%Y"},yyyyMMdd:{form:"%d/%m/%Y"},yyyyMMM:{form:"%b %Y",localize:["month_short"]},yyyyMMMM:{form:"%B %Y",localize:["month"]},yyyyMMMd:{form:"%-d %b %Y",localize:["month_short"]},yyyyMMMMd:{form:"%-d %B %Y",localize:["month"]},yyyyMMMdhmm:{form:"%-d %b %Y\u00a0\u00e0\u00a0%H:%M",localize:["month_short"]},yyyyMMMMdhmm:{form:"%-d %B %Y\u00a0\u00e0\u00a0%H:%M",localize:["month"]},yyyyMMMMdhmmzz:{form:"%-d %B %Y\u00a0\u00e0\u00a0%H:%M\u00a0%Z",
localize:["month"]},yyyyMMMMdEEEEhmmzz:{form:"%A %-d %B %Y\u00a0\u00e0\u00a0%H:%M\u00a0%Z",localize:["month","weekday"]},MMMMd:{form:"%-d %B",localize:["month"]},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M\u00a0%Z"},hhmm:{form:"%H:%M"}},ja:{yyyyMd:{form:"%Y/%-m/%-d"},yyyyMMdd:{form:"%Y/%m/%d"},yyyyMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},yyyyMMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},yyyyMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},
yyyyMMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},yyyyMMMMdhmmzz:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M\u00a0%Z"},yyyyMMMMdEEEEhmmzz:{form:"%Y\u5e74%-m\u6708%-d\u65e5 (%A) %H:%M\u00a0%Z",localize:["weekday"]},MMMMd:{form:"%-m\u6708%-d\u65e5"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M\u00a0%Z"},hhmm:{form:"%H:%M"}}},localizedTimeValues:{fr:{month_short:["janv.","f\u00e9vr.","mars","avr.","mai","juin","juil.","ao\u00fbt","sept.","oct.","nov.","d\u00e9c."],month:["janvier","f\u00e9vrier","mars",
"avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],weekday:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ja:{weekday:["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"]}},get_locale:function(locale){if(typeof locale==="undefined"||locale=="")if("Translate"in window)locale=Translate.locale;else locale="en";if(locale=="qq")locale="ja";return locale},get_local_timezone:function(){return Time.useIntl?(new Intl.DateTimeFormat("en")).resolvedOptions().timeZone:
null},shiftDate:function(date,locale,timezone){if(!Time.useIntl)return{date:date,tzname:"UTC"};var locale23hour=locale+"-u-hc-h23";var formatter=new Intl.DateTimeFormat(locale23hour,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:false,timeZoneName:"short",timeZone:timezone});var year;var month;var day;var hour;var min;var sec;var tzName;var parts=formatter.formatToParts(date);for(var i=0;i<parts.length;i++)switch(parts[i]["type"]){case "year":year=
parseInt(parts[i]["value"]);break;case "month":month=parseInt(parts[i]["value"])-1;break;case "day":day=parseInt(parts[i]["value"]);break;case "hour":hour=parseInt(parts[i]["value"]);break;case "minute":min=parseInt(parts[i]["value"]);break;case "second":sec=parseInt(parts[i]["value"]);break;case "timeZoneName":tzName=parts[i]["value"];break;default:break}var d=new Date(Date.UTC(year,month,day,hour,min,sec));return{date:d,tzname:tzName}},to_ui:function(date,format,locale,timezone,asUTC){var s;var d;
if(typeof format==="undefined")format=1;if(typeof date==="string")date=new Date(date);locale=Time.get_locale(locale);if(typeof date["getUTCFullYear"]==="function"){if(typeof asUTC==="undefined")asUTC=true;d=new Date(date);if(asUTC){d.year=date.getUTCFullYear();d.month=date.getUTCMonth()+1;d.mday=date.getUTCDate();d.hour=date.getUTCHours();d.min=date.getUTCMinutes();d.sec=date.getUTCSeconds();d.tz="UTC"}else{d.year=date.getFullYear();d.month=date.getMonth()+1;d.mday=date.getDate();d.hour=date.getHours();
d.min=date.getMinutes();d.sec=date.getSeconds();d.tz=date.toTimeString().match(/\((.*)\)/)[1]}date=d}var badFormatStr="\x3cd'oh bad to_ui format\x3e";if(typeof format==="number")switch(format){case 1:s=Time.to_ui(date,2)+" "+Time.to_ui(date,3);break;case 2:s=date.month+"/"+date.mday+"/"+date.year%100;break;case 3:var hour12;var min_str;var ampm;hour12=date.hour>12?date.hour-12:date.hour;if(hour12==0)hour12=12;min_str=date.min<10?"0"+date.min:""+date.min;ampm=date.hour>=12?"pm":"am";s=hour12+":"+min_str+
ampm;break;case 4:s=date.month+"/"+date.mday+"/"+date.year;break;case 5:s=Time.to_ui(date,4)+" "+Time.to_ui(date,3);break;case 6:s=Time.tables.B[date.month-1]+" "+date.mday+", "+date.year;break;case 7:s=Time.to_ui(date,6)+" "+Time.to_ui(date,3);break;case 8:s=Time.to_ui(date,7)+" "+date.tz;break;case 9:s=Time.strftime(date,"%Y-%m-%d");break;case 10:s=Time.strftime(date,"%d %B %Y %H:%M:%S");break;case 11:s=Time.tables.b[date.month-1]+" "+date.mday+", "+date.year;break;case 12:s=Time.strftime(date,
"%Y-%m-%d %H:%M:%S");break;case 13:s=Time.strftime(date,"%B %Y");break;case 14:s=Time.strftime(date,"%m/%d/%Y");break;default:s=badFormatStr}else if(typeof format==="string"){var formattingObj=Time.timeFormats[locale][format];var formatStr=formattingObj["form"];if(typeof timezone!=="undefined"){s=Time.shiftDate(date,locale,timezone);date=s.date;formatStr=formatStr.replace(/%(Z)/g,s.tzname)}if("localize"in formattingObj){var localize=formattingObj["localize"];var locale_values=Time.localizedTimeValues[locale];
localize.forEach(function(field){var values=locale_values[field];switch(field){case "month_short":formatStr=formatStr.replace(/%b/g,values[date.getMonth()]);break;case "month":formatStr=formatStr.replace(/%B/g,values[date.getMonth()]);break;case "weekday":formatStr=formatStr.replace(/%A/g,values[date.getDay()]);break;default:formatStr=badFormatStr;break}})}s=Time.strftime(date,formatStr)}else s=badFormatStr;return s},toUi:function(date,fourDigitYear,asUTC,as24){if(U.isString(date))date=new Date(date);
var hour=date[asUTC?"getUTCHours":"getHours"]();var min=date[asUTC?"getUTCMinutes":"getMinutes"]();min=min<10?"0"+min:min;if(as24){hour=hour<10?"0"+hour:hour;var ampm=""}else{var hour12=hour>12?hour-12:hour;if(hour12==0)hour12=12;ampm=hour>=12?"pm":"am";hour=hour12}return Time.toUiDate(date,fourDigitYear,asUTC)+" "+hour+":"+min+ampm},toUiDate:function(date,fourDigitYear,asUTC){if(U.isString(date))date=new Date(date);var year=date[asUTC?"getUTCFullYear":"getFullYear"]().toString();if(!fourDigitYear)year=
year.substr(2);return date[asUTC?"getUTCMonth":"getMonth"]()+1+"/"+date[asUTC?"getUTCDate":"getDate"]()+"/"+year},relativeTimeFormats:{en:{today:"today",yesterday:"yesterday",days_ago:"{{days_ago}} days ago",one_hour_ago:"1 hour ago",hours_ago:"{{hours_ago}} hours ago",one_minute_ago:"1 minute ago",minutes_ago:"{{minutes_ago}} minutes ago",seconds_ago:"{{seconds_ago}} seconds ago",just_now:"just now"},fr:{today:"aujourd'hui",yesterday:"hier",days_ago:"il y a {{days_ago}} jours",one_hour_ago:"il y a 1 heure",
hours_ago:"il y a {{hours_ago}} heures",one_minute_ago:"il y a 1 minute",minutes_ago:"il y a {{minutes_ago}} minutes",seconds_ago:"il y a {{seconds_ago}} secondes",just_now:"\u00e0 l'instant"},ja:{today:"\u4eca\u65e5",yesterday:"\u6628\u65e5",days_ago:"{{days_ago}}\u65e5\u524d",one_hour_ago:"1\u6642\u9593\u524d",hours_ago:"{{hours_ago}}\u6642\u9593\u524d",one_minute_ago:"1\u5206\u524d",minutes_ago:"{{minutes_ago}}\u5206\u524d",seconds_ago:"{{seconds_ago}}\u79d2\u524d",just_now:"\u3061\u3087\u3046\u3069\u4eca"}},
timeStr:function(timeInSeconds){var str="";for(timeInSeconds=Math.floor(timeInSeconds);timeInSeconds>0;){var part=timeInSeconds%60;var partstr=part.toString();if(partstr.length<2)partstr="0"+partstr;if(str.length>0)str=partstr+":"+str;else str=partstr;timeInSeconds-=part;timeInSeconds/=60}if(str.length==0)str="00:00";else if(str.length<3)str="00:"+str;return str},calc_days_ago:function(date){return Math.floor((new Date-date)/(60*60*24*1E3))},relative_day:function(date,format,locale){if(U.isString(date))date=
new Date(date);locale=Time.get_locale(locale);var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago==0)return localeFormats.today;else if(days_ago==1)return localeFormats.yesterday;if(format)return Time.to_ui(date,format,locale);var str=localeFormats.days_ago;var vars={days_ago:days_ago};return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},relative_time:function(date,format,locale){if(U.isString(date))date=new Date(date);locale=Time.get_locale(locale);
var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago!=0)return Time.relative_day(date,format,locale);var secondsAgo=(new Date-date)/1E3;var minutesAgo=secondsAgo/60;var hoursAgo=minutesAgo/60;secondsAgo=Math.floor(secondsAgo);minutesAgo=Math.floor(minutesAgo);hoursAgo=Math.floor(hoursAgo);var str;var vars={};if(hoursAgo>4)return localeFormats.today;else if(hoursAgo>1){vars.hours_ago=hoursAgo;str=localeFormats.hours_ago}else if(hoursAgo>0)return localeFormats.one_hour_ago;
else if(minutesAgo>1){vars.minutes_ago=minutesAgo;str=localeFormats.minutes_ago}else if(minutesAgo>0)return localeFormats.one_minute_ago;else if(secondsAgo>15){vars.seconds_ago=secondsAgo;str=localeFormats.seconds_ago}else return localeFormats.just_now;return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},relativeDurationFormats:{en:{days:"{{days}} days",day:"1 day",hours:"{{hours}} hours",hour:"1 hour",minutes:"{{minutes}} minutes",minute:"1 minute",less_than_a_minute:"under a minute"},
fr:{days:"{{days}} jours",day:"Un jour",hours:"{{hours}} heures",hour:"1 heure",minutes:"{{minutes}} minutes",minute:"1 minute",less_than_a_minute:"sous une minute"},ja:{days:"{{days}}\u65e5",day:"1\u65e5",hours:"{{hours}}\u6642\u9593",hour:"1\u6642\u9593",minutes:"{{minutes}}\u5206",minute:"1\u5206",less_than_a_minute:"\u6570\u79d2"}},relative_duration:function(time_seconds,verbose,locale){locale=Time.get_locale(locale);if(typeof verbose=="undefined")verbose=false;var localeFormats=Time.relativeDurationFormats[locale];
var minutes=time_seconds/60;var hours=time_seconds/3600;var days=time_seconds<86400?0:time_seconds/86400;minutes=Math.floor(minutes);hours=Math.floor(hours);days=Math.round(days);var str;var vars={};if(verbose){if(days>=1)return Time.relative_duration(time_seconds,false,locale);if(hours<1||minutes%60==0)return Time.relative_duration(time_seconds,false,locale);var hours_str=Time.relative_duration(hours*3600,false,locale);var minutes_str=Time.relative_duration(minutes%60*60,false,locale);if(locale==
"ja")return hours_str+minutes_str;return hours_str+", "+minutes_str}if(days>1){vars.days=days;str=localeFormats.days}else if(days==1)return localeFormats.day;else if(hours>1){vars.hours=hours;str=localeFormats.hours}else if(hours==1)return localeFormats.hour;else if(minutes>1){vars.minutes=minutes;str=localeFormats.minutes}else if(minutes==1)return localeFormats.minute;else return localeFormats.less_than_a_minute;return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},toUpcomingDate:function(date,
asUTC){if(U.isString(date))date=new Date(date);return Time.getMonthName(date[asUTC?"getUTCMonth":"getMonth"]())+" "+date[asUTC?"getUTCDate":"getDate"]()},getMonthName:function(i){var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return m[i]},strToDate:function(str){if(!str)return null;str=str.replace(/-/g,"/");if(!~str.indexOf("UTC")&&!~str.indexOf("GMT"))str+=" UTC";var d=new Date(str);var missingYearResultsInNaN=isNaN(new Date("3/7"));var tryAddingYear=isNaN(d)||!missingYearResultsInNaN;
if(tryAddingYear){var recentMonths=3;var mindate=new Date;mindate.setMonth(mindate.getMonth()-recentMonths);var year=(new Date).getFullYear()-1;for(var y=year;y<year+3;y++){var candiDate=new Date(str+" "+y);if(candiDate>mindate){d=candiDate;break}}if(isNaN(d))return null}else{var fullYear=d.getFullYear();if(fullYear<2E3&&str.indexOf(fullYear)==-1){var twoDigitYearStr=fullYear.toString().substr(2,2);var twoDigitYear=parseInt(twoDigitYearStr);var offset=25;var twoDigitCutoff=parseInt(((new Date).getFullYear()+
25).toString().substr(2,2));if(twoDigitYear<=twoDigitCutoff)d.setFullYear(fullYear+100)}}return d},tables:{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],p:["AM","PM"],P:["A","P"]},formats:{"a":function(d){return Time.tables.a[d.getUTCDay()]},
"A":function(d){return Time.tables.A[d.getUTCDay()]},"b":function(d){return Time.tables.b[d.getUTCMonth()]},"B":function(d){return Time.tables.B[d.getUTCMonth()]},"-d":function(d){return d.getUTCDate()},"d":function(d){return TextFormat.pad(d.getUTCDate(),"0",10)},"e":function(d){return TextFormat.pad(d.getUTCDate()," ",10)},"H":function(d){return TextFormat.pad(d.getUTCHours(),"0",10)},"-I":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"I":function(d){var I=d.getUTCHours()%12;return TextFormat.pad(I===
0?12:I,"0",10)},"l":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"j":function(d){var ms=d-new Date(d.getUTCFullYear()+"/1/1 GMT");var doy=parseInt(ms/6E4/60/24,10)+1;return TextFormat.pad(doy,"0",100)},"-m":function(d){return d.getUTCMonth()+1},"m":function(d){return TextFormat.pad(d.getUTCMonth()+1,"0",10)},"M":function(d){return TextFormat.pad(d.getUTCMinutes(),"0",10)},"p":function(d){return Time.tables.p[d.getUTCHours()>=12?1:0]},"P":function(d){return Time.tables.P[d.getUTCHours()>=
12?1:0]},"s":function(d){return parseInt(d.getTime()/1E3)},"S":function(d){return TextFormat.pad(d.getUTCSeconds(),"0",10)},"u":function(d){var dow=d.getUTCDay();return dow===0?7:dow},"U":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=6-d.getUTCDay();var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,"0",10)},"w":function(d){return d.getUTCDay().toString()},"W":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=7-Time.formats.u(d);var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,
"0",10)},"y":function(d){return TextFormat.pad(d.getUTCFullYear()%100,"0",10)},"Y":function(d){return d.getUTCFullYear().toString()},"Z":function(d){return"UTC"},"%":function(d){return"%"}},aggregates:{"c":"%a %b %e %X %Y","x":"%m/%d/%y","X":"%H:%M:%S"},strftime:function(date,fmt){for(;fmt.match(/%[cDhnrRtTxX]/);)fmt=fmt.replace(/%([cDhnrRtTxX])/g,function(m0,m1){return Time.aggregates[m1]});fmt=fmt.replace(/%(\-[dmI])/g,function(m0,m1){return Time.formats[m1](date)});return fmt.replace(/%([aAbBCdegGHIjlmMpPsSuUVwWyYzZ%])/g,
function(m0,m1){return Time.formats[m1](date)})}};
var TextFormat={currency:function(num,currencyInfo,numericOnly,informal,terse){if(num.is_money){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.currency on "+window.location.pathname,"error");currencyInfo=window.CurrencyData.info[num.currency];num=num.amount/100}var fmt=currencyInfo||{prefix:"$",symbol:"USD",places:2};var places=num>=1||num==0?fmt.places:2;if(informal&&num>=1&&Math.round(num)==num)places=0;var base=num.toFixed(places);if(numericOnly)return base;base=TextFormat.commafyNumber(base);
if(fmt.symbol&&!terse)base+=" "+fmt.symbol;return fmt.prefix_utf8+base},money:function(input,currency,format){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.money on "+window.location.pathname,"error");if(input&&input.is_money){if("number"===typeof currency)format=currency;currency=input.currency;input=input.amount/100}input=input||0;currency=currency||"USD";format=format||1;var fmt=CurrencyData.info[currency];var places=fmt.places;var isWholeNumber=input===Math.round(input);
if(isWholeNumber){if(format===2||format===7||format===9)places=0}else if(places===0)places=2;var s=input.toFixed(places);if(format!==5&&format!==8&&format!==9)s=this.commafyNumber(s);if(format===4)if(s[0]==="-")s="("+s.substr(1)+")";if(format===1||format===2)s=fmt.prefix_utf8+s;else if(format===6||format===7)s=fmt.prefix_utf8+" "+s;if(format===5)s=Array(8-s.length).join(" ")+s;return s},million_usd:function(value,locale){var s="";switch(locale){case "ja":if(value>=100)s=(value/100).toFixed(1)+"\u5104\u30c9\u30eb";
else s=(value*100).toFixed(0)+"\u4e07\u30c9\u30eb";break;case "fr":if(value>=100)s=value.toFixed(0)+" millions de dollars";else s=value.toFixed(1)+" millions de dollars";s=s.replace(".",",");break;default:if(value>=100)s="$"+value.toFixed(0)+" million";else s="$"+value.toFixed(1)+" million";break}return s},toMb:function(num,si){var base=si?1E3:1024;var d=1;var n=base;var m=Iter.find([" bytes","K","MB","GB","TB","PB"],function(){if(num<n)return true;else{d=n;n*=base;return false}});if(!m)return num.toString();
var a=Math.round(num/d*10);if(a%10==0)return a/10+m;else return(a/10).toFixed(1)+m},pad:function(x,str,r){for(x=x.toString();parseInt(x,10)<r&&r>1;r/=10)x=str+x;return x},_determine_locale_separators:function(){var test=(1.2).toFixed(1);if(test.indexOf(".")>=0)TextFormat._separators={decimal:".",thousands:","};else TextFormat._separators={decimal:",",thousands:"."}},commafyNumber:function(str){if(!TextFormat._separators)TextFormat._determine_locale_separators();var parts=str.split(TextFormat._separators.decimal);
var intpart=parts[0];var decimalpart=parts[1]?TextFormat._separators.decimal+parts[1]:"";var isNeg=false;if(intpart==0&&!decimalpart)return"0";if(intpart.substr(0,1)==="-"){intpart=intpart.substr(1);isNeg=true}var length=intpart.length;var out="";for(var i=0;(length-i)%3>0;){out+=intpart.substr(i,1);i++}if(out.length>0&&length-i>0)out+=TextFormat._separators.thousands;for(;length-i>3;){out+=intpart.substr(i,3)+TextFormat._separators.thousands;i+=3}if(length-i>0)out+=intpart.substr(i);return(isNeg?
"-":"")+out+decimalpart},noOrphan:function(str){return str.replace(/([^ ]+) +([^ ]+)$/,"$1\u00a0$2")}};function addExpandEventListeners(field){$(field).off(".bcExpand").on("paste.bcExpand keyup.bcExpand focus.bcExpand",updateFieldHeight)}
function updateFieldHeight(event){var field=event.target;var maxHeight=250;var clientHeight=parseInt(field.clientHeight);var scrollHeight=parseInt(field.scrollHeight);if(scrollHeight>clientHeight){if(scrollHeight>maxHeight)scrollHeight=maxHeight;field.style.height=scrollHeight+"px"}}function addShrinkEventListeners(field,maxInactiveHeight){$(field).blur(function(event){shrinkFieldHeight(event,maxInactiveHeight)})}
function shrinkFieldHeight(event,maxInactiveHeight){var field=event.target;var contentHeight=parseInt(field.scrollHeight);if(contentHeight>maxInactiveHeight)field.style.height=maxInactiveHeight+"px"}
function addCharacterCountdownEventListeners(field,counterDiv,max){function update(doTruncate){var remaining=max-$(field).val().length;$(counterDiv).toggleClass("notable",remaining<=0);if(remaining<0&&doTruncate){$(field).val($(field).val().substr(0,max));remaining=0}$(counterDiv).find(".counter").text(""+remaining)}$(field).on("input",function(){update(true)});if(!("oninput"in field)||Browser.make==="ie"&&Browser.version[0]<=9)$(field).on("paste cut keyup",function(){setTimeout(update,0,true)});
update(false)}function InterruptibleTimer(){this._timer=null}InterruptibleTimer.prototype={start:function(code,delay){this.stop();this._timer=setTimeout(code,delay)},stop:function(){clearTimeout(this._timer)}};
var WatchInput={watchInput:function(eltID,defaultValue,valueType){$assert(typeof eltID=="string");if(this.__watching==null)this.__watching={};var stuff=this.__watching[eltID]={};stuff.__watchInput_elt=eltID;stuff.__watchInput_default=defaultValue;stuff.__watchInput_type=valueType||"float";var Self=this;setTimeout(function(){Self.__watchInput(eltID)},500)},__watchInput:function(whichID){var stuff=this.__watching[whichID];if(!stuff)return;var e$$0;var el=elt(stuff.__watchInput_elt);if(!el){this.__watching[whichID]=
null;return}var val=el.value==undefined?el.innerHTML:el.value;switch(stuff.__watchInput_type){case "float":var amt=parseFloat(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;case "integer":amt=parseInt(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;default:amt=val;break}if(amt!=stuff.__watchInput_Last&&this.inputChanged)try{this.inputChanged(amt,stuff.__watchInput_elt)}catch(e){Log.error(e)}stuff.__watchInput_Last=amt;var Self=this;setTimeout(function(){Self.__watchInput(whichID)},
500)}};
var Expression={eval:function(expr,eval_lambda,handle_constants){var p=this.init(expr,eval_lambda,handle_constants);var value=this.parse_top(p);if(this.next_token(p).kind!="end")throw"Expression error: '"+p.expr+"' -- end expected";return value},dump:function(expr,eval_lambda,handle_constants){for(var p=this.init(expr,eval_lambda,handle_constants);true;){var t=this.next_token(p);console.log(t.kind+" "+t.value);if(t.kind=="end")break}},init:function(expr,eval_lambda,handle_constants){var p={};p.expr=
expr;p.handle_constants=handle_constants;p.eval_lambda=eval_lambda;p.return_prev_token=false;p.short_circuit=false;return p},OPERATORS:["||","\x26\x26","\x3c\x3d","\x3d\x3d","!\x3d","\x3e\x3d","\x3c","\x3e","+","-","*","/","%","!","(",")"],next_token:function(p){if(p.return_prev_token){p.return_prev_token=false;return p.previous_token}var token={};p.expr=p.expr.replace(/^\s+/,"");if(p.expr=="")token.kind="end";else{for(var i=0;i<this.OPERATORS.length;++i){var op=this.OPERATORS[i];if(p.expr.substr(0,
op.length)==op){token.kind=op;p.expr=p.expr.slice(op.length);break}}if(!token.kind){var m;m=p.expr.match(/^(\'[^\']*\')/)||p.expr.match(/^(\"[^\"]*\")/)||p.expr.match(/([^\s\+\-\*\/\%\(\)\<\=\>\!\&\|\'\"]+)/);if(m){token.value=m[1];token.kind="term";p.expr=p.expr.slice(token.value.length)}}}p.previous_token=token;return token},backup:function(p){p.return_prev_token=true},is_true:function(val){return val!==false&&val!=null},parse_top:function(p){return this.parse_boolean_op(p)},parse_boolean_op:function(p){for(var value=
this.parse_comparison_op(p);true;)switch(this.next_token(p).kind){case "||":if(this.is_true(value)){var s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;case "\x26\x26":if(!this.is_true(value)){s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;default:this.backup(p);return value}},parse_comparison_op:function(p){var value=this.parse_additive_op(p);
for(var op;true;)switch(op=this.next_token(p).kind){case "\x3c":case "\x3c\x3d":case "\x3d\x3d":case "!\x3d":case "\x3e\x3d":case "\x3e":value=this.evaluate_comparison(op,value,this.parse_additive_op(p));break;default:this.backup(p);return value}},evaluate_comparison:function(op,l,r){if(op==="\x3d\x3d")if(l&&l.is_money)return r&&r.is_money&&l.currency===r.currency&&l.amount===r.amount;else return l==r;else if(op==="!\x3d")return!this.evaluate_comparison("\x3d\x3d",l,r);else{if("undefined"===typeof l||
"undefined"===typeof r)Log.error("Expression: inequality comparison with an undefined operand will always return false");if(l&&l.is_money){if(!(r&&r.is_money))throw"money cannot be compared with non-money";if(l.currency!==r.currency)throw"money comparison currency mismatch";l=l.amount;r=r.amount}switch(op){case "\x3c":return l<r;case "\x3e":return l>r;case "\x3c\x3d":return l<=r;case "\x3e\x3d":return l>=r;default:throw"invalid comparison operator: "+op;}}},parse_additive_op:function(p){for(var value=
this.parse_multiplicative_op(p);true;)switch(this.next_token(p).kind){case "+":value+=this.parse_multiplicative_op(p);break;case "-":value-=this.parse_multiplicative_op(p);break;default:this.backup(p);return value}},parse_multiplicative_op:function(p){for(var value=this.parse_term(p);true;)switch(this.next_token(p).kind){case "*":value*=this.parse_term(p);break;case "/":value/=this.parse_term(p);break;case "%":value%=this.parse_term(p);break;default:this.backup(p);return value}},parse_term:function(p){var token=
this.next_token(p);var value;switch(token.kind){case "(":value=this.parse_top(p);if(this.next_token(p).kind!=")")throw"Expression error: '"+p.expr+"' -- unbalanced parentheses";break;case "+":value=this.parse_term(p);break;case "-":value=-this.parse_term(p);break;case "!":value=!this.is_true(this.parse_term(p));break;case "term":if(!p.short_circuit){var con=p.handle_constants;if(con){con=this.constant(token.value);if(con)value=con.v}if(!con)if(p.eval_lambda)value=p.eval_lambda(token.value);else throw"Expression error: '"+
p.expr+"' -- not a term";}}return p.short_circuit?1:value},constant:function(x){var m;if(x.match(/^\d/))if(x.match(/e|E|\./))return{"v":parseFloat(x)};else return{"v":parseInt(x)};else if(m=x.match(/^\'(.*)\'$/)||x.match(/^\"(.*)\"$/))return{"v":m[1]};else if(x=="true")return{"v":true};else if(x=="false")return{"v":false};else if(x=="nil")return{"v":null};else return null}};
var StatusSpinny={spinnyID:"status-spinny",spinningClass:"spinning",timeouts:[],showQueue:[],showingQueue:false,isShown:false,spinny:function(spins){var spinnyEl=$("#"+StatusSpinny.spinnyID);if(spinnyEl.length===0)spinnyEl=$('\x3cdiv id\x3d"'+StatusSpinny.spinnyID+'"\x3e\x3c/div\x3e').appendTo(document.body);if(typeof spins=="boolean")spinnyEl[spins?"addClass":"removeClass"](StatusSpinny.spinningClass);return spinnyEl},show:function(speed,spins,message,duration){if(message===undefined||message==null)message=
"";StatusSpinny.resetTimeouts();var showFn=function(){StatusSpinny.isShown=true;StatusSpinny.spinny(spins).html(message).fadeIn(speed);if(typeof duration=="number")StatusSpinny.timeout(duration)};if(StatusSpinny.isShown)StatusSpinny.scheduleShow(message,showFn);else showFn()},scheduleShow:function(message,showFn){StatusSpinny.showQueue.push({message:message,fn:showFn});if(!StatusSpinny.showingQueue){StatusSpinny.showingQueue=true;var runShowScheduler=function(){StatusSpinny.hide(100,null,function(){if(StatusSpinny.showQueue.length>
2){for(var queuedShow=StatusSpinny.showQueue.shift();StatusSpinny.showQueue.length>1&&queuedShow.message==StatusSpinny.showQueue[1].message;)StatusSpinny.showQueue=StatusSpinny.showQueue.slice(2);queuedShow.fn()}else if(StatusSpinny.showQueue.length>0)StatusSpinny.showQueue.shift().fn();else{StatusSpinny.showingQueue=false;return null}window.setTimeout(runShowScheduler,1500)})};runShowScheduler()}},wouldShowAfter:function(afterTime,speed,spins,message,duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,function(){StatusSpinny.show(speed,spins,message,duration)});window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},afterTime);return uniqueTimeoutID},hide:function(speed,cancelID,animCB){if(cancelID!==undefined&&typeof cancelID=="string")StatusSpinny.spinny().off(cancelID);if(speed===undefined)speed="fast";StatusSpinny.spinny().fadeOut(speed,animCB);StatusSpinny.isShown=false},timeout:function(duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,StatusSpinny.hide);StatusSpinny.timeouts.push(uniqueTimeoutID);window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},duration)},resetTimeouts:function(){for(;StatusSpinny.timeouts.length>0;)StatusSpinny.spinny().off(StatusSpinny.timeouts.shift())},timeoutId:function(){return(new Date).getTime()+""+Math.random()},zzz:null};var TaskQueue=function(){this.queue=[]};
TaskQueue.prototype.addTask=function(task,delay){this.queue.push({task:task,delay:delay})};TaskQueue.prototype.run=function(){var item=this.queue.shift();var self=this;if(item)setTimeout(function(){item.task();self.run()},item.delay)};var PromiseQueue=function(){this._queue=[]};PromiseQueue.prototype.add=function(fn){this._queue.push(fn);if(this._queue.length===1)this.execute()};
PromiseQueue.prototype.execute=function(){var self=this;if(this._queue.length===0)return;var firstFn=this._queue[0];firstFn().then(function(){self._queue.splice(self._queue.indexOf(firstFn),1);self.execute()})};
var Templ=function(){function formatAsterisks(input,tag){input=""+input;var out="";for(ASTERISKS_REGEXP.lastIndex=0;true;){var start=ASTERISKS_REGEXP.lastIndex;var m=ASTERISKS_REGEXP.exec(input);if(m){out+=input.substring(start,m.index);out+=m[1];if(tag)out+="\x3c"+tag+"\x3e";out+=m[2];if(tag)out+="\x3c/"+tag+"\x3e"}else{out+=input.substring(start,input.length);break}}return out}function equalOperator(l,r){if(l==Templ.EMPTY)return l.equals(r);else if(r==Templ.EMPTY)return r.equals(l);else return Expression.evaluate_comparison("\x3d\x3d",
l,r)}function addNoFollow(display,linkAttribs){var host=display.split("/")[0];var m;if(BANDCAMP_DOT_COM_REGEX.test(host))return linkAttribs;else if(m=REL_ATTR_REGEX.exec(linkAttribs)){var val=m[1];if(val.indexOf("nofollow")===-1)val+=" nofollow ugc";return linkAttribs.substring(0,m.index)+'rel\x3d"'+val+'"'+linkAttribs.substring(m.index+m[0].length)}else return linkAttribs+' rel\x3d"nofollow ugc"'}var getPageData=function(){var el=document.querySelector("#pagedata");return el&&JSON.parse(el.dataset.blob)};
var EN_DEFAULT="en";var pageData=getPageData();var locale=pageData&&pageData.locale||EN_DEFAULT;var locale_suffix=locale!==EN_DEFAULT?"."+locale:"";var start_re="(\\s+|^)";var open_paren_re="(\\()?";var scheme_re="(http://|https://)?";var host_re="(([^@\\./\\s\\/'\"\x3e\x3c\x26]+)(\\.[^@\\./\\s\\/'\"\x3e\x3c\x26]+)*(\\.[a-z]{2,}))";var port_re="(?::\\d+)?";var path_re="(/[^?\\s]*?)?";var params_re="(\\?[^#\\s]*?)?";var anchor_re="(#[^\\s]*?)?";var close_paren_re="(\\))?";var end_re="([.,;](\\s|$)|\\s+|$)";
var email_address_re="([^\\s\\(\\)\"'/\x3e\x3c,@]+@\\w([^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)";var email_start_re="(\\s+\\(?|^\\(?)";var email_end_re="(\\)?\\s+|\\)?$)";var url_or_email_loose_contextual=new RegExp(start_re+open_paren_re+scheme_re+host_re+port_re+path_re+params_re+anchor_re+close_paren_re+end_re+"|"+email_start_re+email_address_re+email_end_re,"i");var url_loose_contextual=new RegExp(start_re+open_paren_re+scheme_re+host_re+port_re+path_re+params_re+
anchor_re+close_paren_re+end_re);var tld_set={".com":true,".ru":true,".org":true,".net":true,".de":true,".jp":true,".uk":true,".br":true,".it":true,".pl":true,".fr":true,".in":true,".au":true,".ir":true,".info":true,".nl":true,".cn":true,".es":true,".cz":true,".kr":true,".ca":true,".eu":true,".ua":true,".co":true,".gr":true,".za":true,".ro":true,".biz":true,".ch":true,".se":true,".tw":true,".mx":true,".vn":true,".hu":true,".be":true,".tr":true,".at":true,".dk":true,".tv":true,".me":true,".ar":true,
".sk":true,".no":true,".us":true,".fi":true,".id":true,".cl":true,".xyz":true,".io":true,".pt":true,".by":true,".il":true,".ie":true,".nz":true,".kz":true,".hk":true,".lt":true,".cc":true,".my":true,".sg":true,".club":true,".bg":true,".edu":true,".pk":true,".su":true,".top":true,".th":true,".hr":true,".rs":true,".pe":true,".pro":true,".si":true,".lv":true,".az":true,".pw":true,".ae":true,".ph":true,".online":true,".ng":true,".ee":true,".ws":true,".ve":true,".pizza":true,".cat":true};var HTTPS_DOMAINS=
["bandcamp\\.com","bigcartel\\.com","blogspot\\.com","dailymotion\\.com","facebook\\.com","instagram\\.com","myspace\\.com","patreon\\.com","soundcloud\\.com","spotify\\.com","tumblr\\.com","twitter\\.com","vimeo\\.com","wordpress\\.com","youtu\\.be","youtube\\.com"];var HTTPS_DOMAIN_REGEX=new RegExp("(^|\\.)("+HTTPS_DOMAINS.join("|")+")$");var INVALID_WWW_DOMAINS=["bandcamp\\.com","blogspot\\.com","bigcartel\\.com","tumblr\\.com","wordpress\\.com"];var INVALID_WWW_REGEX=new RegExp("^www\\.(\\w+\\.("+
INVALID_WWW_DOMAINS.join("|")+"))$");var BANDCAMP_DOT_COM_REGEX=/\.?bandcamp.com$/i;var REL_ATTR_REGEX=/\brel=["']([^"']*)["']/i;var ASTERISKS_REGEXP=/(^|\s)\*(\S|\S.*?\S)\*(?=\s|$)/g;return{cfgFlags:pageData&&pageData.cfg||{},locale:locale,locale_suffix:locale_suffix,templates:{},globals:null,register:function(hashOfTemplates){Object.assign(Templ.templates,hashOfTemplates)},getGlobals:function(){if(!Templ.globals){var pageData=getPageData();var newGlobals=pageData&&pageData.templglobals;var oldGlobals=
typeof TemplGlobals!="undefined"?TemplGlobals:null;Templ.globals=Object.assign({},oldGlobals,newGlobals)}return Templ.globals},RENDER_SPEED_TEST:false,render:function(templName,hash){var myhash=Object.assign({},Templ.getGlobals(),hash);var context=new Templ.Context(myhash);var out=[];if(this.RENDER_SPEED_TEST){Log.debug("\x3e\x3e\x3e start rendering "+templName);var start_date=new Date;for(var i=0;i<100;++i){out=[];Templ.renderInternal(templName,context,out)}var end_date=new Date;Log.debug("\x3e\x3e\x3e end rendering "+
templName+" - "+(end_date-start_date)/100+"ms")}else{Templ.current_context=context;Templ.renderInternal(templName,context,out);Templ.current_context=null}return out.join("")},runWithContext:function(cb){var context=new Templ.Context(Templ.getGlobals());Templ.current_context=context;cb();Templ.current_context=null},renderElem:function(el,templName,hash){el=elt(el);el.innerHTML=Templ.render(templName,hash)},renderTableRow:function(el,templName,hash){el=elt(el);var parent=document.createElement("DIV");
parent.innerHTML="\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e"+Templ.render(templName,hash)+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";for(var newrow=parent.firstChild.firstChild.firstChild;el.firstChild!=null;)el.removeChild(el.firstChild);for(;newrow.firstChild!=null;)el.appendChild(newrow.removeChild(newrow.firstChild))},renderInternal:function(templName,context,out){var tokens=Templ.templates[templName+Templ.locale_suffix]?Templ.templates[templName+Templ.locale_suffix]:Templ.templates[templName];if(!tokens){var msg=
"[template not found: "+templName+"]";out.push(msg);Log.server(msg,"warn")}else Templ.renderTokens(tokens,context,out)},renderTokens:function(tokens,context,out){if(tokens)for(var i=0;i<tokens.length;i++){var token=tokens[i];if(typeof token==="string")out.push(token);else try{Templ.renderOneToken(token,context,out)}catch(e){Log.error("Error rendering token",token,"context",context);throw e;}}},renderOneToken:function(token,context,out){var i;var block;switch(token.type){case "translate":Templ.renderTokens(token.nodelist,
context,out);break;case "translatePlural":for(i=0;i<token.blocks.length;i++){block=token.blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "translateVariable":Templ.renderTokens(token.nodelist,context,out);break;case "variable":if(!token.name)return;var value=Expression.eval(token.name,function(term){return context.resolve(term)});var filters=Templ.filters;Iter.each(token.filters,function(filterToken){var args=Iter.collect(filterToken[1],
function(thisArg){return context.resolve(thisArg)});var filterFn=filterToken[0]?filters[filterToken[0]]:null;if(!filterFn){value="[template error: filter not found: "+filterToken[0]+"]";Log.error(value)}else{args.unshift(value);value=filterFn.apply(null,args)}});if(value!=null){if(Array.isArray(value))value=value.join("");out.push(value)}break;case "assign":context.hash[token.to]=context.resolve(token.from);break;case "case":case "if":var blocks=token.blocks;for(i=0;i<blocks.length;i++){block=blocks[i];
if(Templ.evalCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "for":var collection=context.resolve(token.collection_name);if(collection instanceof Templ.Range)collection=collection.expand();var nodelist=token.nodelist;var offset=token.attribs.offset!=null?context.resolve(token.attribs.offset):0;var limit=collection?collection.length-offset:0;if(token.attribs.limit!=null)limit=Math.min(limit,context.resolve(token.attribs.limit));var collectionSlice=collection?
collection.slice(offset,offset+limit):[];if(token.reversed)collectionSlice.reverse();context.stashLoopvars();for(i=0;i<limit;i++){context.hash[token.variable_name]=collectionSlice[i];context.hash.forloop={"length":limit,"index":i+1,"index0":i,"rindex":limit-i,"rindex0":limit-i-1,"first":i===0,"last":i===limit-1};Templ.renderTokens(nodelist,context,out)}context.restoreLoopvars();break;case "include":var subtemplateName=context.resolve(token.template_name);Templ.renderInternal(subtemplateName,context,
out);break;case "capture":var capture_out=[];Templ.renderTokens(token.nodelist,context,capture_out);var strval="";for(i=0;i<capture_out.length;i++)strval+=capture_out[i];context.hash[token.to]=strval;break;case "ef":blocks=token.blocks;for(i=0;i<blocks.length;i++){block=blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "let":context.hash[token.variable]=Expression.eval(token.expression,function(term){return context.resolve(term)});
break}},evalNCondition:function(block,context){if(block.type=="else_ncondition")return true;return Templ.isTrue(Expression.eval(block.expression,function(term){return context.resolve(term)}))},evalCondition:function(block,context){if(block.type=="else_condition")return true;var result;var left=context.resolve(block.left);var operator=block.operator;if(!operator)result=Templ.isTrue(left);else{var operatorFn=Templ.operators[operator];if(!operatorFn){Log.error("template: unrecognized operator: "+operator);
return false}var right=context.resolve(block.right);result=operatorFn(left,right)}if(block.child_relation=="or")result=Templ.isTrue(result)||Templ.isTrue(Templ.evalCondition(block.child_condition,context));else if(block.child_relation=="and")result=Templ.isTrue(result)&&Templ.isTrue(Templ.evalCondition(block.child_condition,context));return result},isTrue:function(val){return val!==false&&val!=null},EMPTY:{equals:function(other){if(other==this)return true;return!other||other.toString()===""}},Range:function(start,
end){this.start=start;this.end=end;this.expand=function(){var out=[];for(var i=this.start;i<=this.end;i++)out.push(i);return out}},operators:{"\x3d\x3d":equalOperator,"!\x3d":function(l,r){return!equalOperator(l,r)},"\x3c\x3e":function(l,r){return!equalOperator(l,r)},"\x3c":function(l,r){return Expression.evaluate_comparison("\x3c",l,r)},"\x3e":function(l,r){return Expression.evaluate_comparison("\x3e",l,r)},"\x3c\x3d":function(l,r){return Expression.evaluate_comparison("\x3c\x3d",l,r)},"\x3e\x3d":function(l,
r){return Expression.evaluate_comparison("\x3e\x3d",l,r)},"contains":function(l,r){if(typeof l==="string")return l.indexOf(r)>=0;if(Array.isArray(l)){for(var i=0;i<l.length;i++)if(l[i]==r)return true;return false}if(l instanceof Templ.Range)return r>=l.start&&r<=l.end;return false}},filters:{size:function(input){return input?input.length:0},downcase:function(input){return input!=null?input.toString().toLowerCase():""},upcase:function(input){return input!=null?input.toString().toUpperCase():""},escape:function(input){return input!=
null?Text.escapeHtml(input.toString()):""},escape_html_attr:function(input){return Templ.filters.escape(input)},noblanks:function(input,aggressive){var s;if(aggressive)s=input.replace(/(\n *)+/g,"").replace(/\n--/g,"\n");else s=input.replace(/(\n *)+/g,"\n").replace(/\n--/g,"\n");return s},strip:function(input){return input!=null?input.toString().trim():""},strip_html:function(input){return input!=null?input.toString().replace(/<.*?>/g,""):""},strip_newlines:function(input){return input!=null?input.toString().replace(/\n/g,
""):""},newline_to_br:function(input){return input!=null?input.toString().replace(/\n/g,"\x3cbr /\x3e\n"):""},newline_to_gap:function(input,collapseMultiple){var search=collapseMultiple?/(\n[\r\t ]*)+\n/g:/\n[\r\t ]*\n/g;return input!=null?input.toString().replace(search,'\x3cbr /\x3e\x3cspan class\x3d"lightweightBreak" /\x3e\x3c/span\x3e\x3cbr /\x3e').replace(/\n/g,"\x3cbr /\x3e\n"):""},replace:function(input,str,repl){return Templ.filters.replace_regex(input,Text.regexpEscape(str),repl)},replace_regex:function(input,
str,repl){if(input==null)return"";if(repl==null)repl="";input=input.toString();var result=input.replace(new RegExp(str,"gm"),repl);return result},replace_first:function(input,str,repl){if(repl==null)repl="";return input!=null?input.toString().replace(str,repl):""},remove:function(input,str){return Templ.filters.replace(input,str)},remove_first:function(input,str){return Templ.filters.replace_first(input,str)},encode_uri_c:function(input){return input!=null?encodeURIComponent(input).replace(/'/g,"%27"):
""},join:function(input,glue){if(glue==null)glue=" ";return Array.isArray(input)?input.join(glue):input},sort:function(input){function comparator(a,b){if(a>b)return 1;if(a<b)return-1;return 0}return Array.isArray(input)?input.slice(0).sort(comparator):input},first:function(input){return Array.isArray(input)?input[0]:null},last:function(input){return Array.isArray(input)&&input.length?input[input.length-1]:null},edit_if_empty:function(input,club_id,fieldname,linktext){if(input&&input.length>0)return input;
return Templ.filters.edit_field(linktext,club_id,fieldname)},edit_field:function(linktext,club_id,fieldname){return'\x3ca href\x3d"/edit?id\x3d'+club_id+"\x26focus\x3d"+fieldname+'"\x3e'+linktext+"\x3c/a\x3e"},date:function(date,format){if(typeof date=="string")date=new Date(Date.parse(date));return Time.strftime(date,format)},time:function(input,format,timezone){return Time.to_ui(input,format,locale,timezone)},ui_datetime:function(input){return input?Time.toUi(input,false,true):""},ui_date:function(input,
fourDigitYear){return input?Time.toUiDate(input,fourDigitYear,true):""},to_date:function(input){return new Date(input*1E3)},relative_day:function(input,format){return input?Time.relative_day(input,format,locale):""},relative_time:function(input,format){return input?Time.relative_time(input,format,locale):""},relative_duration:function(input,verbose){return input?Time.relative_duration(input,verbose,locale):""},json:function(input){return JSON.stringify(input)},plural:function(input,si,pl){if(pl==
null)pl=si+"s";return input=="1"?si:pl},capitalize:function(input){return input.charAt(0).toUpperCase()+input.substring(1).toLowerCase()},capitalize_first_character:function(input){return input.charAt(0).toUpperCase()+input.slice(1)},titlecase:function(input){if(input!=null)return input.toString().replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()});else return""},currency:function(input,currency,numeric,informal,terse){if(input==null)return"";return TextFormat.currency(input,
window.CurrencyData?CurrencyData.info[currency||"USD"]:null,numeric,informal,terse)},money:function(input,currency,format){return TextFormat.money(input,currency,format)},million_usd:function(input){return TextFormat.million_usd(input,locale)},negate:function(input){if(input&&input.is_money)return{amount:-input.amount,currency:input.currency,is_money:true};else if("number"===typeof input)return-input;return""},abs:function(input){if(input&&input.is_money)return{amount:Math.abs(input.amount),currency:input.currency,
is_money:true};else if("number"===typeof input)return Math.abs(input);return""},truncate:function(input,len,ellipsis){ellipsis=ellipsis||"...";return Text.truncate(input,len,ellipsis)},add_query_parm:function(input,query_parm){if(!input)return"";if(query_parm===null||query_parm.length===0)return input;return input+(input.indexOf("?")>-1?"\x26":"?")+query_parm},mb:function(input){return TextFormat.toMb(input)},mb_si:function(input){return TextFormat.toMb(input,true)},url:function(input,isHttps,prefix){var key=
!isHttps?"url":"https_url";if(prefix){prefix=prefix+"";if(prefix.charAt(prefix.length-1)!="_")prefix=prefix+"_";key=prefix+key}return input[key]},commafy:function(input){return TextFormat.commafyNumber(""+input)},smallest_number_text:function(input,maxDigits){var number=parseInt(input);var text=number.toString();if(isNaN(number)||text.length<=maxDigits)return TextFormat.commafyNumber(text);var thousands=Math.floor(number/1E3*10)/10;if(thousands>0)text=thousands+"K";if(text.length<=maxDigits)return text;
thousands=Math.floor(thousands);if(thousands>0)text=thousands+"K";if(text.length<=maxDigits||number<1E6)return text;var millions=Math.floor(number/1E6*10)/10;text=millions+"M";if(text.length<=maxDigits)return text;millions=Math.floor(millions);text=millions+"M";if(text.length<=maxDigits)return text;return text},fan_link:function(input,style){return"\x3ca href\x3d'"+input.trackpipe_url+"' style\x3d'"+style+"'\x3e"+input.name+"\x3c/a\x3e"},add_product_utm:function(input,utm){var result="";if(!input)return result;
var i=0;var m;for(var rest=input;i<300&&(m=url_loose_contextual.exec(rest));){i++;result+=rest.substring(0,m.index);rest=rest.substring(m.index+m[0].length);if(!m[3]&&!tld_set[m[7].toLowerCase()]){result+=m[0];continue}var href=[m[3]||"http://",m[4],m[8],m[9],m[10],m[11]].join("");var extraClosingParen="";if(m[2]==="("&&href[href.length-1]===")"){href=href.substring(0,href.length-1);extraClosingParen=")"}result+=(m[1]||"")+(m[2]||"");result+=href;result+=extraClosingParen;result+=m[12]===undefined?
" ":m[12]}result+=rest;return result},highlight_mention:function(input,username){return input.split("@"+username).join("\x3cspan class\x3d'mention-highlight'\x3e@"+username+"\x3c/span\x3e")},html_autolink:function(input,linkAttribs,allowEmail){allowEmail=allowEmail||true;var result="";if(!input)return result;if(!linkAttribs)linkAttribs="";else if(linkAttribs[0]!==" ")linkAttribs=" "+linkAttribs;input=input.replace(/ +/g," ");var i=0;var m;var regex=allowEmail?url_or_email_loose_contextual:url_loose_contextual;
for(var rest=input;i<300&&(m=regex.exec(rest));){i++;result+=Text.escapeHtml(rest.substring(0,m.index));rest=rest.substring(m.index+m[0].length);if(m[15]){result+=" ";result+=Text.escapeHtml(m[14].substring(m[14].length-1));result+='\x3ca href\x3d"mailto:';result+=Text.escapeHtml(m[15]);result+='"\x3e';result+=Text.escapeHtml(m[15]);result+="\x3c/a\x3e";result+=Text.escapeHtml(m[17]===undefined?" ":m[17])}else{if(!m[3]&&!tld_set[m[7].toLowerCase()]){result+=m[0];continue}var scheme=m[3]=="https://"||
HTTPS_DOMAIN_REGEX.test(m[4])?"https://":"http://";var domain=m[4].replace(INVALID_WWW_REGEX,"$1");var params=m[9]&&"?"+m[9].substr(1).split("\x26").filter(function(p){return p.substr(0,4)!=="utm_"}).join("\x26");var display=[domain,m[8]==="/"?"":m[8],params,m[10],m[11]].join("");var href=[scheme,domain,m[8],m[9],m[10],m[11]].join("");var extraClosingParen="";if(m[2]==="("&&href[href.length-1]===")"){href=href.substring(0,href.length-1);display=display.substring(0,display.length-1);extraClosingParen=
")"}result+=" ";result+=Text.escapeHtml((m[1]||"")+(m[2]||""));result+='\x3ca href\x3d"';result+=Text.escapeHtml(href);result+='"';result+=addNoFollow(display,linkAttribs);result+="\x3e";result+=Text.escapeHtml(display);result+="\x3c/a\x3e";result+=extraClosingParen;result+=Text.escapeHtml(m[12]===undefined?" ":m[12])}result+=" "}result+=Text.escapeHtml(rest);return result},plus:function(a,b){return a+b},minus:function(a,b){return a-b},times:function(a,b){return a*b},divided_by:function(a,b){if(a==
Math.floor(a)&&b==Math.floor(b))return Math.floor(a/b);else return a/b},image:function(info,format){var id_only=typeof info=="number"||!info;var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'src\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'src\x3d"'+url+'" width\x3d"'+dims.width+'" height\x3d"'+dims.height+'"'}},image_url:function(image_id,format){return ImageUtils.imageURL(image_id,format,Templ.current_context.resolve("is_https"))},
art:function(art_id,format){var url=Templ.filters.art_url(art_id,format);return'src\x3d"'+url+'"'},art_url:function(art_id,format){return ImageUtils.artURL(art_id,format,Templ.current_context.resolve("is_https"))},popup_image:function(info,format){var id_only=typeof info=="number";var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'href\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'href\x3d"'+url+
'" data-image-size\x3d"'+dims.width+","+dims.height+'"'}},image_width:function(info,format){var dims=ImageUtils.imageDimensions(info.width,info.height,format);return dims.width},image_height:function(info,format){var dims=ImageUtils.imageDimensions(info.width,info.height,format);return dims.height},possessify:function(name){if(name===null||typeof name!=="string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?name+"'":name+"'s";else return name},possessify_smart:function(name){if(name===
null||typeof name!=="string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?name+"\u2019":name+"\u2019s";else return name},enumerate_items:function(items,connector){if(typeof connector==="undefined")connector="and";var f=function(items){if(items.length===0||items===null)return"";if(items.length===1)return items[0];if(items.length===2)return items[0]+" "+connector+" "+items[1];return items[0]+", "+f(items.slice(1,items.length))};return f(items)},fan_page_url:function(username){return Templ.current_context.resolve("siteroot_current")+
"/"+username},band_url:function(url_hints){if(!url_hints)return"";var customDomain=url_hints.custom_domain;var customDomainVerified=url_hints.custom_domain_verified;var subdomain=url_hints.subdomain;var customDomainsActive=Templ.current_context.resolve("custom_domains_active");var basePortStr=Templ.current_context.resolve("base_port_str")||"";var baseDomainWithPort=Templ.current_context.resolve("sitedomain");if(customDomainsActive&&customDomain&&customDomainVerified)return"https://"+customDomain+
basePortStr;else if(subdomain)return location.protocol+"//"+subdomain+"."+baseDomainWithPort;return""},lpad:function(input,amount){if(typeof amount==="undefined")amount=10;input=String(input);var length=input.length;var result="";if(amount-length>0)result=(new Array(amount-length+1)).join(" ");return result+input},asterisks_to_em:function(input){return formatAsterisks(input,"em")},strip_asterisks:function(input){return formatAsterisks(input,null)},tralbum_url:function(url_hints){if(!url_hints)return"";
var pagebase="";switch(url_hints.item_type){case "a":pagebase="/album/";break;case "t":pagebase="/track/";break;case "p":pagebase="/merch/";break;case "c":pagebase="/campaign/";break}return Templ.filters.band_url(url_hints)+pagebase+url_hints.slug},subscribe_url:function(url_hints){if(!url_hints)return"";var url_fragment=url_hints.subscribe_url_fragment||"subscribe";return Templ.filters.band_url(url_hints)+"/"+url_fragment},featured_track_url:function(url_hints,featured_track_number){if(!url_hints)return"";
return Templ.filters.tralbum_url(url_hints)+"?t\x3d"+featured_track_number},hex_to_rgb:function(hex){if(!hex)return null;if(hex[0]==="#")hex=hex.substring(1);if(!hex.match(/[0-9A-Fa-f]{6}/))return null;var bigint=parseInt(hex,16);var r=bigint>>16&255;var g=bigint>>8&255;var b=bigint&255;return r+", "+g+", "+b},fixnum:function(number,decimals){return number.toFixed(decimals)},wrap_emojis:function(input){var emojiRegexp=/(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5-\uDED7\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])\uFE0F/g;
if(input.match(emojiRegexp)){var formatted=input.replace(emojiRegexp,function(emoji){return"\x3cspan class\x3d'emoji'\x3e"+emoji+"\x3c/span\x3e"});return"\x3cspan\x3e"+formatted+"\x3c/span\x3e"}else return input}},Context:function(hash){this.hash=hash||{};this.loopvars=null}}}();Templ.filters.h=Templ.filters.escape;Templ.filters.a=Templ.filters.attr=Templ.filters.escape_html_attr;Templ.filters.u=Templ.filters.encode_uri_c;
Templ.Context.prototype=function(){var VAR_REGEX=/\[[^\]]+\]|[\w-]+\??/g;var BRACKETED_REGEX=/^\[(.+)\]$/;return{resolve:function(name){switch(name){case null:case "nil":case "null":case "":return null;case "true":return true;case "false":return false;case "empty":return Templ.EMPTY}var match;if(match=/^'(.*)'$/.exec(name))return match[1];if(match=/^"(.*)"$/.exec(name))return match[1];if(/^\d+$/.test(name))return parseInt(name);if(match=/^\((\S+)\.\.(\S+)\)$/.exec(name))return new Templ.Range(this.resolve(match[1]),
this.resolve(match[2]));if(/^(\d[\d\.]+)$/.test(name))return parseFloat(name);return this.variable(name)},variable:function(nameExpr){var savedLastIndex=VAR_REGEX.lastIndex;VAR_REGEX.lastIndex=0;var val=this.hash;var m;var n;var part;try{for(;m=VAR_REGEX.exec(nameExpr);){part=m[0];if(n=BRACKETED_REGEX.exec(part))part=this.resolve(n[1]);if((part==="size"||part==="first"||part==="last")&&!(val&&"object"===typeof val&&val.hasOwnProperty(part)))val=Templ.filters[part](val);else val=val&&val[part]}return val}finally{VAR_REGEX.lastIndex=
savedLastIndex}},stashLoopvars:function(){var vars=this.hash.forloop;if(vars){this.loopvars=this.loopvars||[];this.loopvars.push(vars)}},restoreLoopvars:function(){if(this.loopvars)this.hash.forloop=this.loopvars.pop()}}}();
var HTMLEmbeddedPlayer3=function(){function HEP(playlist,params,playerdata){var self=this;this._playlist=playlist;this._params=params;this._playerdata=playerdata;this._tracklistelems=[];this._artist=playerdata.artist;this._elems={};this._root_elem=document.getElementById("player");for(var x in ALL_ELEMS){var name=ALL_ELEMS[x];this._elems[name]=document.getElementById(name)}this._albumtitle=playerdata.album_title;this._is_exclusive=!!params["esig"]||!!params["fesig"];this.effectively_single_track=
false;if(this._is_exclusive&&this._playlist.first_playable_track===this._playlist.last_playable_track)this.effectively_single_track=true;this._hookup_ui();if(params.bgcol){if(!params.transparent)this._elems.player.style.background="#"+params.bgcol;if(Color.isDark(params.bgcol)){addClass(document.body,"invertIconography");addClass(this._root_elem,"theme-dark")}}var is_twittercard=params.twittercard&&params.twittercard=="true";var linkurl=playerdata.linkback+"?from\x3d"+(is_twittercard?"twittercard":
"embed")+(params.daily?"\x26context\x3ddaily":"");var campaign_string="";if(params.campaign&&params.campaign!=""&&params.campaign.length<=50&&/^[a-z0-9_-]+$/.test(params.campaign)){campaign_string="\x26campaign\x3d"+params.campaign;linkurl+=campaign_string}this._elems.maintextlink.href=linkurl;this._elems.subtextlink.href=linkurl;this._elems.tracknamelink.href=linkurl;this._elems.artlink.href=linkurl;$(this._root_elem).find(".artlink").attr("href",linkurl);this._elems.infolink.href=linkurl;$(this._root_elem).find(".logo").attr("href",
linkurl);this._elems.logoalt.href=linkurl;this._elems.logoalt2.href=linkurl;this._elems.buyordownloadlink.href=playerdata.linkback+"?action\x3d"+(playerdata.linkback_action?playerdata.linkback_action:"download")+"\x26from\x3d"+(is_twittercard?"twittercard":"embed")+(params.daily?"\x26context\x3ddaily":"")+campaign_string;this._elems.buyordownloadlinkalt.href=this._elems.buyordownloadlink.href;this._elems.sharelink.href=playerdata.linkback+"?action\x3dshare"+"\x26from\x3d"+(is_twittercard?"twittercard":
"embed")+(params.daily?"\x26context\x3ddaily":"")+campaign_string;this._elems.sharelinkalt.href=this._elems.sharelink.href;$(this._elems.sharelink).click(this._makehandler("_handle_share_click"));$(this._elems.sharelinkalt).click(this._makehandler("_handle_share_click"));if(playerdata.linkback_action){var linkclass=playerdata.linkback_action=="buy"?"buy":"download";$(this._root_elem).addClass(linkclass);if(this._is_exclusive){if(playerdata.is_preorder)$(this._root_elem).addClass("preorder");else $(this._root_elem).addClass("optional-streaming");
this._elems.buyordownloadlink.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download";this._elems.buyordownloadlinkalt.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download"}else{if(playerdata.is_preorder)$(this._root_elem).addClass("preorder");this._elems.buyordownloadlink.innerHTML=playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download";this._elems.buyordownloadlinkalt.innerHTML=
playerdata.linkback_action=="buy"?playerdata.is_preorder==1?"pre-order":"buy":"download"}}else{this._elems.buyordownload.style.display="none";this._elems.buyordownloadalt.style.display="none"}var track_index=null;if(params.album&&params.track){var target_id=Number(params.track);for(var i=0;i<playlist.length();i++){var info=playlist.get_track_info(i);if(info.id==target_id){params.t=i+1;break}}}if(params.t){var t=Number(params.t)-1;if(t>=0&&t<playlist.length()){track_index=t;playlist.set_initial_track(track_index)}}if(track_index!=
null&&params.size=="small"&&params.album){info=playlist.get_track_info(track_index);this._elems.tracknamelink.href=info.title_link;playlist.load([info])}else for(i=0;i<playlist.length();i++){info=playlist.get_track_info(i);var item=this._create_playlist_item(info);var that=this;if(info.file)$(item).click(function(n){return function(){that._playlist.play_track(n)}}(i));else $(item).addClass("nostream");$(this._elems.tracklist_ul).append(item);this._tracklistelems[info.tracknum+1]=item}var wparam=params["width"];
if(wparam&&wparam.match(/^[0-9]+$/))$(this._root_elem).css("width",wparam+"px");var size=params["size"];var artparam=params["artwork"];var hastracklist=size=="large"&&(params["notracklist"]!="true"&&params["tracklist"]!="false");var noartwork=(size=="large"||size=="medium")&&(artparam=="none"||artparam=="false");var smallartwork=size=="medium"&&artparam!="none"&&artparam!="false";if(hastracklist)$(this._root_elem).addClass("hastracklist");if(noartwork)$(this._root_elem).addClass("noartwork");if(smallartwork)$(this._root_elem).addClass("smallartwork");
if(params["package"]&&playerdata.packages){addClass(this._root_elem,"hasmerch");var pkgid=Number(params["package"]);for(i=0;i<playerdata.packages.length;i++){var pkg=playerdata.packages[i];if(pkg.id!=pkgid)continue;this._package=pkg;if(pkg.arts)for(var artidx=0;artidx<pkg.arts.length;artidx++){var art=pkg.arts[artidx];if(!art)continue;var thumb=document.createElement("div");var thumburl=ImageUtils.imageURL(art.image_id,"art_thumbthumb");addClass(thumb,"merchthumb");thumb.style.backgroundImage="url("+
thumburl+")";var handler=function(ui,artidx,thumb){var th=thumb;return function(e){$(".merchthumb").removeClass("selected");if(ui._showing_package_image!=artidx)$(th).addClass("selected");U.stopEvent(e);ui.toggle_package_image(artidx)}}(this,artidx,thumb);$(thumb).click(handler);this._elems.merch.appendChild(thumb)}break}}if(this.isAlbum())if(!this.effectively_single_track)addClass(this._root_elem,"albumplayer");else addClass(this._root_elem,"standalonetrackplayer");else if($(this._root_elem).is(".classic"))addClass(this._root_elem,
"trackplayer");else if(this._albumtitle&&this._albumtitle!="")addClass(this._root_elem,"albumtrackplayer");else addClass(this._root_elem,"standalonetrackplayer");if(this._is_exclusive)addClass(this._root_elem,"exclusive");this._choose_size_classes();this._root_elem.style.display="block";this._switch_track_artwork(track_index);this._setup_infolayer();this._adjust_tracklist();$(window).resize(function(){self._choose_size_classes();self._setup_infolayer();self._adjust_tracklist()});try{window.parent.postMessage("playerinited",
"*")}catch(e){Log.warn("failed to postMessage: "+e)}}function find_art_format(width,anim){var squarethumbs=[];for(var i=0;i<TemplGlobals.image_formats.length;i++){var fmt=TemplGlobals.image_formats[i];if(fmt.resize_algo=="thumb"&&fmt.height==fmt.width&&(anim&&fmt.anim_ok||!anim&&!fmt.anim_ok))squarethumbs.push(fmt)}squarethumbs.sort(function(a,b){return a.width-b.width});if(anim)width=width*2;for(i=0;i<squarethumbs.length;i++)if(squarethumbs[i].width>=width)return squarethumbs[i].name;return squarethumbs[squarethumbs.length-
1].name}HEP.prototype={_switch_track_artwork:function(track_index){var self=this;$(this._root_elem).find(".art, #art").each(function(index,elem){elem=$(elem);if(!elem.is(":visible"))return;var artWidth=elem.width();var elemId=elem.attr("id");var arturl=self._track_art_url(track_index,artWidth);if(elemId=="art"){artWidth=$(self._elems.art).width();arturl=self._track_art_url(track_index,artWidth);self._original_art=arturl;if(self._showing_package_image)return}elem.css("backgroundImage","url("+arturl+
")")})},toggle_package_image:function(i){if(this._showing_package_image==i){this._elems.art.style.backgroundImage="url("+this._original_art+")";this._showing_package_image=null}else{var pkg=this._package;this._elems.art.style.backgroundImage="url("+ImageUtils.imageURL(pkg.arts[i].image_id,"screen")+")";this._showing_package_image=i}},_hookup_ui:function(){$(this._elems.play).click(this._makehandler("_handle_play_click"));$(this._elems.tinyplayer).click(this._makehandler("_handle_tiny_click"));$(this._elems.next).click(this._makehandler("_handle_next_click"));
$(this._elems.prev).click(this._makehandler("_handle_prev_click"));$("#artlink").click(this._makehandler("_handle_art_click"));$(".artlink").click(this._makehandler("_handle_art_click"));$("#artarea").click(this._makehandler("_handle_art_click"));$(".art").click(this._makehandler("_handle_art_click"));this._playlist.onstatechanged(this._handle_playlist_statechanged,this);this._playlist.ontime(this._handle_playlist_time,this);this._playlist.onloaded(this._handle_playlist_loaded,this);this._playlist.ontrackchanged(this._handle_playlist_trackchanged,
this);this._playlist.onplaylistchanged(this._handle_playlist_playlistchanged,this);var track=this._playlist.get_track();this._handle_playlist_trackchanged(this._playerdata.tracks[track]);this._handle_playlist_time({position:0});$("#shareurl").focus(function(){$(this).select().one("mouseup",function(e){$(this).unbind("keyup");e.preventDefault()}).one("keyup",function(){$(this).select().unbind("mouseup")})});if(this._is_iphone())$(this._elems.timeline).on("touchstart",this._makehandler("_handle_seek_touchstart"));
else $(this._elems.progbar_thumb).draggable({start:this._makehandler("_handle_thumb_startdrag"),drag:this._makehandler("_handle_thumb_drag"),stop:this._makehandler("_handle_thumb_enddrag"),containment:"parent",axis:"x"})},_adjust_tracklist:function(){if($(this._root_elem).hasClass("has_info_slider")){$(this._root_elem).removeClass("hastracklist");return}var viewheight=$(this._root_elem).height();var tl=$(this._elems.tracklist);var il=$(this._elems.infolayer);var ilbottom=il.position().top+il.outerHeight();
var tltop=tl.position().top;var tlbottom=tl.outerHeight()+tltop;var bottom_pad=$("#nonartarea").outerHeight()-$("#nonartarea").height();tl.css("height",viewheight-ilbottom-bottom_pad+"px")},_scroll_tracklist:function(tracknum){var list=$("#tracklist");var li=$("#tracklist li")[tracknum-1];if(!li)return;var li_top=$(li).position().top-$("#tracklist").position().top;var li_bot=li_top+$(li).outerHeight();var listpos=list.scrollTop();var listheight=list.outerHeight();if(li_top<0)list.scrollTop(listpos+
li_top);else if(li_bot>listheight)list.scrollTop(listpos+li_bot-listheight)},_setup_infolayer:function(){removeClass(this._root_elem,"has_info_slider");removeClass(this._elems.infolayer,"fixed");var infolayer=$(this._elems.infolayer);var artwidth=$("#artarea").width();var artheight=$("#artarea").height();var playerwidth=$(this._root_elem).width();var playerheight=$(this._root_elem).height();if(playerheight>artheight||playerwidth>artwidth){addClass(this._elems.infolayer,"fixed");return}var infopos=
infolayer.position();var ix=infopos.left;var iy=infopos.top;var iw=infolayer.outerWidth();var ih=infolayer.outerHeight();this._infolayer_show_x=null;this._infolayer_show_y=null;if(ix<0)this._infolayer_show_x=0;else if(ix>=playerwidth)this._infolayer_show_x=playerwidth-iw;if(iy<0)this._infolayer_show_y=0;else if(iy>=playerheight)this._infolayer_show_y=playerheight-ih;if(this._infolayer_show_x!=null||this._infolayer_show_y!=null){addClass(this._root_elem,"has_info_slider");this._infolayer_hide_x=ix;
this._infolayer_hide_y=iy;if(this._infolayer_show_x===null)this._infolayer_show_x=ix;if(this._infolayer_show_y===null)this._infolayer_show_y=iy;infolayer.css({left:ix+"px",top:iy+"px",bottom:"auto"});$(this._root_elem).on("mouseenter",this._makehandler("_handle_hover")).on("mouseleave",this._makehandler("_handle_unhover"));$(window).resize(this._makehandler("_handle_doc_resize"))}},_choose_size_classes:function(){removeClass(this._elems.play,"big");if($(this._elems.play).width()>35)addClass(this._elems.play,
"big")},_handle_doc_resize:function(){if(this._infolayer_hide_x>0){var xoff=$(this._root_elem).width()-this._infolayer_hide_x;this._infolayer_hide_x+=xoff;this._infolayer_show_x+=xoff}if(this._infolayer_hide_y>0){var yoff=$(this._root_elem).height()-this._infolayer_hide_y;this._infolayer_hide_y+=yoff;this._infolayer_show_y+=yoff}if(this._infolayer_hide_x>0||this._infolayer_hide_y>0)this._handle_unhover()},_makehandler:function(name){var that=this;return function(event){that[name].apply(that,[event])}},
_handle_hover:function(){if($(this._root_elem).hasClass("has_info_slider")){var infolayer=$(this._elems.infolayer);infolayer.stop(true,false).delay(400).animate({left:this._infolayer_show_x+"px",top:this._infolayer_show_y+"px",opacity:"1"},"fast","linear")}},_handle_unhover:function(){if($(this._root_elem).hasClass("has_info_slider")){var infolayer=$(this._elems.infolayer);infolayer.stop(true,false).delay(1E3).animate({left:this._infolayer_hide_x,top:this._infolayer_hide_y,opacity:"0"})}},_handle_play_click:function(event){U.stopEvent(event);
this._playlist.playpause();this._hasplayed()},_handle_tiny_click:function(event){if(event.target.id=="tinyplayer")this._handle_play_click(event)},_handle_next_click:function(event){U.stopEvent(event);this._playlist.next_track();this._playlist.play();this._hasplayed()},_handle_prev_click:function(event){U.stopEvent(event);this._playlist.prev_track();this._playlist.play();this._hasplayed()},_handle_art_click:function(event){U.stopEvent(event);if(!this._classic){event.preventDefault();this._playlist.playpause();
this._hasplayed()}},_handle_share_click:function(event$$0){var vw=$(this._root_elem).width();var vh=$(this._root_elem).height();if(!$(playerui._root_elem).is(".classic")&&vw>=300&&vh>=300){U.stopEvent(event$$0);$("#sharedialog").dialog({width:"280px",height:210,modal:true,position:{at:"center",of:"#artarea"},open:function(event,ui){$(".ui-widget-overlay").bind("click",function(){$("#sharedialog").dialog("close")});if(!this._social_controls_inited){SocialControls.initFromDOM($("#sharedialog"));$(".share-embed-container").show();
this._social_controls_inited=true}}})}},_handle_playlist_statechanged:function(arg){switch(arg.newstate){case "PLAYING":addClass(this._root_elem,"playing");removeClass(this._elems.play,"busy");addClass(this._elems.play,"playing");addClass(this._elems.tinyplayer,"playing");break;case "BUFFERING":case "BUSY":addClass(this._root_elem,"playing");removeClass(this._elems.play,"playing");addClass(this._elems.play,"busy");addClass(this._elems.tinyplayer,"playing");break;default:if(arg.newstate=="COMPLETED")this._handle_playlist_time({position:0});
removeClass(this._root_elem,"playing");removeClass(this._elems.tinyplayer,"playing");removeClass(this._elems.play,"busy");removeClass(this._elems.play,"playing");break}},_handle_playlist_time:function(arg){if(!this._dragging)this._trackpos=arg.position;if(arg.duration)this._tracklength=arg.duration;this._updateprog()},_handle_playlist_loaded:function(arg){this._loadpercent=arg;this._updateprog()},_handle_playlist_trackchanged:function(trackinfo){this._trackinfo=trackinfo;this._tracklength=trackinfo.duration;
this._songtitle=trackinfo.title||"";var listelem=this._tracklistelems[this._currentTrack];if(listelem)removeClass(listelem,"currenttrack");this._currentTrack=trackinfo.tracknum+1;this._scroll_tracklist(this._currentTrack);listelem=this._tracklistelems[this._currentTrack];if(listelem)addClass(listelem,"currenttrack");$("#tracklist .currenttrack .currenttime").html(Time.timeStr(0));this._numTracks=this._playlist.length;this._update_text();this._updateprog();this._showhide_nextprev();this._switch_track_artwork(this._currentTrack-
1)},_handle_playlist_playlistchanged:function(arg){var ti=this._playlist.get_track_info();if(ti)this._handle_playlist_trackchanged(ti)},_handle_thumb_startdrag:function(event){this._dragging=true;this._playlist.seeking=true;this._dragoffset=event.pageX-$(event.target).offset().left},_handle_thumb_drag:function(event){var progLeft=$(this._elems.timeline).offset().left;var progRange=$(this._elems.timeline).width()-$(this._elems.progbar_thumb).width();var pos=event.pageX-progLeft-this._dragoffset;if(pos<
0)pos=0;else if(pos>progRange)pos=progRange;pos*=this._tracklength/progRange;this._trackpos=pos;this._updateprog()},_handle_thumb_enddrag:function(event){this._playlist.seek(this._trackpos);this._dragging=false;this._playlist.seeking=false;this._hasplayed()},_create_playlist_item:function(trackinfo){var item=$("\x3cli\x3e");var title=Text.escapeHtml(trackinfo.title);if(trackinfo.artist&&trackinfo.artist!=""&&trackinfo.artist!=this._artist)title=Text.escapeHtml(trackinfo.artist)+" \x26mdash; "+title;
item.append($("\x3cspan\x3e",{"class":"tracknum",text:trackinfo.tracknum+1+"."}));item.append($("\x3ca\x3e",{"href":"#"}).append($("\x3cspan\x3e",{"class":"tracktitle",html:title})).append($("\x3cspan\x3e",{"class":"currenttime"})).append($("\x3cspan\x3e",{"class":"tracktime",text:Time.timeStr(trackinfo.duration)})));return item},_handle_seek_touchstart:function(event){event.preventDefault();var timeline=$(this._elems.timeline);this._seek_move_handler=this._makehandler("_handle_seek_touchmove");this._seek_end_handler=
this._makehandler("_handle_seek_touchend");this._seek_cancel_handler=this._makehandler("_handle_seek_touchcancel");timeline.on("touchmove",this._seek_move_handler);timeline.on("touchend",this._seek_end_handler);timeline.on("touchcancel",this._seek_cancel_handler);this._playlist.seeking=true;this._dragging=true;this._dragtimerhandler=this._makehandler("_handle_drag_timeout");this._dragtimer=setTimeout(this._dragtimerhandler,1E3)},_handle_seek_touchmove:function(e){var event=e.originalEvent;var thisX=
event.changedTouches[0].pageX;var obj=this._elems.timeline;var thumbWidth=this._elems.progbar_thumb.clientWidth;var scrollMin=thumbWidth/2;do scrollMin+=obj.offsetLeft;while(obj=obj.offsetParent);var scrollMax=scrollMin+this._elems.timeline.clientWidth-thumbWidth;var frac=(thisX-scrollMin)/(scrollMax-scrollMin);if(frac>1)frac=1;else if(frac<0)frac=0;this._trackpos=this._tracklength*frac;this._updateprog();clearTimeout(this._dragtimer);this._dragtimer=setTimeout(this._dragtimerhandler,1E3)},_handle_seek_touchend:function(event){clearTimeout(this._dragtimer);
this._finishdrag(true)},_handle_seek_touchcancel:function(event){this._finishdrag(false)},_handle_drag_timeout:function(event){this._finishdrag(true)},_finishdrag:function(doseek){var timeline=$(this._elems.timeline);timeline.off("touchmove",this._seek_move_handler);timeline.off("touchend",this._seek_end_handler);timeline.off("touchcancel",this._seek_cancel_handler);this._playlist.seeking=false;this._dragging=false;if(doseek){if(this._trackpos==this._tracklength)this._playlist.next_track();else if(this._trackpos==
0&&this._seekorigpos<3)this._playlist.prev_track();else this._playlist.seek(this._trackpos);this._hasplayed()}},isAlbum:function(){return!!this._params.album},_update_text:function(){var title=Text.escapeHtml(this._songtitle||"");if(this._trackinfo.artist&&this._trackinfo.artist!==""&&this._trackinfo.artist!==this._artist){title=Text.escapeHtml(this._trackinfo.artist)+" \x26mdash; "+title;this._elems.artist.innerHTML=Text.escapeHtml(this._trackinfo.artist)}else this._elems.artist.innerHTML=Text.escapeHtml(this._artist||
"");if(this.isAlbum()){this._elems.maintextlink.innerHTML=Text.escapeHtml(this._albumtitle||"");this._elems.tracknamelink.innerHTML=Text.escapeHtml(this._songtitle||"");this._elems.currenttitle_title.innerHTML=title;this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."}else{this._elems.maintextlink.innerHTML=Text.escapeHtml(this._songtitle||"");this._elems.currenttitle_title.innerHTML=title;this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||
"")+"."}this._elems.subtextlink.innerHTML=Text.escapeHtml(this._trackinfo.artist||"");this._elems.album.innerHTML=Text.escapeHtml(this._albumtitle||"")},_updateprog:function(){var fillwidth=$("#timeline .progbar_empty").width();var thumbrange=fillwidth-this._elems.progbar_thumb.offsetWidth;var thumbpos=this._tracklength?this._trackpos/this._tracklength*thumbrange:0;this._elems.progbar_thumb.style.left=Math.round(thumbpos)+"px";this._elems.progbar_fill.style.width=(this._loadpercent||0)+"%";this._elems.currenttime.innerHTML=
Time.timeStr(this._trackpos);this._elems.totaltime.innerHTML=Time.timeStr(this._tracklength>1?this._tracklength:1);if(!this._playlist.seeking){var loadedlength=this._loadpercent/100*this._tracklength;var playedpct=loadedlength>0?100*(this._trackpos/loadedlength):0;this._elems.progbar_fill_played.style.width=playedpct+"%"}$("#tracklist .currenttrack .currenttime").html(Time.timeStr(this._trackpos))},_showhide_nextprev:function(){var cur=this._playlist.get_track();var first=this._playlist.first_playable_track;
var last=this._playlist.last_playable_track;if(this._elems.prev)this.showhide_elem(this._elems.prev,first>=0&&cur>first);if(this._elems.next)this.showhide_elem(this._elems.next,last>=0&&cur<last)},showhide_elem:function(elem,bShow){if(bShow)removeClass(elem,"hiddenelem");else addClass(elem,"hiddenelem")},_is_iphone:function(){return Browser.platform=="iphone"},_hasplayed:function(){removeClass(this._root_elem,"initialstate")},_track_art_url:function(track_index,width){var artid=null;if(track_index!=
null){var track=this._playerdata.tracks[track_index];artid=track&&track.art_id}if(!artid){track=this._playlist.get_track();artid=this._playerdata.album_art_id||this._playerdata.tracks[track].art_id}var artformat=find_art_format(width,this._params.anim_ok);return ImageUtils.artURL(artid,artformat)}};var addClass=function(elem,toadd){$(elem).addClass(toadd)};var removeClass=function(elem,toremove){$(elem).removeClass(toremove)};var ALL_ELEMS=["prev","next","play","art","artarea","artlink","artist",
"trackname","tracknamelink","album","maintext","maintextlink","subtext","subtextlink","logoalt","logoalt2","currenttitle","currenttime","totaltime","timeline","linkarea","linkareaalt","tracklist","tinyplayer","progbar_thumb","progbar_fill","progbar_fill_played","currenttitle_tracknum","currenttitle_title","buyordownload","buyordownloadalt","buyordownloadlink","buyordownloadlinkalt","share","sharealt","sharelink","sharelinkalt","infolink","player","tracklist_ul","merch","infolayer"];HEP.init=function(playerdata,
parentpage,params){Sound.whenloaded(function(status){if(playerdata&&status.success){var soundplayer=new Sound.SoundPlayer;var isalbum=!!params.album;var statsource=isalbum?"embedded album player":"embedded track player";var exclusiveParams=null;if(params.esig)exclusiveParams={esig:params.esig,tracks:params.tracks,album:params.album,track:params.track,url_referrer:params.url_referrer};var playlist=new Player.Playlist(soundplayer,statsource,parentpage,{url_params:exclusiveParams});playlist._trackstate=
false;for(var i=0;i<playerdata.tracks.length;i++){var index=playlist.add_track(playerdata.tracks[i]);if(!params.t&&playerdata.tracks[i].id===playerdata.featured_track_id)playlist.set_initial_track(index)}if(params["extratracks"])for(i=playerdata.tracks.length;i<20;i++)playlist.add_track(playerdata.tracks[i%playerdata.tracks.length]);var playerui=new HTMLEmbeddedPlayer3(playlist,params,playerdata);playlist.init_complete(params.t);if(params.twittercard){var h=$("#player").width()*470/350;var meta="width\x3ddevice-width,height\x3d"+
h;$("#viewportmeta").attr("content",meta)}else if(params["facebook.com"])playlist.play()}else if(!playerdata)document.getElementById("badtralbumerror").style.visibility="visible";else document.getElementById("badbrowsererror").style.visibility="visible"})};return HEP}();
(function(){var data=document.currentScript.dataset;window.Browser=JSON.parse(data.browser);window.siteroot_current=JSON.parse(data.siterootCurrent);window.TemplGlobals=JSON.parse(data.templGlobals);if(!JSON.parse(data.useScript))return;var parentpage=JSON.parse(data.parentPage);var playerdata=JSON.parse(data.playerData||"null");var params=JSON.parse(data.params||"{}");var initHep3=JSON.parse(data.initHep3||"false");if(initHep3){Log.debug("initing HTMLEmbeddedPlayer3: "+data.initHep3);document.addEventListener("DOMContentLoaded",
function(){HTMLEmbeddedPlayer3.init(playerdata,parentpage,params)});return}var playerErrors=JSON.parse(data.playerErrors||"null");var playlist=null;var soundplayer=null;var isalbum=!!params.album;var playerui=null;document.addEventListener("DOMContentLoaded",function(){Sound.whenloaded(function(status){if(playerdata&&status.success){soundplayer=new Sound.SoundPlayer;var statsource=isalbum?"embedded album player":"embedded track player";playlist=new Player.Playlist(soundplayer,statsource,parentpage,
{url_params:params});playlist._trackstate=false;for(var i=0;i<playerdata.tracks.length;i++){var index=playlist.add_track(playerdata.tracks[i]);if(!params.t&&playerdata.tracks[i].id===playerdata.featured_track_id)playlist.set_initial_track(index)}if(params["extratracks"])for(i=playerdata.tracks.length;i<20;i++)playlist.add_track(playerdata.tracks[i%playerdata.tracks.length]);playerui=new HTMLEmbeddedPlayer3(playlist,params,playerdata);playlist.init_complete();if(params.twittercard){var h=$("#player").width()*
470/350;var meta="width\x3ddevice-width,height\x3d"+h;$("#viewportmeta").attr("content",meta)}}else if(!playerdata){document.getElementById("player").style.display="block";if(playerErrors&&playerErrors.tralbum_permissions_error){document.getElementById("tralbumpermissionserror").style.visibility="visible";$("#tralbumpermissionserror .hostname").text(playerErrors.tralbum_permissions_error)}else if(playerErrors&&playerErrors.tralbum_wordpress_permissions_error){document.getElementById("tralbumwordpresspermissionserror").style.visibility=
"visible";$("#tralbumwordpresspermissionserror .hostname").text(playerErrors.tralbum_wordpress_permissions_error)}else document.getElementById("badtralbumerror").style.visibility="visible"}else{document.getElementById("player").style.display="block";document.getElementById("badbrowsererror").style.visibility="visible"}})})})();var Player={};
Player.TrackInfo=function(){function TrackInfo(hash){this.update(hash)}TrackInfo.prototype={update:function(hash){var props=PROPS;for(var i=0;i<props.length;i++)this[props[i]]=hash[props[i]];return this},is_playable:function(){return!!this.file},is_busy:function(){return this.encoding_pending&&!this.encoding_error},mark_as_capped:function(){this["is_capped"]=true},copy:function(){var result={};var props=PROPS;for(var i=0;i<props.length;i++)result[props[i]]=this[props[i]];return result}};TrackInfo.is_same=
function(trackinfo_a,trackinfo_b){var props=PROPS;for(var i=0;i<props.length;i++)if(trackinfo_a[props[i]]!=trackinfo_b[props[i]])return false;return true};var PROPS=["tracknum","file","encoding_error","encoding_pending","title","title_link","id","track_license_id","has_lyrics","has_info","is_downloadable","free_album_download","has_free_download","duration","private","album_private","artist","album_preorder","unreleased_track","alt_link","continuous","video_source_type","video_caption","video_id",
"video_mobile_url","is_capped"];return TrackInfo}();
Player.Playlist=function(){function Playlist(player,playing_from,referer,options){options=options||{};this._options=options;this._player=player;this._playlist=[];this._playing_from=playing_from;if(options.url_params&&options.url_params.esig&&(options.url_params.album||options.url_params.track)){referer+="\x26esig\x3d"+options.url_params.esig+"\x26rsig\x3d"+options.url_params.rsig+(options.url_params.album?"\x26album\x3d"+options.url_params.album:"\x26track\x3d"+options.url_params.track);this._url_referrer=
options.url_params.url_referrer}this._referer=referer;this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._duration=null;this._state="IDLE";this._unloaded=true;this._scrubbed=false;this._trackstate=!options.no_trackstate;this._trackchanged=EventSender.create(this,"trackchanged");this._trackplayed=EventSender.create(this,"trackplayed");this._trackcapped=EventSender.create(this,"trackcapped");this._scrubbedback=EventSender.create(this,"scrubbedback");this._completedplay=EventSender.create(this,
"completedplay");this._playlistchanged=EventSender.create(this,"playlistchanged");this._statechanged=EventSender.create(this,"statechanged");this._loaded=EventSender.create(this,"loaded");this._timechanged=EventSender.create(this,"time");this.first_playable_track=-1;this.last_playable_track=-1;this._ui_listeners=new Object;this._usecomm=true;var pageData=$("#pagedata").data("blob")||{};this._stream_buffer_duration_stats=pageData.cfg&&pageData.cfg.stream_buffer_duration_stats||null;this._buffering_start_time=
null;var that=this;this._player.onstate(function(target,arg){if(that._unloaded)return;that._handle_state({oldstate:that._state,newstate:arg.newstate})});this._player.ontime(function(target,arg){if(that._unloaded)return;that._handle_time(arg)});this._player.onloaded(function(target,arg){if(that._unloaded)return;that._handle_load(arg)});if(!Playlist.coordinator)Playlist.coordinator=new Player.PlaylistCoordinator;Playlist.coordinator.add(this)}Playlist.prototype={getoption:function(key){return this._options[key]},
add_track:function(trackinfo){trackinfo=new Player.TrackInfo(trackinfo);if(this._url_referrer&&trackinfo.file)for(var i in trackinfo.file)trackinfo.file[i]+="\x26urlref\x3d"+document.URL.replace(/\&/g,"/");var result=this._playlist.push(trackinfo)-1;this._playlist[result].tracknum=result;if(trackinfo.is_playable()){if(this.first_playable_track==-1){this.first_playable_track=result;this._track=result}this.last_playable_track=result}this._playlistchanged();return result},set_initial_track:function(i){if(this._playlist[i]&&
this._playlist[i].is_playable())this._track=i},update_trackinfo:function(i,trackinfo){trackinfo.tracknum=i;trackinfo=this._playlist[i].update(trackinfo);this._loadedtrack=-1;if(trackinfo.is_playable()){if(this.first_playable_track==-1||i<this.first_playable_track)this.first_playable_track=i;if(this.last_playable_track==-1||i>this.last_playable_track)this.last_playable_track=i}else{if(i==this.first_playable_track){this.first_playable_track=-1;for(var j=i+1;j<this._playlist.length;j++)if(this._playlist[j].is_playable()){this.first_playable_track=
j;break}}if(i==this.last_playable_track){this.last_playable_track=-1;for(j=i-1;j>=0;j--)if(this._playlist[j].is_playable()){this.last_playable_track=j;break}}}this._playlistchanged();if(this._state=="BUSY"&&trackinfo.is_playable())this.play()},playpause:function(){var result=null;switch(this._state){case "IDLE":case "COMPLETED":case "PAUSED":this.play();result=1;break;case "PLAYING":case "BUFFERING":this._player.pause();this._comm_stop();result=-1;break;case "BUSY":this._player.stop();this._comm_stop();
this._handle_state({newstate:"IDLE",oldstate:this._state});result=0;break}return result},play:function(){var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}switch(this._state){case "IDLE":case "COMPLETED":case "BUSY":Log.debug("playlist loading track "+this._track);if(!tinfo)break;for(;!tinfo.is_playable()&&this._track<this.last_playable_track;){this._track++;tinfo=this._playlist[this._track]}if(!tinfo.is_playable()&&this._playlist.length==
1&&tinfo.encoding_pending)this._handle_state({newstate:"BUSY",oldstate:this._state});else if(this._playlist[this._track].file){this._load();this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}}break;case "PAUSED":case "BUFFERING":this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}break}var idx=this._track;this._trackplayed(idx)},pause:function(){switch(this._state){case "PLAYING":case "BUFFERING":this._player.pause();
this._comm_stop();break;case "BUSY":this._player.stop();this._comm_stop();this._handle_state({newstate:"IDLE",oldstate:this._state});break}},stop:function(){this._player.stop();this._handle_state({newstate:"IDLE",oldstate:this._state})},seek:function(pos){this._unloaded=false;var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(pos<=2&&this._playstat==null){tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);
return}else if(tinfo)this._scrubbedback(tinfo.id);this._scrubbed=true}this._player.seek(pos)},play_track:function(num,pos){var tinfo=this.get_track_info(num);if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(this._loadedtrack!=num){this._state="IDLE";this._player.stop();this._track=num;this._load()}this._unloaded=false;if(pos!=null)this.seek(pos);else this.play()},percent_loaded:function(){return this._loadpercent||0},position:function(){return this._position},duration:function(){if(this._duration!=
null)return this._duration;else{var current_track=this.get_track_info();if(current_track)return current_track.duration;return 0}},init_complete:function(forceCue){if(this._trackstate&&this._loadstate());else if(forceCue||this._track>0)this._trackchanged(this._playlist[this._track])},register_listener:function(event_name,listener){var evlisteners=this._ui_listeners[event_name];if(evlisteners){$assert($.isArray(evlisteners),"expected array of event listeners");evlisteners.push(listener)}else{evlisteners=
new Array;evlisteners.push(listener);this._ui_listeners[event_name]=evlisteners}},player:function(){return this._player},unload:function(){this.stop();this._unloaded=true;this._playlist=[];this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._position=0;this.first_playable_track=-1;this.last_playable_track=-1;this._playlistchanged();this._handle_state({newstate:"IDLE",oldstate:this._state})},load:function(tracks){this.unload();for(var i=0;i<tracks.length;i++)this.add_track(tracks[i])},_reset:function(){this.stop();
this._track=this.first_playable_track;this._trackchanged(this._playlist[this._track]);this._loadedtrack=-1},_handle_state:function(arg){if(this._state==arg.newstate)return;if(!(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING")){if(arg.newstate!="PAUSED")this._position=0;this._clearstate()}this._state=arg.newstate;if(arg.newstate=="COMPLETED"&&(arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING"||arg.oldstate=="PAUSED")){if(!this.seeking)if(this._track+1<=this.last_playable_track){this._state="IDLE";
this._player.stop();var current_track=this.get_track_info();if(current_track&&current_track.continuous==false)this._statechanged(arg);else this.next_track()}else{this._track=0;this._loadedtrack=-1;this._statechanged(arg);this._trackchanged(this._playlist[this.first_playable_track])}}else this._statechanged(arg);if(this._stream_buffer_duration_stats==true)if(arg.newstate=="BUFFERING"&&(arg.oldstate=="IDLE"||arg.oldstate=="COMPLETED"))this._buffering_start_time=Date.now();else if(this._buffering_start_time!=
null&&arg.newstate=="PLAYING"){buffering_duration=Date.now()-this._buffering_start_time;this._buffering_start_time=null;if(this._playstat)this._playstat.report_stream_buffer_duration(buffering_duration,this._options.hq)}if(arg.newstate=="PAUSED")if(this._playstat)this._playstat.report_stream_end(this._position)},_handle_load:function(arg){if(arg.total==0)this._loadpercent=0;else this._loadpercent=100*arg.loaded/arg.total;this._loaded(this._loadpercent)},_handle_time:function(arg){if(this._trackstate)this._savestate(arg.position);
this._position=arg.position;this._duration=arg.duration;this._timechanged(arg);var trackinfo=this._playlist[this._track];if(this._playstat&&arg.duration>0)if(!this._playstat.play_progress(arg.position,arg.duration)){this._playstat=null;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id)}var is_complete=Player.PlayStat.is_complete(arg.position,arg.duration);if(is_complete&&this._scrubbed){this._scrubbed=false;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id,
true)}},prev_track:function(){var idx=this._track;do idx--;while(idx>=0&&!this._playlist[idx].file);if(idx==-1)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},next_track:function(){var idx=this._track;do idx++;while(idx<this._playlist.length&&!this._playlist[idx].file);if(idx==this._playlist.length)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},get_state:function(){return this._state},get_track:function(){return this._track},
get_track_info:function(index){if(this._playlist.length==0)return null;if(typeof index!="undefined")return this._playlist[index].copy();return this._playlist[this._track].copy()},cap_playback_for_track:function(track_id){for(var i=0;this._playlist&&i<this._playlist.length;i++){var ti=this._playlist[i];if(ti.id==track_id){ti.mark_as_capped();break}}},length:function(){return this._playlist.length},_notify_listeners:function(notification,idx){var listeners=this._ui_listeners[notification];if(listeners)for(var i=
listeners.length-1;i>=0;i--)listeners[i](idx)},_load:function(){if(this._loadedtrack==this._track){this.seek(0);return}this._loadedtrack=this._track;this._unloaded=false;this._player.load(this._playlist[this._track].file,this._options.hq);this._loadpercent=0;var trackinfo=this._playlist[this._track];this._trackchanged(trackinfo);this._playstat=new Player.PlayStat(trackinfo,this._playing_from,this._referer);this._scrubbed=false},_isplaying:function(){return this._state=="PLAYING"||this._state=="PAUSED"||
this._state=="BUFFERING"},_managestate:Browser.platform!="iphone",_loadstate:function(){if(!this._managestate)return false;Log.debug("reading/clearing playlist state");var used_saved_state=false;try{var state=Cookie.get(COOKIE_NAME);Cookie.clear(COOKIE_NAME);if(state=JSON.parse(state))for(var i=0;i<this._playlist.length;i++)if(this._playlist[i].id==state.track_id){Log.debug("found player state, playing track "+i+" at pos "+state.pos);this.play_track(i,state.pos);used_saved_state=true;break}}catch(e){}return used_saved_state},
_clearstate:function(){if(!this._managestate)return;try{Cookie.clear(COOKIE_NAME)}catch(e){}},_savestate:function(pos){if(!this._managestate||this._state!="PLAYING"&&this._state!="BUFFERING")return;var track_id=this._playlist[this._track].id;if(Math.abs(this._saved_pos-pos)>SAVE_LATENCY||track_id!=this._saved_track_id){this._saved_track_id=track_id;this._saved_pos=pos;var params={track_id:track_id,pos:pos};try{var value=JSON.stringify(params);Cookie.set(COOKIE_NAME,value,COOKIE_LIFE)}catch(e){}}},
_comm_start:function(){if(!this._comm){this._comm=new Cookie.CommChannel("playlist");this._comm.subscribe($.proxy(this._comm_recv,this))}this._comm.startListening()},_comm_stop:function(){if(this._comm)this._comm.stopListening()},_comm_recv:function(event,args){switch(args[1]){case "stop":Log.debug("received cookie comm stop command.  stopping.");this.stop();break}},_stop_other_players:function(){this._comm.send("stop")}};var COOKIE_NAME="playlist_state";var COOKIE_LIFE=30;var SAVE_LATENCY=1;var PLAY_TRACK=
"play_track";Playlist.PLAY_TRACK=PLAY_TRACK;return Playlist}();
Player.PlaylistCoordinator=function(){function constructor(){this._playlists=[];this._playingcount=0;this._playing=EventSender.create(this,"playing");this._stopped=EventSender.create(this,"stopped")}constructor.prototype.add=function(pl){var self=this;pl.onstatechanged(function(arg){self._handle_playlist_statechanged(pl,arg)});this.onplaying(function(playingplaylist){if(pl!=playingplaylist)if(pl.getoption("savepos"))pl.pause();else pl.stop()})};constructor.prototype._handle_playlist_statechanged=
function(playlist,arg){var isplaying=arg.newstate=="PLAYING"||arg.newstate=="BUFFERING";var wasplaying=arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING";if(isplaying&&!wasplaying)this._playingcount++;else if(wasplaying&&!isplaying){this._playingcount--;if(this._playingcount==0)this._stopped()}if(isplaying)this._playing(playlist)};return constructor}();
Player.PlayStat=function(){function PlayStat(trackinfo,playing_from,referer){params={kind:"track play",track_id:trackinfo.id,track_license_id:trackinfo.track_license_id,from:playing_from,from_url:referer||location.toString(),stream_duration:null};_super.call(this,params,"started")}var _super=Stats.PhasedStat;for(var k in Stats.PhasedStat.prototype)PlayStat.prototype[k]=Stats.PhasedStat.prototype[k];PlayStat.prototype.play_progress=function(secs_played,secs_total){var partial=PlayStat.is_partial(secs_played,
secs_total);var thirty=PlayStat.is_past_30(secs_played,secs_total);var complete=PlayStat.is_complete(secs_played,secs_total);if(!this._partial_sent&&partial){this._partial_sent=true;this.change_phase("partial")}if(!this._30_seconds_sent&&thirty){this._30_seconds_sent=true;this.change_phase("thirty")}if(!this._complete_sent&&complete){this._complete_sent=true;this._params.stream_duration=secs_total;this.change_phase("complete");return false}return true};PlayStat.is_partial=function(secs_played,secs_total){var SKIP_WINDOW=
10;var is_it=false;if(secs_played&&secs_total){partial=secs_total*SKIP_WINDOW/100;is_it=secs_played>partial}return is_it};PlayStat.is_past_30=function(secs_played){var is_it=false;if(secs_played)is_it=secs_played>30;return is_it};PlayStat.is_complete=function(secs_played,secs_total){var COMPLETE_WINDOW=10;var is_it=false;if(secs_played&&secs_total){complete=secs_total*(100-COMPLETE_WINDOW)/100;is_it=secs_played>complete}return is_it};PlayStat.prototype.report_stream_end=function(duration){if(duration>
30&&this._params.stream_duration<duration){this._params.stream_duration=duration;this.change_phase("stream_end")}};PlayStat.prototype.report_stream_buffer_duration=function(duration,hq){Stats.record({kind:"stream buffer duration",duration_ms:duration,is_hq:hq});return true};return PlayStat}();
var FacebookUtils={_sdkLoadPromise:null,initSDK:function(){if(FacebookUtils._sdkLoadPromise)return FacebookUtils._sdkLoadPromise;var dfd=new $.Deferred;window.fbAsyncInit=function(){Log.debug("Facebook SDK loaded");FB.init({appId:"165661066782720",status:true,cookie:true,xfbml:false});dfd.resolve()};$(document.body).prepend('\x3cdiv id\x3d"fb-root"\x3e\x3c/div\x3e');fbLocales={"en":"en_US","fr":"fr_FR","ja":"ja_JP","qq":"ja_JP"};var fbLocale;if("Translate"in window&&"locale"in Translate)fbLocale=
fbLocales[Translate.locale];if(!fbLocale){fbLocale="en_US";Log.server("Facebook SDK couldn't determine FB locale","error")}$.cachedScript("//connect.facebook.net/"+fbLocale+"/all.js");return FacebookUtils._sdkLoadPromise=dfd.promise()},xxx:null};var EmailIMUtils={alreadyStattedFromFocus:false,onFocus:function(){if(!self.alreadyStattedFromFocus){Stats.record({kind:"click",click:"email_tralbum"});self.alreadyStattedFromFocus=true}return false},xxx:null};
var SocialControls={initFromDOM:function(root){var self=this;var $root=$(root);var $containers=$root.add(".social-controls",$root).filter(".social-controls");$containers.each(function(){var $cont=$(this);self._initControlsOfType($cont.find(".facebook-like-ctrl"),"renderFacebookLike");self._initControlsOfType($cont.find(".facebook-share-ctrl"),"renderFacebookShare");self._initControlsOfType($cont.find(".facebook-share-dlg-ctrl"),"renderFacebookDialogShare");self._initControlsOfType($cont.find(".twitter-ctrl"),
"renderTwitterShare");self._initControlsOfType($cont.find(".reddit-ctrl"),"renderRedditShare");self._initControlsOfType($cont.find(".tumblr-ctrl"),"renderTumblrShare");self._initControlsOfType($cont.find(".email-ctrl"),"renderEmailShare")})},renderFacebookLike:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,send:"false",layout:"button_count",width:"90","show-faces":"false"};data=$.extend(dataDefaults,data);var $like=$('\x3cdiv class\x3d"fb-like"\x3e\x3c/div\x3e').appendTo($elem);
$.each(data,function(key,val){if(key=="url")key="href";$like.attr("data-"+key,val)});FacebookUtils.initSDK().done(function(){FB.XFBML.parse($elem[0]);self._registerFBEventHandlers(elem,data);$elem.data("scResolvedData",data)})},renderFacebookDialogShare:function(elem,data){(function(document,script,facebookJsSdkId){var firstJsTag=document.getElementsByTagName(script)[0];var scriptTag=document.createElement(script);scriptTag.id=facebookJsSdkId;scriptTag.src="https://connect.facebook.net/en_US/sdk.js";
firstJsTag.parentNode.insertBefore(scriptTag,firstJsTag)})(document,"script","facebook-jssdk");window.fbAsyncInit=function(){FB.init({appId:data.appId,autoLogAppEvents:true,xfbml:true,version:"v3.2"})};var $fbLink=$(elem).find(".facebook-link").first();$fbLink.click(function(ev){FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":data.url,"og:title":data.title,"og:description":data.text,"og:image":data.image,"og:image:width":100,"og:image:height":100}})},
function(response){})})},renderFacebookShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={u:data.url};var isDesktop=!window.MediaView||MediaView.mode=="desktop";var fbUrl=Url.addQueryParams(isDesktop?"http://www.facebook.com/sharer.php":"http://m.facebook.com/sharer.php",params);var $fbLink=$elem.find(".facebook-link").first();if(!$fbLink.length)$fbLink=$('\x3ca class\x3d"facebook-link" title\x3d"Share on Facebook"\x3eShare\x3c/a\x3e').appendTo($elem);
$fbLink.attr({"href":fbUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(fbUrl,"share_fb","toolbar\x3d0,status\x3d0,width\x3d626,height\x3d436");ev.preventDefault()}})},renderTwitterShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={url:data.url};var isDesktop=!window.MediaView||MediaView.mode!="phone";if(data.text)params.text=data.text;var twUrl=Url.addQueryParams("https://twitter.com/intent/tweet",
params);var $twLink=$elem.find(".twitter-link").first();if(!$twLink.length){var tweet;var shareOnTwitter;if("undefined"===typeof TM){tweet="Tweet";shareOnTwitter="Share on Twitter"}else{tweet=TM("Tweet");shareOnTwitter=TM("Share on Twitter")}$twLink=$('\x3ca class\x3d"twitter-link" title\x3d"'+shareOnTwitter+'"\x3e'+tweet+"\x3c/a\x3e").appendTo($elem)}$twLink.attr({"href":twUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(twUrl,"share_tw","toolbar\x3d0,status\x3d0,width\x3d550,height\x3d450");
ev.preventDefault()}})},renderRedditShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={url:data.url,title:data.title,kind:"self"};var isDesktop=!window.MediaView||MediaView.mode!="phone";var rdUrl=Url.addQueryParams("https://www.reddit.com/submit",params);var $rdLink=$elem.find(".reddit-link").first();if(!$rdLink.length){var reddit=TM("Reddit");var shareOnReddit=TM("Share on Reddit");$rdLink=$('\x3ca class\x3d"reddit-link" title\x3d"'+
shareOnReddit+'"\x3e'+reddit+"\x3c/a\x3e").appendTo($elem)}$rdLink.attr({"href":rdUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(rdUrl,"share_rd","toolbar\x3d0,status\x3d0,width\x3d550,height\x3d450");ev.preventDefault()}})},renderTumblrShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,type:"link"};data=$.extend(dataDefaults,data);var params={};if(data.type=="audio"){params.external_url=data.url;if(data.text)params.caption=
data.text}else{params.url=data.url;if(data.title)params.name=data.title;if(data.text)params.description=data.text}var tmUrl=Url.addQueryParams("http://www.tumblr.com/share/"+data.type,params);var $tmLink=$elem.find(".tumblr-link").first();if(!$tmLink.length)$tmLink=$('\x3ca class\x3d"tumblr-link" title\x3d"Share on Tumblr"\x3eShare on Tumblr\x3c/a\x3e').appendTo($elem);$tmLink.attr({"href":tmUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on")})},renderEmailShare:function(elem,data){var self=
this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={"body":data.url};if(data.text)params.body=data.text+"\r\n\r\n"+params.body;if(data.subject)params.subject=data.subject;var emailUrl="mailto:?"+Url.joinQuery(params);var $emailLink=$elem.find(".email-link").first();if(!$emailLink.length)$emailLink=$('\x3ca class\x3d"email-link" title\x3d"Share via email"\x3eEmail\x3c/a\x3e').appendTo($elem);$emailLink.attr({"href":emailUrl}).click(function(ev){self._statClick(data,
"on");setTimeout(function(){location.href=emailUrl},100);return false})},_initControlsOfType:function(elems,renderMethodName){var self=this;$(elems).each(function(){self[renderMethodName](this,self._getData(this))})},_getData:function(elem,defaults){var $elem=$(elem);var elemData=$elem.data();var shareData=$elem.closest(".social-controls").data();return $.extend(defaults||{},shareData,elemData)},_statClick:function(data,eventType){var clickName=null;if(eventType=="on")clickName=data.stat||data.statOn;
else if(eventType=="off")clickName=data.statOff;if(clickName)Stats.record({kind:"click",click:clickName})},_initedFBEvents:false,_registerFBEventHandlers:function(){var self=this;if(!this._initedFBEvents){FacebookUtils.initSDK().done(function(){FB.Event.subscribe("edge.create",$.proxy(self,"_handleFBEvent","on"));FB.Event.subscribe("edge.remove",$.proxy(self,"_handleFBEvent","off"))});this._initedFBEvents=true}},_handleFBEvent:function(eventType,href,widget){var self=this;if(!widget||!widget.dom||
!widget.dom.tagName){Log.error("SocialControls: can't stat FB Like/Unlike because event parameter 'widget' is missing or has changed");return}var data=$(widget.dom).closest(".facebook-like-ctrl").data("scResolvedData");if(!data||href!=data.url)return;self._statClick(data,eventType)},xxx:null};
(function(e$$0,t$$1){e$$0.widget("ui.draggable",e$$0.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&
(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e$$0(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e$$0(n.iframeFix===
!0?"iframe":n.iframeFix).each(function(){e$$0('\x3cdiv class\x3d"ui-draggable-iframeFix" style\x3d"background: #fff;"\x3e\x3c/div\x3e').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(e$$0(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e$$0.ui.ddmanager&&(e$$0.ui.ddmanager.current=
this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e$$0.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,
this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e$$0.ui.ddmanager&&!n.dropBehaviour&&e$$0.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e$$0.ui.ddmanager&&e$$0.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();
if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e$$0.ui.ddmanager&&e$$0.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e$$0.ui.ddmanager&&!this.options.dropBehaviour&&(n=e$$0.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=
this.element[0];for(var i=!1;r&&(r=r.parentNode);)r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e$$0.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e$$0(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},
_mouseUp:function(t){return e$$0("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e$$0.ui.ddmanager&&e$$0.ui.ddmanager.dragStop(this,t),e$$0.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e$$0(this.options.handle,this.element).length?!0:!1;return e$$0(this.options.handle,this.element).find("*").andSelf().each(function(){this==
t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options;var r=e$$0.isFunction(n.helper)?e$$0(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e$$0.isArray(t)&&
(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&
e$$0.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e$$0.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=
this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions=
{width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e$$0(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e$$0(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e$$0(window).scrollLeft())+
e$$0(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e$$0(window).scrollTop())+(e$$0(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e$$0(t.containment);var r=n[0];if(!r)return;var i=n.offset();var s=e$$0(r).css("overflow")!="hidden";this.containment=
[(parseInt(e$$0(r).css("borderLeftWidth"),10)||0)+(parseInt(e$$0(r).css("paddingLeft"),10)||0),(parseInt(e$$0(r).css("borderTopWidth"),10)||0)+(parseInt(e$$0(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e$$0(r).css("borderLeftWidth"),10)||0)-(parseInt(e$$0(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e$$0(r).css("borderTopWidth"),
10)||0)-(parseInt(e$$0(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1;var i=this.options;var s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e$$0.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;var o=/(html|body)/i.test(s[0].tagName);
return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options;var r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e$$0.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;
var i=/(html|body)/i.test(r[0].tagName);var s=t.pageX;var o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+
this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?
l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&
this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e$$0.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e$$0.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e$$0.ui.plugin.add("draggable","connectToSortable",{start:function(t,n$$0){var r=e$$0(this).data("draggable");
var i=r.options;var s=e$$0.extend({},n$$0,{item:r.element});r.sortables=[],e$$0(i.connectToSortable).each(function(){var n=e$$0.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e$$0(this).data("draggable");var i=e$$0.extend({},n,{item:r.element});e$$0.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=
!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t$$0,n$$0){var r$$0=e$$0(this).data("draggable");var i$$0=this;var s$$0=function(t){var n=this.offset.click.top;var r=this.offset.click.left;var i=this.positionAbs.top;var s=
this.positionAbs.left;var o=t.height;var u=t.width;var a=t.top;var f=t.left;return e$$0.ui.isOver(i+n,s+r,a,f,o,u)};e$$0.each(r$$0.sortables,function(s){var o=!1;var u=this;this.instance.positionAbs=r$$0.positionAbs,this.instance.helperProportions=r$$0.helperProportions,this.instance.offset.click=r$$0.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e$$0.each(r$$0.sortables,function(){return this.instance.positionAbs=r$$0.positionAbs,this.instance.helperProportions=
r$$0.helperProportions,this.instance.offset.click=r$$0.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e$$0.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e$$0(i$$0).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n$$0.helper[0]},
t$$0.target=this.instance.currentItem[0],this.instance._mouseCapture(t$$0,!0),this.instance._mouseStart(t$$0,!0,!0),this.instance.offset.click.top=r$$0.offset.click.top,this.instance.offset.click.left=r$$0.offset.click.left,this.instance.offset.parent.left-=r$$0.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r$$0.offset.parent.top-this.instance.offset.parent.top,r$$0._trigger("toSortable",t$$0),r$$0.dropped=this.instance.element,r$$0.currentItem=r$$0.element,
this.instance.fromOutside=r$$0),this.instance.currentItem&&this.instance._mouseDrag(t$$0)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t$$0,this.instance._uiHash(this.instance)),this.instance._mouseStop(t$$0,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r$$0._trigger("fromSortable",t$$0),
r$$0.dropped=!1)})}}),e$$0.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e$$0("body");var i=e$$0(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._cursor&&e$$0("body").css("cursor",r._cursor)}}),e$$0.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e$$0(n.helper);var i=e$$0(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),
r.css("opacity",i.opacity)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._opacity&&e$$0(n.helper).css("opacity",r._opacity)}}),e$$0.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e$$0(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e$$0(this).data("draggable");var i=r.options;var s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||
i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&
(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e$$0(document).scrollTop()<i.scrollSensitivity?s=e$$0(document).scrollTop(e$$0(document).scrollTop()-i.scrollSpeed):e$$0(window).height()-(t.pageY-e$$0(document).scrollTop())<i.scrollSensitivity&&(s=e$$0(document).scrollTop(e$$0(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e$$0(document).scrollLeft()<i.scrollSensitivity?s=e$$0(document).scrollLeft(e$$0(document).scrollLeft()-
i.scrollSpeed):e$$0(window).width()-(t.pageX-e$$0(document).scrollLeft())<i.scrollSensitivity&&(s=e$$0(document).scrollLeft(e$$0(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e$$0.ui.ddmanager&&!i.dropBehaviour&&e$$0.ui.ddmanager.prepareOffsets(r,t)}}),e$$0.ui.plugin.add("draggable","snap",{start:function(t$$0,n$$0){var r=e$$0(this).data("draggable");var i=r.options;r.snapElements=[],e$$0(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e$$0(this);var n=t.offset();
this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e$$0(this).data("draggable");var i=r.options;var s=i.snapTolerance;var o=n.offset.left;var u=o+r.helperProportions.width;var a=n.offset.top;var f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left;var h=c+r.snapElements[l].width;var p=r.snapElements[l].top;var d=p+r.snapElements[l].height;if(!(c-s<o&&o<
h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e$$0.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s;var m=Math.abs(d-a)<=s;var g=Math.abs(c-u)<=s;var y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-
r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){v=Math.abs(p-a)<=s;m=Math.abs(d-f)<=s;g=Math.abs(c-o)<=s;y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),
m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e$$0.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=
v||m||g||y||b}}}),e$$0.ui.plugin.add("draggable","stack",{start:function(t$$0,n$$0){var r=e$$0(this).data("draggable").options;var i=e$$0.makeArray(e$$0(r.stack)).sort(function(t,n){return(parseInt(e$$0(t).css("zIndex"),10)||0)-(parseInt(e$$0(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e$$0(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e$$0.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e$$0(n.helper);var i=e$$0(this).data("draggable").options;
r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e$$0(this).data("draggable").options;r._zIndex&&e$$0(n.helper).css("zIndex",r._zIndex)}})})(jQuery);
(function(e$$0,t$$1){var n$$1="ui-dialog ui-widget ui-widget-content ui-corner-all ";var r$$1={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0};var i$$1={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e$$0.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,
collision:"fit",using:function(t){var n=e$$0(this).css(t).offset().top;n<0&&e$$0(this).css("top",t.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var t$$0=this;var r=this.options;var i$$0=
r.title||"\x26#160;";var s;var o$$0;var u;var a;var f;s=(this.uiDialog=e$$0("\x3cdiv\x3e")).addClass(n$$1+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(n){r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e$$0.ui.keyCode.ESCAPE&&(t$$0.close(n),n.preventDefault())}).mousedown(function(e){t$$0.moveToTop(!1,e)}).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s),o$$0=
(this.uiDialogTitlebar=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){s.focus()}).prependTo(s),u=e$$0("\x3ca href\x3d'#'\x3e\x3c/a\x3e").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault(),t$$0.close(e)}).appendTo(o$$0),(this.uiDialogTitlebarCloseText=e$$0("\x3cspan\x3e")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(u),a=e$$0("\x3cspan\x3e").uniqueId().addClass("ui-dialog-title").html(i$$0).prependTo(o$$0),
f=(this.uiDialogButtonPane=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=e$$0("\x3cdiv\x3e")).addClass("ui-dialog-buttonset").appendTo(f),s.attr({role:"dialog","aria-labelledby":a.attr("id")}),o$$0.find("*").add(o$$0).disableSelection(),this._hoverable(u),this._focusable(u),r.draggable&&e$$0.fn.draggable&&this._makeDraggable(),r.resizable&&e$$0.fn.resizable&&this._makeResizable(),this._createButtons(r.buttons),this._isOpen=!1,e$$0.fn.bgiframe&&
s.bgiframe(),this._on(s,{keydown:function(t){if(!r.modal||t.keyCode!==e$$0.ui.keyCode.TAB)return;var n=e$$0(":tabbable",s);var i=n.filter(":first");var o=n.filter(":last");if(t.target===o[0]&&!t.shiftKey)return i.focus(1),!1;if(t.target===i[0]&&t.shiftKey)return o.focus(1),!1}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var e;var t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),
this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(t){var n=this;var r;var i;if(!this._isOpen)return;if(!1===this._trigger("beforeClose",t))return;return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",
t)}):(this.uiDialog.hide(),this._trigger("close",t)),e$$0.ui.dialog.overlay.resize(),this.options.modal&&(r=0,e$$0(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e$$0(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)))}),e$$0.ui.dialog.maxZ=r),this},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this.options;var i;return r.modal&&!t||!r.stack&&!r.modal?this._trigger("focus",n):(r.zIndex>e$$0.ui.dialog.maxZ&&(e$$0.ui.dialog.maxZ=r.zIndex),this.overlay&&(e$$0.ui.dialog.maxZ+=
1,e$$0.ui.dialog.overlay.maxZ=e$$0.ui.dialog.maxZ,this.overlay.$el.css("z-index",e$$0.ui.dialog.overlay.maxZ)),i={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},e$$0.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",e$$0.ui.dialog.maxZ),this.element.attr(i),this._trigger("focus",n),this)},open:function(){if(this._isOpen)return;var t;var n=this.options;var r=this.uiDialog;return this._size(),this._position(n.position),r.show(n.show),this.overlay=n.modal?new e$$0.ui.dialog.overlay(this):
null,this.moveToTop(!0),t=this.element.find(":tabbable"),t.length||(t=this.uiDialogButtonPane.find(":tabbable"),t.length||(t=r)),t.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this},_createButtons:function(t$$0){var n=this;var r$$0=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),typeof t$$0=="object"&&t$$0!==null&&e$$0.each(t$$0,function(){return!(r$$0=!0)}),r$$0?(e$$0.each(t$$0,function(t,r){var i;var s;r=e$$0.isFunction(r)?{click:r,text:t}:r,r=e$$0.extend({type:"button"},r),
s=r.click,r.click=function(){s.apply(n.element[0],arguments)},i=e$$0("\x3cbutton\x3e\x3c/button\x3e",r).appendTo(n.uiButtonSet),e$$0.fn.button&&i.button()}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset}}var t=this;var n$$0=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",
containment:"document",start:function(n,i){e$$0(this).addClass("ui-dialog-dragging"),t._trigger("dragStart",n,r(i))},drag:function(e,n){t._trigger("drag",e,r(n))},stop:function(i,s){n$$0.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()],e$$0(this).removeClass("ui-dialog-dragging"),t._trigger("dragStop",i,r(s)),e$$0.ui.dialog.overlay.resize()}})},_makeResizable:function(n$$0){function u(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,
position:e.position,size:e.size}}n$$0=n$$0===t$$1?this.options.resizable:n$$0;var r=this;var i=this.options;var s=this.uiDialog.css("position");var o=typeof n$$0=="string"?n$$0:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(t,n){e$$0(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",t,u(n))},resize:function(e,
t){r._trigger("resize",e,u(t))},stop:function(t,n){e$$0(this).removeClass("ui-dialog-resizing"),i.height=e$$0(this).height(),i.width=e$$0(this).width(),r._trigger("resizeStop",t,u(n)),e$$0.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t$$0){var n=[];var r=[0,0];var i;if(t$$0){if(typeof t$$0=="string"||
typeof t$$0=="object"&&"0"in t$$0)n=t$$0.split?t$$0.split(" "):[t$$0[0],t$$0[1]],n.length===1&&(n[1]=n[0]),e$$0.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t$$0={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")};t$$0=e$$0.extend({},e$$0.ui.dialog.prototype.options.position,t$$0)}else t$$0=e$$0.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t$$0),i||this.uiDialog.hide()},_setOptions:function(t$$0){var n=
this;var s={};var o=!1;e$$0.each(t$$0,function(e,t){n._setOption(e,t),e in r$$1&&(o=!0),e in i$$1&&(s[e]=t)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,r){var i;var s;var o=this.uiDialog;switch(t){case "buttons":this._createButtons(r);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+r);break;case "dialogClass":o.removeClass(this.options.dialogClass).addClass(n$$1+r);break;case "disabled":r?o.addClass("ui-dialog-disabled"):
o.removeClass("ui-dialog-disabled");break;case "draggable":i=o.is(":data(draggable)"),i&&!r&&o.draggable("destroy"),!i&&r&&this._makeDraggable();break;case "position":this._position(r);break;case "resizable":s=o.is(":data(resizable)"),s&&!r&&o.resizable("destroy"),s&&typeof r=="string"&&o.resizable("option","handles",r),!s&&r!==!1&&this._makeResizable(r);break;case "title":e$$0(".ui-dialog-title",this.uiDialogTitlebar).html(""+(r||"\x26#160;"))}this._super(t,r)},_size:function(){var t;var n;var r;
var i=this.options;var s=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),i.minWidth>i.width&&(i.width=i.minWidth),t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),n=Math.max(0,i.minHeight-t),i.height==="auto"?e$$0.support.minHeight?this.element.css({minHeight:n,height:"auto"}):(this.uiDialog.show(),r=this.element.css("height","auto").height(),s||this.uiDialog.hide(),this.element.height(Math.max(r,n))):this.element.height(Math.max(i.height-
t,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e$$0.extend(e$$0.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e$$0.ui.dialog.overlay.create(t)}}),e$$0.extend(e$$0.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e$$0.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),
create:function(t$$0){this.instances.length===0&&(setTimeout(function(){e$$0.ui.dialog.overlay.instances.length&&e$$0(document).bind(e$$0.ui.dialog.overlay.events,function(t){if(e$$0(t.target).zIndex()<e$$0.ui.dialog.overlay.maxZ)return!1})},1),e$$0(window).bind("resize.dialog-overlay",e$$0.ui.dialog.overlay.resize));var n=this.oldInstances.pop()||e$$0("\x3cdiv\x3e").addClass("ui-widget-overlay");return e$$0(document).bind("keydown.dialog-overlay",function(r){var i=e$$0.ui.dialog.overlay.instances;
i.length!==0&&i[i.length-1]===n&&t$$0.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e$$0.ui.keyCode.ESCAPE&&(t$$0.close(r),r.preventDefault())}),n.appendTo(document.body).css({width:this.width(),height:this.height()}),e$$0.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(t){var n=e$$0.inArray(t,this.instances);var r=0;n!==-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e$$0([document,window]).unbind(".dialog-overlay"),
t.height(0).width(0).remove(),e$$0.each(this.instances,function(){r=Math.max(r,this.css("z-index"))}),this.maxZ=r},height:function(){var t;var n;return e$$0.ui.ie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e$$0(window).height()+"px":t+"px"):e$$0(document).height()+"px"},width:function(){var t;var n;return e$$0.ui.ie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),
n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e$$0(window).width()+"px":t+"px"):e$$0(document).width()+"px"},resize:function(){var t=e$$0([]);e$$0.each(e$$0.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e$$0.ui.dialog.overlay.width(),height:e$$0.ui.dialog.overlay.height()})}}),e$$0.extend(e$$0.ui.dialog.overlay.prototype,{destroy:function(){e$$0.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);
(function(){function j(n,l){var o=this;var m;o.element=typeof n=="object"?n:document.getElementById(n);o.wrapper=o.element.parentNode;o.element.style.webkitTransitionProperty="-webkit-transform";o.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";o.element.style.webkitTransitionDuration="0";o.element.style.webkitTransform=h+"0,0"+b;o.options={bounce:d,momentum:d,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:d,vScrollbar:d,fadeScrollbar:g||!a,shrinkScrollbar:g||!a,desktopCompatibility:false,
overflow:"auto",snap:false,bounceLock:false,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}};if(typeof l=="object")for(m in l)o.options[m]=l[m];if(o.options.desktopCompatibility)o.options.overflow="hidden";o.onScrollEnd=o.options.onScrollEnd;delete o.options.onScrollEnd;o.wrapper.style.overflow=o.options.overflow;o.refresh();window.addEventListener("onorientationchange"in window?"orientationchange":"resize",o,false);if(a||o.options.desktopCompatibility){o.element.addEventListener(f,o,false);
o.element.addEventListener(i,o,false);o.element.addEventListener(e,o,false)}if(o.options.checkDOMChanges)o.element.addEventListener("DOMSubtreeModified",o,false)}function k(m,r,q,n,l){var o=this;var p=document;o.dir=m;o.fade=q;o.shrink=n;o.uid=++c;o.bar=p.createElement("div");o.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+
l+";-webkit-transform:"+h+"0,0"+b+";"+(m=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");o.wrapper=p.createElement("div");o.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+o.uid+o.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(q?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(o.dir=="horizontal"?"bottom:2px;left:2px;right:7px;height:5px":
"top:2px;right:2px;bottom:7px;width:5px;");o.wrapper.appendChild(o.bar);r.appendChild(o.wrapper)}j.prototype={x:0,y:0,enabled:true,handleEvent:function(m){var l=this;switch(m.type){case f:l.touchStart(m);break;case i:l.touchMove(m);break;case e:l.touchEnd(m);break;case "webkitTransitionEnd":l.transitionEnd();break;case "orientationchange":case "resize":l.refresh();break;case "DOMSubtreeModified":l.onDOMModified(m);break}},onDOMModified:function(m){var l=this;if(m.target.parentNode!=l.element)return;
setTimeout(function(){l.refresh()},0);if(l.options.topOnDOMChanges&&(l.x!=0||l.y!=0))l.scrollTo(0,0,"0")},refresh:function(){var m=this;var o=m.x;var n=m.y;var l;m.scrollWidth=m.wrapper.clientWidth;m.scrollHeight=m.wrapper.clientHeight;m.scrollerWidth=m.element.offsetWidth;m.scrollerHeight=m.element.offsetHeight;m.maxScrollX=m.scrollWidth-m.scrollerWidth;m.maxScrollY=m.scrollHeight-m.scrollerHeight;m.directionX=0;m.directionY=0;if(m.scrollX)if(m.maxScrollX>=0)o=0;else if(m.x<m.maxScrollX)o=m.maxScrollX;
if(m.scrollY)if(m.maxScrollY>=0)n=0;else if(m.y<m.maxScrollY)n=m.maxScrollY;if(m.options.snap){m.maxPageX=-Math.floor(m.maxScrollX/m.scrollWidth);m.maxPageY=-Math.floor(m.maxScrollY/m.scrollHeight);l=m.snap(o,n);o=l.x;n=l.y}if(o!=m.x||n!=m.y){m.setTransitionTime("0");m.setPosition(o,n,true)}m.scrollX=m.scrollerWidth>m.scrollWidth;m.scrollY=!m.options.bounceLock&&!m.scrollX||m.scrollerHeight>m.scrollHeight;if(m.options.hScrollbar&&m.scrollX){m.scrollBarX=m.scrollBarX||new k("horizontal",m.wrapper,
m.options.fadeScrollbar,m.options.shrinkScrollbar,m.options.scrollbarColor);m.scrollBarX.init(m.scrollWidth,m.scrollerWidth)}else if(m.scrollBarX)m.scrollBarX=m.scrollBarX.remove();if(m.options.vScrollbar&&m.scrollY&&m.scrollerHeight>m.scrollHeight){m.scrollBarY=m.scrollBarY||new k("vertical",m.wrapper,m.options.fadeScrollbar,m.options.shrinkScrollbar,m.options.scrollbarColor);m.scrollBarY.init(m.scrollHeight,m.scrollerHeight)}else if(m.scrollBarY)m.scrollBarY=m.scrollBarY.remove()},setPosition:function(l,
o,n){var m=this;m.x=l;m.y=o;m.element.style.webkitTransform=h+m.x+"px,"+m.y+"px"+b;if(!n){if(m.scrollBarX)m.scrollBarX.setPosition(m.x);if(m.scrollBarY)m.scrollBarY.setPosition(m.y)}},setTransitionTime:function(m){var l=this;m=m||"0";l.element.style.webkitTransitionDuration=m;if(l.scrollBarX){l.scrollBarX.bar.style.webkitTransitionDuration=m;l.scrollBarX.wrapper.style.webkitTransitionDuration=d&&l.options.fadeScrollbar?"300ms":"0"}if(l.scrollBarY){l.scrollBarY.bar.style.webkitTransitionDuration=m;
l.scrollBarY.wrapper.style.webkitTransitionDuration=d&&l.options.fadeScrollbar?"300ms":"0"}},touchStart:function(n){var m=this;var l;if(!m.enabled)return;n.preventDefault();n.stopPropagation();m.scrolling=true;m.moved=false;m.distX=0;m.distY=0;m.setTransitionTime("0");if(m.options.momentum||m.options.snap){l=new WebKitCSSMatrix(window.getComputedStyle(m.element).webkitTransform);if(l.e!=m.x||l.f!=m.y){document.removeEventListener("webkitTransitionEnd",m,false);m.setPosition(l.e,l.f);m.moved=true}}m.touchStartX=
a?n.changedTouches[0].pageX:n.pageX;m.scrollStartX=m.x;m.touchStartY=a?n.changedTouches[0].pageY:n.pageY;m.scrollStartY=m.y;m.scrollStartTime=n.timeStamp;m.directionX=0;m.directionY=0},touchMove:function(r){if(!this.scrolling)return;var p=this;var o=a?r.changedTouches[0].pageX:r.pageX;var n=a?r.changedTouches[0].pageY:r.pageY;var m=p.scrollX?o-p.touchStartX:0;var l=p.scrollY?n-p.touchStartY:0;var s=p.x+m;var q=p.y+l;r.stopPropagation();p.touchStartX=o;p.touchStartY=n;if(s>=0||s<p.maxScrollX)s=p.options.bounce?
Math.round(p.x+m/3):s>=0||p.maxScrollX>=0?0:p.maxScrollX;if(q>=0||q<p.maxScrollY)q=p.options.bounce?Math.round(p.y+l/3):q>=0||p.maxScrollY>=0?0:p.maxScrollY;if(p.distX+p.distY>5){if(p.distX-3>p.distY){q=p.y;l=0}else if(p.distY-3>p.distX){s=p.x;m=0}p.setPosition(s,q);p.moved=true;p.directionX=m>0?-1:1;p.directionY=l>0?-1:1}else{p.distX+=Math.abs(m);p.distY+=Math.abs(l)}},touchEnd:function(t){if(!this.scrolling)return;var s=this;var o=t.timeStamp-s.scrollStartTime;var w=a?t.changedTouches[0]:t;var u;
var v;var n;var l;var m=0;var r=s.x;var q=s.y;var p;s.scrolling=false;if(!s.moved){s.resetPosition();if(a){for(u=w.target;u.nodeType!=1;)u=u.parentNode;v=document.createEvent("MouseEvents");v.initMouseEvent("click",true,true,t.view,1,w.screenX,w.screenY,w.clientX,w.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null);v._fake=true;u.dispatchEvent(v)}return}if(!s.options.snap&&o>250){s.resetPosition();return}if(s.options.momentum){n=s.scrollX===true?s.momentum(s.x-s.scrollStartX,o,s.options.bounce?
-s.x+s.scrollWidth/5:-s.x,s.options.bounce?s.x+s.scrollerWidth-s.scrollWidth+s.scrollWidth/5:s.x+s.scrollerWidth-s.scrollWidth):{dist:0,time:0};l=s.scrollY===true?s.momentum(s.y-s.scrollStartY,o,s.options.bounce?-s.y+s.scrollHeight/5:-s.y,s.options.bounce?(s.maxScrollY<0?s.y+s.scrollerHeight-s.scrollHeight:0)+s.scrollHeight/5:s.y+s.scrollerHeight-s.scrollHeight):{dist:0,time:0};m=Math.max(Math.max(n.time,l.time),1);r=s.x+n.dist;q=s.y+l.dist}if(s.options.snap){p=s.snap(r,q);r=p.x;q=p.y;m=Math.max(p.time,
m)}s.scrollTo(r,q,m+"ms")},transitionEnd:function(){var l=this;document.removeEventListener("webkitTransitionEnd",l,false);l.resetPosition()},resetPosition:function(){var l=this;var n=l.x;var m=l.y;if(l.x>=0)n=0;else if(l.x<l.maxScrollX)n=l.maxScrollX;if(l.y>=0||l.maxScrollY>0)m=0;else if(l.y<l.maxScrollY)m=l.maxScrollY;if(n!=l.x||m!=l.y)l.scrollTo(n,m);else{if(l.moved){l.onScrollEnd();l.moved=false}if(l.scrollBarX)l.scrollBarX.hide();if(l.scrollBarY)l.scrollBarY.hide()}},snap:function(l,o){var m=
this;var n;if(m.directionX>0)l=Math.floor(l/m.scrollWidth);else if(m.directionX<0)l=Math.ceil(l/m.scrollWidth);else l=Math.round(l/m.scrollWidth);m.pageX=-l;l=l*m.scrollWidth;if(l>0)l=m.pageX=0;else if(l<m.maxScrollX){m.pageX=m.maxPageX;l=m.maxScrollX}if(m.directionY>0)o=Math.floor(o/m.scrollHeight);else if(m.directionY<0)o=Math.ceil(o/m.scrollHeight);else o=Math.round(o/m.scrollHeight);m.pageY=-o;o=o*m.scrollHeight;if(o>0)o=m.pageY=0;else if(o<m.maxScrollY){m.pageY=m.maxPageY;o=m.maxScrollY}n=Math.round(Math.max(Math.abs(m.x-
l)/m.scrollWidth*500,Math.abs(m.y-o)/m.scrollHeight*500));return{x:l,y:o,time:n}},scrollTo:function(m,l,o){var n=this;if(n.x==m&&n.y==l){n.resetPosition();return}n.moved=true;n.setTransitionTime(o||"350ms");n.setPosition(m,l);if(o==="0"||o=="0s"||o=="0ms")n.resetPosition();else document.addEventListener("webkitTransitionEnd",n,false)},scrollToPage:function(n,m,p){var o=this;var l;if(!o.options.snap){o.pageX=-Math.round(o.x/o.scrollWidth);o.pageY=-Math.round(o.y/o.scrollHeight)}if(n=="next")n=++o.pageX;
else if(n=="prev")n=--o.pageX;if(m=="next")m=++o.pageY;else if(m=="prev")m=--o.pageY;n=-n*o.scrollWidth;m=-m*o.scrollHeight;l=o.snap(n,m);n=l.x;m=l.y;o.scrollTo(n,m,p||"500ms")},scrollToElement:function(m,o){m=typeof m=="object"?m:this.element.querySelector(m);if(!m)return;var n=this;var l=n.scrollX?-m.offsetLeft:0;var p=n.scrollY?-m.offsetTop:0;if(l>=0)l=0;else if(l<n.maxScrollX)l=n.maxScrollX;if(p>=0)p=0;else if(p<n.maxScrollY)p=n.maxScrollY;n.scrollTo(l,p,o)},momentum:function(s,m,q,l){var p=2.5;
var r=1.2;var n=Math.abs(s)/m*1E3;var o=n*n/p/1E3;var t=0;if(s>0&&o>q){n=n*q/o/p;o=q}else if(s<0&&o>l){n=n*l/o/p;o=l}o=o*(s<0?-1:1);t=n/r;return{dist:Math.round(o),time:Math.round(t)}},destroy:function(l){var m=this;window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",m,false);m.element.removeEventListener(f,m,false);m.element.removeEventListener(i,m,false);m.element.removeEventListener(e,m,false);document.removeEventListener("webkitTransitionEnd",m,false);if(m.options.checkDOMChanges)m.element.removeEventListener("DOMSubtreeModified",
m,false);if(m.scrollBarX)m.scrollBarX=m.scrollBarX.remove();if(m.scrollBarY)m.scrollBarY=m.scrollBarY.remove();if(l)m.wrapper.parentNode.removeChild(m.wrapper);return null}};k.prototype={init:function(l,n){var o=this;var q=document;var p=Math.PI;var m;if(o.dir=="horizontal"){if(o.maxSize!=o.wrapper.offsetWidth){o.maxSize=o.wrapper.offsetWidth;m=q.getCSSCanvasContext("2d","scrollbar"+o.uid+o.dir,o.maxSize,5);m.fillStyle="rgb(0,0,0)";m.beginPath();m.arc(2.5,2.5,2.5,p/2,-p/2,false);m.lineTo(o.maxSize-
2.5,0);m.arc(o.maxSize-2.5,2.5,2.5,-p/2,p/2,false);m.closePath();m.fill()}}else if(o.maxSize!=o.wrapper.offsetHeight){o.maxSize=o.wrapper.offsetHeight;m=q.getCSSCanvasContext("2d","scrollbar"+o.uid+o.dir,5,o.maxSize);m.fillStyle="rgb(0,0,0)";m.beginPath();m.arc(2.5,2.5,2.5,p,0,false);m.lineTo(5,o.maxSize-2.5);m.arc(2.5,o.maxSize-2.5,2.5,0,p,false);m.closePath();m.fill()}o.size=Math.max(Math.round(o.maxSize*o.maxSize/n),6);o.maxScroll=o.maxSize-o.size;o.toWrapperProp=o.maxScroll/(l-n);o.bar.style[o.dir==
"horizontal"?"width":"height"]=o.size+"px"},setPosition:function(m){var l=this;if(l.wrapper.style.opacity!="1")l.show();m=Math.round(l.toWrapperProp*m);if(m<0){m=l.shrink?m+m*3:0;if(l.size+m<7)m=-l.size+6}else if(m>l.maxScroll){m=l.shrink?m+(m-l.maxScroll)*3:l.maxScroll;if(l.size+l.maxScroll-m<7)m=l.size+l.maxScroll-6}m=l.dir=="horizontal"?h+m+"px,0"+b:h+"0,"+m+"px"+b;l.bar.style.webkitTransform=m},show:function(){if(d)this.wrapper.style.webkitTransitionDelay="0";this.wrapper.style.opacity="1"},hide:function(){if(d)this.wrapper.style.webkitTransitionDelay=
"350ms";this.wrapper.style.opacity="0"},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null}};var d="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix;var g=/iphone|ipad/gi.test(navigator.appVersion);var a="ontouchstart"in window;var f=a?"touchstart":"mousedown";var i=a?"touchmove":"mousemove";var e=a?"touchend":"mouseup";var h="translate"+(d?"3d(":"(");var b=d?",0)":")";var c=0;window.iScroll=j})();
(function(){var analyticsData=JSON.parse(document.currentScript.dataset.data||"null");var analyticsItems=JSON.parse(document.currentScript.dataset.items||"null");var gaScript=document.createElement("script");gaScript.src="https://www.google-analytics.com/analytics.js";gaScript.async=true;document.head.appendChild(gaScript);window.ga=window.ga||function(){var args=Array.prototype.slice.call(arguments);return(ga.q=ga.q||[]).push(args)};window.Analytics={properties:[],call_queue:[],test_ids:["UA-4189134-10",
"UA-4189134-13"],live_ids:["UA-4189134-2","UA-4189134-11"],environments:{0:{sample_rate:100},1:{sample_rate:100,cookie_domain:"staging.bcdevs.com"},2:{sample_rate:8,use_live_ids:true,cookie_domain:"bandcamp.com"}},dimensions:{LOGIN_STATE:"dimension1",CLIENT_ID:"dimension2"},metrics:{RESPONSE_END_TIME:"metric1",DOM_LOAD_TIME:"metric2",WINDOW_LOAD_TIME:"metric3"},currentCurrency:"USD",data:null,inited:false,ecommerce:false,init:function(){this.data=analyticsData||window.AnalyticsData;if(!this.data||
this.inited)return;if(Identities.bmgr.bands().length>0)this.data.login_state="logged_in_band";else if(Identities.user())this.data.login_state="logged_in_user";else this.data.login_state="not_logged_in";var environment=this.environments[this.data.env];this.data.sample_rate=environment.sample_rate;if(!this.data.our_ids)this.data.our_ids=environment.use_live_ids?this.live_ids:this.test_ids;this.data.cookie_domain=this.data.domain_match?this.data.cookie_domain||environment.cookie_domain:"auto";this.inited=
true;var fullUrl=this.data.send_full_url;this.split=window.location.href.split("?");this.params=this.split[1]&&this.split[1].split("\x26");var hideParams=[];this.params=this.params&&this.params.filter(function(p){var isUTM=p.substr(0,4)==="utm_";var notEmail=p.substr(0,6)!=="email\x3d";if(isUTM)hideParams.push(p.split("\x3d")[0]);return fullUrl?notEmail:isUTM});if(hideParams.length>0)HiddenParams.hide(hideParams);var index=0;this.data.our_ids.forEach(function(id){this.properties.push(this.createPropertySendPageview(id,
true,index));index++},this);if(this.data.band_id)this.createPropertySendPageview(this.data.band_id,false,index);this.collectClientIds();this.sendCheckoutItems();this.sendTimings();this.processQueuedEvents()},createPropertySendPageview:function(id,ours,index){var name=(ours?"bandcamp_":"band_")+index;var createSettings={name:name};if(ours){createSettings.cookieDomain=this.data.cookie_domain;createSettings.sampleRate=this.data.sample_rate}ga("create",id,createSettings);var property={id:id,ours:ours,
name:name,call:function(){var args=Array.prototype.slice.call(arguments);args[0]=property.name+"."+args[0];ga.apply(window,args)}};property.call("set","anonymizeIp",true);property.call("set","forceSSL",true);property.call("set","transport","beacon");if(ours)property.call("set",this.dimensions.LOGIN_STATE,this.data.login_state);if(this.params){var suffix=this.params.length>0?"?"+this.params.join("\x26"):"";var setPage=!this.data.send_full_url?window.location.pathname:window.location.pathname+suffix;
property.call("set","page",setPage);property.call("set","location",this.split[0]+suffix)}property.call("send","pageview");return property},collectClientIds:function(){var self=this;ga(function(){var props=window.Analytics.properties;var trackers=ga.getAll();for(var i=0;i<trackers.length;i++){var id=trackers[i].get("trackingId");var value=trackers[i].get("clientId");for(var pi=0;pi<props.length;pi++){var prop=props[pi];if(prop.id===id)prop.call("set",self.dimensions.CLIENT_ID,value)}}})},sendCheckoutItems:function(){var items=
analyticsItems||window.AnalyticsItems;if(!items||items.length==0)return;var grouped={};items.forEach(function(i){(grouped[i.payment_id]=grouped[i.payment_id]||[]).push(i)});var alwaysSend=false;if(typeof URLSearchParams!=="undefined"){var params=Url.parseQuery(window.location.search);alwaysSend=params&&params.always_send_txns}var cookieName="analytics_processed_ids";var alreadySentIDs=JSON.parse(localStorage.getItem(cookieName)||"[]");var newIDs=[];var i$$0=0;for(var ids=Object.keys(grouped);i$$0<
ids.length;i$$0++)if(alwaysSend||alreadySentIDs.indexOf(ids[i$$0])===-1)newIDs.push(ids[i$$0]);if(newIDs.length==0)return;var byTxnId={};newIDs.forEach(function(id){grouped[id].forEach(function(item){var txn_id=item.txn_id.slice();delete item.payment_id;delete item.txn_id;if(byTxnId[txn_id]==null)byTxnId[txn_id]=[];byTxnId[txn_id].push(item)})});this.requireEcommerce();var analytics=this;Object.keys(byTxnId).forEach(function(id){byTxnId[id].forEach(function(item){analytics.setCurrency(item.currency);
delete item.currency;analytics.callOurProperties("ec:addProduct",item)});analytics.callOurProperties("ec:setAction","purchase",{id:id})});alreadySentIDs=alreadySentIDs.slice(Math.max(alreadySentIDs.length-1E3,0));localStorage.setItem(cookieName,JSON.stringify(alreadySentIDs.concat(newIDs)))},sendTimings:function(){if(!(window.performance&&window.performance.timing))return;if(document.readyState!="complete"){window.addEventListener("load",function(){window.Analytics.sendTimings()});return}var nt=performance.timing;
var navStart=nt.navigationStart;var responseEnd=Math.round(nt.responseEnd-navStart);var domLoad=Math.round(nt.domContentLoadedEventStart-navStart);var windowLoad=Math.round(nt.loadEventStart-navStart);var allValuesAreValid=function(values){var valid=true;values.forEach(function(value){if(value<=0||value>=1E6)valid=false});return valid};if(allValuesAreValid([responseEnd,domLoad,windowLoad])){var event={eventCategory:"Navigation Timing",eventAction:"track",nonInteraction:true};event[this.metrics.RESPONSE_END_TIME]=
responseEnd;event[this.metrics.DOM_LOAD_TIME]=domLoad;event[this.metrics.WINDOW_LOAD_TIME]=windowLoad;this.callOurProperties("send","event",event)}},processQueuedEvents:function(){for(;this.call_queue.length>0;)this.callOurProperties.apply(this,this.call_queue.shift())},callOurProperties:function(){var args=Array.prototype.slice.call(arguments);if(!this.inited){this.call_queue.push(args);return}this.properties.forEach(function(property){if(property.ours)property.call.apply(null,args)})},setCurrency:function(currencyCode){if(currencyCode&&
currencyCode!=this.currentCurrency){this.callOurProperties("set","currencyCode",currencyCode);this.currentCurrency=currencyCode}},cartItemEvent:function(addOrRemove,item){var add=addOrRemove=="add";this.requireEcommerce();this.setCurrency(item.currency);this.callOurProperties("ec:addProduct",{id:item.item_type+item.item_id,name:item.item_title,category:item.item_type,price:item.unit_price,variant:item.is_gift?"gift":"_none",quantity:item.quantity});this.callOurProperties("ec:setAction",add?"add":
"remove");this.callOurProperties("send","event","Checkout",add?"add_to_cart":"remove_from_cart",item.item_type,item.item_id)},requireEcommerce:function(){if(this.ecommerce)return;this.callOurProperties("require","ec");this.ecommerce=true}};window.Analytics.init()})();