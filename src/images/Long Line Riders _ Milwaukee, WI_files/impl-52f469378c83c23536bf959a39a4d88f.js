// bundle contents: tracker.js, auto_track_clicks.js, scroll_depth.js
(function(){function Tracker_1(recordURL,sendDelay,enabled){function recordPageView(){var props={referrer_url:document.referrer,screen:{width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio}};if(window.MediaView&&window.MediaView.mode)props.media_mode=window.MediaView.mode;var metaElems=document.head.querySelectorAll('meta[name\x3d"bc-page-properties"]');for(var i=0;i<metaElems.length;i++){var meta=metaElems[i];Object.assign(props,JSON.parse(meta.content))}self.pageViewSent=
true;self.record("page_view",props);self.pageViewCallbacks.forEach(function(callback){callback.call(props)});self.pageViewCallbacks=null}this.recordURL=recordURL;this.sendDelay=sendDelay;this.enabled=enabled;this.queue=[];this.pageViewCallbacks=[];this.pageViewSent=false;var self=this;document.addEventListener("visibilitychange",function(){if(document.visibilityState==="visible"&&!self.pageViewSent)recordPageView();if(document.visibilityState!=="visible")self.send()});window.addEventListener("pagehide",
function(){self.send()});if(document.visibilityState==="visible")recordPageView()}Tracker_1.prototype.record=function(type,props){this.queue.push({type:type,timestamp:Date.now()/1E3,properties:Object.assign({page_url:location.href},props)});if(!this.timeout)this.timeout=setTimeout(this.send.bind(this),this.sendDelay)};Tracker_1.prototype.send=function(){if(this.timeout){clearTimeout(this.timeout);this.timeout=null}if(this.queue.length===0){console.log("no events to send");return}if(!this.enabled){console.log("Tracker disabled; not sending events:",
this.queue);this.queue.length=0;return}console.log("sending "+this.queue.length+" tracking events");var data=JSON.stringify({send_time:Date.now()/1E3,events:this.queue});if(navigator.sendBeacon(this.recordURL,data))this.queue.length=0;else console.warn("failed to queue sendBeacon for events",this.queue)};Tracker_1.prototype.afterPageView=function(callback){if(this.pageViewSent)callback.call();else this.pageViewCallbacks.push(callback)};var recordURL=JSON.parse(document.currentScript.dataset.recordUrl);
var sendDelay=JSON.parse(document.currentScript.dataset.sendDelay)*1E3;var enabled=JSON.parse(document.currentScript.dataset.enabled);var BCTracker=new Tracker_1(recordURL,sendDelay,enabled);var preloadQueue=window.BCTracker&&window.BCTracker.preloadQueue;if(preloadQueue)preloadQueue.forEach(function(args){BCTracker.record.apply(BCTracker,args)});var prePageViewCallbacks=window.BCTracker&&window.BCTracker.prePageViewCallbacks;if(prePageViewCallbacks)prePageViewCallbacks.forEach(function(callback){BCTracker.afterPageView(callback)});
window.BCTracker=BCTracker})();
(function(){function handleEvent(event){var target=event.target;if(target.localName==="a"&&target.host&&target.host!==location.host&&!target.host.endsWith("bandcamp.com"))BCTracker.record("click",{tag:"external_link",link_url:event.target.href});else;}var enabled=JSON.parse(document.currentScript.dataset.autoTrackClicks);if(!enabled)return;var filters=JSON.parse(document.currentScript.dataset.autoTrackFilters);document.addEventListener("click",handleEvent,{capture:true,passive:true})})();
(function(){function ScrollDepthTracker(intersectionObserverOptions){this.intersectionObserver=new IntersectionObserver(this.observeIntersections.bind(this),intersectionObserverOptions);this.elemProps={}}ScrollDepthTracker.prototype.observeIntersections=function(entries){var self=this;entries.forEach(function(entry){if(!entry.isIntersecting)return;var target=entry.target;var props=self.elemProps[target];BCTracker.record("scroll",props);delete self.elemProps[target];self.intersectionObserver.unobserve(target)})};
ScrollDepthTracker.prototype.track=function(target,props){this.elemProps[target]=props;this.intersectionObserver.observe(target)};var DEFAULT_THRESHOLD=.25;var defaultScrollDepthTracker;ScrollDepthTracker.track=function(target,props){if(!defaultScrollDepthTracker)defaultScrollDepthTracker=new ScrollDepthTracker({threshold:DEFAULT_THRESHOLD});defaultScrollDepthTracker.track(target,props)};window.ScrollDepthTracker=ScrollDepthTracker})();